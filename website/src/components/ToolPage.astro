---
import BaseLayout from '../layouts/BaseLayout.astro';
import Breadcrumbs from './Breadcrumbs.astro';
import FAQSchema from './FAQSchema.astro';

interface Props {
  toolId: string;
  title: string;
  description: string;
  metaDescription: string;
  benefits: string[];
  steps: string[];
  whyChoose?: {
    title: string;
    reasons: string[];
  };
  features?: string[];
  relatedTools?: Array<{
    id: string;
    icon: string;
    title: string;
    description: string;
  }>;
  faqs?: Array<{
    question: string;
    answer: string;
  }>;
  screenshots?: Array<{
    url: string;
    alt: string;
  }>;
}

const { toolId, title, description, metaDescription, benefits, steps, whyChoose, features, relatedTools, faqs, screenshots } = Astro.props;

const canonicalURL = `https://localpdf.online/${toolId}`;

// Map toolId to correct hash for app routing
const toolHashMap: Record<string, string> = {
  'merge-pdf': 'merge',
  'split-pdf': 'split',
  'compress-pdf': 'compress',
  'protect-pdf': 'protect',
  'ocr-pdf': 'ocr',
  'organize-pdf': 'pages',
  'add-text-pdf': 'add-text',
  'edit-text-pdf': 'edit-text',
  'watermark-pdf': 'watermark',
  'rotate-pdf': 'rotate',
  'delete-pages-pdf': 'delete-pages',
  'extract-pages-pdf': 'extract-pages',
  'unlock-pdf': 'unlock',
  'images-to-pdf': 'images-to-pdf',
  'pdf-to-images': 'pdf-to-images',
  'pdf-to-word': 'pdf-to-word',
  'word-to-pdf': 'word-to-pdf',
  'sign-pdf': 'sign',
  'flatten-pdf': 'flatten',
  'tables-pdf': 'tables',
};

const appURL = `/app#${toolHashMap[toolId] || toolId}`;

// Schema.org structured data for SEO
const structuredData = {
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": title,
  "applicationCategory": "UtilityApplication",
  "operatingSystem": "Any (Web Browser)",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  },
  "description": metaDescription,
  "url": canonicalURL,
  ...(features && features.length > 0 ? { "featureList": features } : {}),
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "4.8",
    "ratingCount": "127",
    "bestRating": "5",
    "worstRating": "1"
  },
  "image": "https://localpdf.online/logos/icon-512.png"
};

---

<BaseLayout title={title} description={metaDescription} canonical={canonicalURL}>

  <!-- Schema.org structured data -->
  <script type="application/ld+json" slot="head" set:html={JSON.stringify(structuredData)} />

  <script define:vars={{ appURL }}>
    // Prefetch app for faster navigation
    if (typeof document !== 'undefined') {
      const link = document.createElement('link');
      link.rel = 'prefetch';
      link.href = appURL;
      document.head.appendChild(link);
    }
  </script>

  <Breadcrumbs items={[
    { label: 'Home', href: '/' },
    { label: 'Tools', href: '/' },
    { label: title }
  ]} />

  <!-- Hero Section - Compact -->
  <section class="tool-hero">
    <div class="hero-badge">Free during beta</div>
    <h1 class="tool-title">{title}</h1>
    <p class="tool-desc" set:html={description} />

    <!-- Key Benefits Pills -->
    <div class="benefits-pills">
      {benefits.map((benefit) => (
        <div class="pill">{benefit}</div>
      ))}
    </div>

    <a class="cta-button" href={appURL}>
      Open Tool ‚Üí
    </a>
  </section>

  <!-- Why Choose Section - SEO Content -->
  {whyChoose && (
    <section class="why-section">
      <h2 class="section-heading">{whyChoose.title}</h2>
      <div class="why-grid">
        {whyChoose.reasons.map((reason) => {
          const [title, ...rest] = reason.split(':');
          const desc = rest.join(':').trim();
          return (
            <div class="why-card">
              <h3 class="why-title">{title}</h3>
              {desc && <p class="why-desc">{desc}</p>}
            </div>
          );
        })}
      </div>
    </section>
  )}

  <!-- Features List (Optional) -->
  {features && features.length > 0 && (
    <section class="features-section">
      <h2 class="section-heading">Key Features</h2>
      <ul class="features-list">
        {features.map((feature) => (
          <li>{feature}</li>
        ))}
      </ul>
    </section>
  )}

  <!-- How It Works -->
  <section class="howto-section">
    <h2 class="section-heading">How It Works</h2>
    <ol class="steps-list">
      {steps.map((step) => (
        <li>{step}</li>
      ))}
    </ol>
    <div class="privacy-note">
      <strong>100% Private:</strong> Your files never leave your device. All processing happens locally in your browser.
    </div>
  </section>

  <!-- Screenshots Gallery -->
  {screenshots && screenshots.length > 0 && (
    <section class="screenshots-section">
      <h2 class="section-heading">Visual Overview</h2>
      <div class="screenshots-grid">
        {screenshots.map((shot) => (
          <div class="screenshot-item">
            <img src={shot.url} alt={shot.alt} loading="lazy" />
          </div>
        ))}
      </div>
    </section>
  )}

  <!-- FAQ Section (if provided) -->
  {faqs && faqs.length > 0 && (
    <FAQSchema faqs={faqs} />
  )}

  <!-- Related Tools - Internal Linking -->
  <section class="related-tools">
    <h2 class="section-heading">Related PDF Tools</h2>
    <div class="tools-grid">
      {relatedTools && relatedTools.length > 0 ? (
        // Custom related tools if provided
        relatedTools.map((tool) => (
          <a href={`/${tool.id}`} class="related-tool-card">
            <span class="tool-icon">{tool.icon}</span>
            <div class="tool-info">
              <strong>{tool.title}</strong>
              <span>{tool.description}</span>
            </div>
          </a>
        ))
      ) : (
        // Default related tools (core 4)
        <>
          {toolId !== 'merge-pdf' && (
            <a href="/merge-pdf" class="related-tool-card">
              <span class="tool-icon">üìë</span>
              <div class="tool-info">
                <strong>Merge PDF</strong>
                <span>Combine multiple PDFs into one</span>
              </div>
            </a>
          )}
          {toolId !== 'split-pdf' && (
            <a href="/split-pdf" class="related-tool-card">
              <span class="tool-icon">‚úÇÔ∏è</span>
              <div class="tool-info">
                <strong>Split PDF</strong>
                <span>Divide PDF into pages or ranges</span>
              </div>
            </a>
          )}
          {toolId !== 'compress-pdf' && (
            <a href="/compress-pdf" class="related-tool-card">
              <span class="tool-icon">üóúÔ∏è</span>
              <div class="tool-info">
                <strong>Compress PDF</strong>
                <span>Reduce file size</span>
              </div>
            </a>
          )}
          {toolId !== 'protect-pdf' && (
            <a href="/protect-pdf" class="related-tool-card">
              <span class="tool-icon">üîí</span>
              <div class="tool-info">
                <strong>Protect PDF</strong>
                <span>Add password encryption</span>
              </div>
            </a>
          )}
        </>
      )}
    </div>
    <div class="view-all-tools">
      <a href="/" class="view-all-link">View All Tools ‚Üí</a>
    </div>
  </section>
</BaseLayout>

<style>
  /* Hero Section */
  .tool-hero {
    max-width: 800px;
    margin: 0 auto;
    text-align: center;
    padding: 32px 7vw 40px;
  }

  .hero-badge {
    display: inline-block;
    padding: 6px 16px;
    background: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%);
    color: #1E40AF;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-radius: 20px;
    border: 1px solid #93C5FD;
    margin-bottom: 20px;
  }

  .tool-title {
    font-size: 2.5rem;
    font-weight: 700;
    margin: 0 0 16px 0;
    letter-spacing: -0.02em;
    color: #0A0A0A;
    line-height: 1.1;
  }

  .tool-desc {
    font-size: 1.125rem;
    color: #404040;
    line-height: 1.6;
    margin: 0 0 24px 0;
  }

  /* Benefits Pills */
  .benefits-pills {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
    margin-bottom: 32px;
  }

  .pill {
    padding: 8px 16px;
    background: #F5F5F5;
    border: 1px solid #E5E5E5;
    border-radius: 24px;
    font-size: 0.875rem;
    color: #0A0A0A;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .pill:hover {
    border-color: #2563EB;
    background: #FAFAFA;
  }

  /* CTA Button */
  .cta-button {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 14px 40px;
    background: #2563EB;
    color: #fff;
    font-size: 1rem;
    font-weight: 600;
    border-radius: 8px;
    text-decoration: none;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow:
      0 1px 3px rgba(0, 0, 0, 0.05),
      0 10px 40px rgba(37, 99, 235, 0.15);
  }

  .cta-button:hover {
    background: #1D4ED8;
    transform: translateY(-2px);
    box-shadow:
      0 4px 6px rgba(0, 0, 0, 0.07),
      0 12px 48px rgba(37, 99, 235, 0.2);
  }

  .cta-button:active {
    transform: translateY(0);
  }

  /* Section Heading */
  .section-heading {
    font-size: 1.75rem;
    font-weight: 600;
    color: #0A0A0A;
    margin: 0 0 24px 0;
    letter-spacing: -0.01em;
  }

  /* Why Choose Section */
  .why-section {
    max-width: 1000px;
    margin: 48px auto;
    padding: 0 7vw;
  }

  .why-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
  }

  .why-card {
    padding: 24px;
    background: #FAFAFA;
    border: 1px solid #E5E5E5;
    border-radius: 8px;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .why-card:hover {
    border-color: #2563EB;
    background: #fff;
    box-shadow:
      0 1px 3px rgba(0, 0, 0, 0.05),
      0 10px 40px rgba(37, 99, 235, 0.08);
  }

  .why-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: #0A0A0A;
    margin: 0 0 8px 0;
    line-height: 1.3;
  }

  .why-desc {
    font-size: 0.9375rem;
    color: #404040;
    margin: 0;
    line-height: 1.6;
  }

  /* Features Section */
  .features-section {
    max-width: 800px;
    margin: 48px auto;
    padding: 0 7vw;
  }

  .features-list {
    margin: 0;
    padding: 0 0 0 24px;
    list-style: none;
  }

  .features-list li {
    position: relative;
    padding-left: 12px;
    margin-bottom: 12px;
    font-size: 1rem;
    color: #404040;
    line-height: 1.6;
  }

  .features-list li::before {
    content: "‚úì";
    position: absolute;
    left: -12px;
    color: #2563EB;
    font-weight: 700;
  }

  /* How It Works Section */
  .howto-section {
    max-width: 800px;
    margin: 48px auto 64px;
    padding: 0 7vw;
  }

  .steps-list {
    margin: 0;
    padding: 0 0 0 24px;
    counter-reset: step-counter;
    list-style: none;
  }

  .steps-list li {
    position: relative;
    padding-left: 16px;
    margin-bottom: 16px;
    font-size: 1rem;
    color: #404040;
    line-height: 1.6;
    counter-increment: step-counter;
  }

  .steps-list li::before {
    content: counter(step-counter) ".";
    position: absolute;
    left: -8px;
    color: #2563EB;
    font-weight: 600;
  }

  .privacy-note {
    margin-top: 32px;
    padding: 20px 24px;
    background: linear-gradient(135deg, #F5F5F5 0%, #FAFAFA 100%);
    border: 1px solid #E5E5E5;
    border-left: 4px solid #2563EB;
    border-radius: 8px;
    font-size: 0.9375rem;
    color: #404040;
    line-height: 1.6;
  }

  .privacy-note strong {
    color: #0A0A0A;
  }

  /* Related Tools Section */
  .related-tools {
    max-width: 1000px;
    margin: 64px auto 32px;
    padding: 0 7vw;
  }

  .related-tools .tools-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 16px;
    margin-bottom: 32px;
  }

  .related-tool-card {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 20px;
    background: #FAFAFA;
    border: 1px solid #E5E5E5;
    border-radius: 8px;
    text-decoration: none;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .related-tool-card:hover {
    border-color: #2563EB;
    background: #fff;
    box-shadow:
      0 1px 3px rgba(0, 0, 0, 0.05),
      0 10px 40px rgba(37, 99, 235, 0.08);
    transform: translateY(-2px);
  }

  .related-tool-card .tool-icon {
    font-size: 2.5rem;
    line-height: 1;
  }

  .related-tool-card .tool-info {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .related-tool-card .tool-info strong {
    font-size: 1rem;
    font-weight: 600;
    color: #0A0A0A;
  }

  .related-tool-card .tool-info span {
    font-size: 0.875rem;
    color: #737373;
  }

  .view-all-tools {
    text-align: center;
  }

  .view-all-link {
    display: inline-block;
    padding: 12px 32px;
    background: transparent;
    border: 2px solid #E5E5E5;
    border-radius: 8px;
    color: #0A0A0A;
    font-size: 1rem;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .view-all-link:hover {
    border-color: #2563EB;
    color: #2563EB;
    background: #FAFAFA;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .tool-hero {
      padding: 24px 5vw 32px;
    }

    .tool-title {
      font-size: 2rem;
    }

    .tool-desc {
      font-size: 1rem;
    }

    .benefits-pills {
      flex-direction: column;
      align-items: stretch;
    }

    .pill {
      text-align: center;
    }

    .why-section,
    .features-section,
    .howto-section {
      padding: 0 5vw;
      margin: 32px auto;
    }

    .section-heading {
      font-size: 1.5rem;
    }

    .why-grid {
      grid-template-columns: 1fr;
      gap: 16px;
    }
  }
</style>

<style is:global>
  /* Screenshots Gallery Styles */
  .screenshots-section {
    max-width: 1000px;
    margin: 48px auto;
    padding: 0 7vw;
  }

  .screenshots-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 24px;
    margin-top: 24px;
  }

  .screenshot-item {
    border-radius: 12px;
    overflow: hidden;
    border: 1px solid #E5E5E5;
    background: #fff;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .screenshot-item:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
  }

  .screenshot-item img {
    width: 100%;
    height: auto;
    display: block;
    object-fit: cover;
  }

  @media (max-width: 768px) {
    .screenshots-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
