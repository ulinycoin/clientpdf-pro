var Zi=Object.defineProperty;var ts=(pt,u,et)=>u in pt?Zi(pt,u,{enumerable:!0,configurable:!0,writable:!0,value:et}):pt[u]=et;var Zt=(pt,u,et)=>(ts(pt,typeof u!="symbol"?u+"":u,et),et),Oe=(pt,u,et)=>{if(!u.has(pt))throw TypeError("Cannot "+et)};var t=(pt,u,et)=>(Oe(pt,u,"read from private field"),et?et.call(pt):u.get(pt)),D=(pt,u,et)=>{if(u.has(pt))throw TypeError("Cannot add the same private member more than once");u instanceof WeakSet?u.add(pt):u.set(pt,et)},J=(pt,u,et,l)=>(Oe(pt,u,"write to private field"),l?l.call(pt,et):u.set(pt,et),et);var pe=(pt,u,et,l)=>({set _(T){J(pt,u,T,et)},get _(){return t(pt,u,l)}}),j=(pt,u,et)=>(Oe(pt,u,"access private method"),et);var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};function getDefaultExportFromCjs(pt){return pt&&pt.__esModule&&Object.prototype.hasOwnProperty.call(pt,"default")?pt.default:pt}function getAugmentedNamespace(pt){if(pt.__esModule)return pt;var u=pt.default;if(typeof u=="function"){var et=function l(){return this instanceof l?Reflect.construct(u,arguments,this.constructor):u.apply(this,arguments)};et.prototype=u.prototype}else et={};return Object.defineProperty(et,"__esModule",{value:!0}),Object.keys(pt).forEach(function(l){var T=Object.getOwnPropertyDescriptor(pt,l);Object.defineProperty(et,l,T.get?T:{enumerable:!0,get:function(){return pt[l]}})}),et}function commonjsRequire(pt){throw new Error('Could not dynamically require "'+pt+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pdf={exports:{}};const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$5=getAugmentedNamespace(__viteBrowserExternal$1);(function(module,exports){(function(u,et){module.exports=u.pdfjsLib=et()})(globalThis,()=>(()=>{var __webpack_modules__=[,(pt,u)=>{var zt;Object.defineProperty(u,"__esModule",{value:!0}),u.VerbosityLevel=u.Util=u.UnknownErrorException=u.UnexpectedResponseException=u.TextRenderingMode=u.RenderingIntentFlag=u.PromiseCapability=u.PermissionFlag=u.PasswordResponses=u.PasswordException=u.PageActionEventType=u.OPS=u.MissingPDFException=u.MAX_IMAGE_SIZE_TO_CACHE=u.LINE_FACTOR=u.LINE_DESCENT_FACTOR=u.InvalidPDFException=u.ImageKind=u.IDENTITY_MATRIX=u.FormatError=u.FeatureTest=u.FONT_IDENTITY_MATRIX=u.DocumentActionEventType=u.CMapCompressionType=u.BaseException=u.BASELINE_FACTOR=u.AnnotationType=u.AnnotationReplyType=u.AnnotationPrefix=u.AnnotationMode=u.AnnotationFlag=u.AnnotationFieldFlag=u.AnnotationEditorType=u.AnnotationEditorPrefix=u.AnnotationEditorParamsType=u.AnnotationBorderStyleType=u.AnnotationActionEventType=u.AbortException=void 0,u.assert=at,u.bytesToString=O,u.createValidAbsoluteUrl=Tt,u.getModificationDate=St,u.getUuid=Gt,u.getVerbosityLevel=V,u.info=ut,u.isArrayBuffer=ht,u.isArrayEqual=Ct,u.isNodeJS=void 0,u.normalizeUnicode=Xt,u.objectFromMap=lt,u.objectSize=it,u.setVerbosityLevel=P,u.shadow=xt,u.string32=Z,u.stringToBytes=Q,u.stringToPDFString=ft,u.stringToUTF8String=K,u.unreachable=G,u.utf8StringToString=$,u.warn=nt;const et=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");u.isNodeJS=et;const l=[1,0,0,1,0,0];u.IDENTITY_MATRIX=l;const T=[.001,0,0,.001,0,0];u.FONT_IDENTITY_MATRIX=T;const rt=1e7;u.MAX_IMAGE_SIZE_TO_CACHE=rt;const z=1.35;u.LINE_FACTOR=z;const gt=.35;u.LINE_DESCENT_FACTOR=gt;const B=gt/z;u.BASELINE_FACTOR=B;const k={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};u.RenderingIntentFlag=k;const g={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};u.AnnotationMode=g;const L="pdfjs_internal_editor_";u.AnnotationEditorPrefix=L;const N={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15};u.AnnotationEditorType=N;const M={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23};u.AnnotationEditorParamsType=M;const S={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};u.PermissionFlag=S;const y={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};u.TextRenderingMode=y;const p={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};u.ImageKind=p;const m={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};u.AnnotationType=m;const E={GROUP:"Group",REPLY:"R"};u.AnnotationReplyType=E;const w={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};u.AnnotationFlag=w;const _={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};u.AnnotationFieldFlag=_;const a={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};u.AnnotationBorderStyleType=a;const c={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};u.AnnotationActionEventType=c;const d={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};u.DocumentActionEventType=d;const r={O:"PageOpen",C:"PageClose"};u.PageActionEventType=r;const f={ERRORS:0,WARNINGS:1,INFOS:5};u.VerbosityLevel=f;const F={NONE:0,BINARY:1};u.CMapCompressionType=F;const C={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};u.OPS=C;const X={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};u.PasswordResponses=X;let Y=f.WARNINGS;function P(ot){Number.isInteger(ot)&&(Y=ot)}function V(){return Y}function ut(ot){Y>=f.INFOS&&console.log(`Info: ${ot}`)}function nt(ot){Y>=f.WARNINGS&&console.log(`Warning: ${ot}`)}function G(ot){throw new Error(ot)}function at(ot,tt){ot||G(tt)}function At(ot){switch(ot?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Tt(ot,tt=null,H=null){if(!ot)return null;try{if(H&&typeof ot=="string"&&(H.addDefaultProtocol&&ot.startsWith("www.")&&ot.match(/\./g)?.length>=2&&(ot=`http://${ot}`),H.tryConvertEncoding))try{ot=K(ot)}catch{}const mt=tt?new URL(ot,tt):new URL(ot);if(At(mt))return mt}catch{}return null}function xt(ot,tt,H,mt=!1){return Object.defineProperty(ot,tt,{value:H,enumerable:!mt,configurable:!0,writable:!1}),H}const v=function(){function tt(H,mt){this.constructor===tt&&G("Cannot initialize BaseException."),this.message=H,this.name=mt}return tt.prototype=new Error,tt.constructor=tt,tt}();u.BaseException=v;class i extends v{constructor(tt,H){super(tt,"PasswordException"),this.code=H}}u.PasswordException=i;class n extends v{constructor(tt,H){super(tt,"UnknownErrorException"),this.details=H}}u.UnknownErrorException=n;class s extends v{constructor(tt){super(tt,"InvalidPDFException")}}u.InvalidPDFException=s;class o extends v{constructor(tt){super(tt,"MissingPDFException")}}u.MissingPDFException=o;class h extends v{constructor(tt,H){super(tt,"UnexpectedResponseException"),this.status=H}}u.UnexpectedResponseException=h;class A extends v{constructor(tt){super(tt,"FormatError")}}u.FormatError=A;class x extends v{constructor(tt){super(tt,"AbortException")}}u.AbortException=x;function O(ot){(typeof ot!="object"||ot?.length===void 0)&&G("Invalid argument for bytesToString");const tt=ot.length,H=8192;if(tt<H)return String.fromCharCode.apply(null,ot);const mt=[];for(let _t=0;_t<tt;_t+=H){const ee=Math.min(_t+H,tt),Jt=ot.subarray(_t,ee);mt.push(String.fromCharCode.apply(null,Jt))}return mt.join("")}function Q(ot){typeof ot!="string"&&G("Invalid argument for stringToBytes");const tt=ot.length,H=new Uint8Array(tt);for(let mt=0;mt<tt;++mt)H[mt]=ot.charCodeAt(mt)&255;return H}function Z(ot){return String.fromCharCode(ot>>24&255,ot>>16&255,ot>>8&255,ot&255)}function it(ot){return Object.keys(ot).length}function lt(ot){const tt=Object.create(null);for(const[H,mt]of ot)tt[H]=mt;return tt}function yt(){const ot=new Uint8Array(4);return ot[0]=1,new Uint32Array(ot.buffer,0,1)[0]===1}function dt(){try{return new Function(""),!0}catch{return!1}}class kt{static get isLittleEndian(){return xt(this,"isLittleEndian",yt())}static get isEvalSupported(){return xt(this,"isEvalSupported",dt())}static get isOffscreenCanvasSupported(){return xt(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?xt(this,"platform",{isWin:!1,isMac:!1}):xt(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}static get isCSSRoundSupported(){return xt(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}u.FeatureTest=kt;const Ut=[...Array(256).keys()].map(ot=>ot.toString(16).padStart(2,"0"));class vt{static makeHexColor(tt,H,mt){return`#${Ut[tt]}${Ut[H]}${Ut[mt]}`}static scaleMinMax(tt,H){let mt;tt[0]?(tt[0]<0&&(mt=H[0],H[0]=H[1],H[1]=mt),H[0]*=tt[0],H[1]*=tt[0],tt[3]<0&&(mt=H[2],H[2]=H[3],H[3]=mt),H[2]*=tt[3],H[3]*=tt[3]):(mt=H[0],H[0]=H[2],H[2]=mt,mt=H[1],H[1]=H[3],H[3]=mt,tt[1]<0&&(mt=H[2],H[2]=H[3],H[3]=mt),H[2]*=tt[1],H[3]*=tt[1],tt[2]<0&&(mt=H[0],H[0]=H[1],H[1]=mt),H[0]*=tt[2],H[1]*=tt[2]),H[0]+=tt[4],H[1]+=tt[4],H[2]+=tt[5],H[3]+=tt[5]}static transform(tt,H){return[tt[0]*H[0]+tt[2]*H[1],tt[1]*H[0]+tt[3]*H[1],tt[0]*H[2]+tt[2]*H[3],tt[1]*H[2]+tt[3]*H[3],tt[0]*H[4]+tt[2]*H[5]+tt[4],tt[1]*H[4]+tt[3]*H[5]+tt[5]]}static applyTransform(tt,H){const mt=tt[0]*H[0]+tt[1]*H[2]+H[4],_t=tt[0]*H[1]+tt[1]*H[3]+H[5];return[mt,_t]}static applyInverseTransform(tt,H){const mt=H[0]*H[3]-H[1]*H[2],_t=(tt[0]*H[3]-tt[1]*H[2]+H[2]*H[5]-H[4]*H[3])/mt,ee=(-tt[0]*H[1]+tt[1]*H[0]+H[4]*H[1]-H[5]*H[0])/mt;return[_t,ee]}static getAxialAlignedBoundingBox(tt,H){const mt=this.applyTransform(tt,H),_t=this.applyTransform(tt.slice(2,4),H),ee=this.applyTransform([tt[0],tt[3]],H),Jt=this.applyTransform([tt[2],tt[1]],H);return[Math.min(mt[0],_t[0],ee[0],Jt[0]),Math.min(mt[1],_t[1],ee[1],Jt[1]),Math.max(mt[0],_t[0],ee[0],Jt[0]),Math.max(mt[1],_t[1],ee[1],Jt[1])]}static inverseTransform(tt){const H=tt[0]*tt[3]-tt[1]*tt[2];return[tt[3]/H,-tt[1]/H,-tt[2]/H,tt[0]/H,(tt[2]*tt[5]-tt[4]*tt[3])/H,(tt[4]*tt[1]-tt[5]*tt[0])/H]}static singularValueDecompose2dScale(tt){const H=[tt[0],tt[2],tt[1],tt[3]],mt=tt[0]*H[0]+tt[1]*H[2],_t=tt[0]*H[1]+tt[1]*H[3],ee=tt[2]*H[0]+tt[3]*H[2],Jt=tt[2]*H[1]+tt[3]*H[3],q=(mt+Jt)/2,Et=Math.sqrt((mt+Jt)**2-4*(mt*Jt-ee*_t))/2,Nt=q+Et||1,wt=q-Et||1;return[Math.sqrt(Nt),Math.sqrt(wt)]}static normalizeRect(tt){const H=tt.slice(0);return tt[0]>tt[2]&&(H[0]=tt[2],H[2]=tt[0]),tt[1]>tt[3]&&(H[1]=tt[3],H[3]=tt[1]),H}static intersect(tt,H){const mt=Math.max(Math.min(tt[0],tt[2]),Math.min(H[0],H[2])),_t=Math.min(Math.max(tt[0],tt[2]),Math.max(H[0],H[2]));if(mt>_t)return null;const ee=Math.max(Math.min(tt[1],tt[3]),Math.min(H[1],H[3])),Jt=Math.min(Math.max(tt[1],tt[3]),Math.max(H[1],H[3]));return ee>Jt?null:[mt,ee,_t,Jt]}static bezierBoundingBox(tt,H,mt,_t,ee,Jt,q,Et){const Nt=[],wt=[[],[]];let Dt,Bt,Yt,bt,$t,Lt,R,e;for(let W=0;W<2;++W){if(W===0?(Bt=6*tt-12*mt+6*ee,Dt=-3*tt+9*mt-9*ee+3*q,Yt=3*mt-3*tt):(Bt=6*H-12*_t+6*Jt,Dt=-3*H+9*_t-9*Jt+3*Et,Yt=3*_t-3*H),Math.abs(Dt)<1e-12){if(Math.abs(Bt)<1e-12)continue;bt=-Yt/Bt,0<bt&&bt<1&&Nt.push(bt);continue}R=Bt*Bt-4*Yt*Dt,e=Math.sqrt(R),!(R<0)&&($t=(-Bt+e)/(2*Dt),0<$t&&$t<1&&Nt.push($t),Lt=(-Bt-e)/(2*Dt),0<Lt&&Lt<1&&Nt.push(Lt))}let b=Nt.length,I;const U=b;for(;b--;)bt=Nt[b],I=1-bt,wt[0][b]=I*I*I*tt+3*I*I*bt*mt+3*I*bt*bt*ee+bt*bt*bt*q,wt[1][b]=I*I*I*H+3*I*I*bt*_t+3*I*bt*bt*Jt+bt*bt*bt*Et;return wt[0][U]=tt,wt[1][U]=H,wt[0][U+1]=q,wt[1][U+1]=Et,wt[0].length=wt[1].length=U+2,[Math.min(...wt[0]),Math.min(...wt[1]),Math.max(...wt[0]),Math.max(...wt[1])]}}u.Util=vt;const Rt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function ft(ot){if(ot[0]>="ï"){let H;if(ot[0]==="þ"&&ot[1]==="ÿ"?H="utf-16be":ot[0]==="ÿ"&&ot[1]==="þ"?H="utf-16le":ot[0]==="ï"&&ot[1]==="»"&&ot[2]==="¿"&&(H="utf-8"),H)try{const mt=new TextDecoder(H,{fatal:!0}),_t=Q(ot);return mt.decode(_t)}catch(mt){nt(`stringToPDFString: "${mt}".`)}}const tt=[];for(let H=0,mt=ot.length;H<mt;H++){const _t=Rt[ot.charCodeAt(H)];tt.push(_t?String.fromCharCode(_t):ot.charAt(H))}return tt.join("")}function K(ot){return decodeURIComponent(escape(ot))}function $(ot){return unescape(encodeURIComponent(ot))}function ht(ot){return typeof ot=="object"&&ot?.byteLength!==void 0}function Ct(ot,tt){if(ot.length!==tt.length)return!1;for(let H=0,mt=ot.length;H<mt;H++)if(ot[H]!==tt[H])return!1;return!0}function St(ot=new Date){return[ot.getUTCFullYear().toString(),(ot.getUTCMonth()+1).toString().padStart(2,"0"),ot.getUTCDate().toString().padStart(2,"0"),ot.getUTCHours().toString().padStart(2,"0"),ot.getUTCMinutes().toString().padStart(2,"0"),ot.getUTCSeconds().toString().padStart(2,"0")].join("")}class Wt{constructor(){D(this,zt,!1);this.promise=new Promise((tt,H)=>{this.resolve=mt=>{J(this,zt,!0),tt(mt)},this.reject=mt=>{J(this,zt,!0),H(mt)}})}get settled(){return t(this,zt)}}zt=new WeakMap,u.PromiseCapability=Wt;let Ht=null,jt=null;function Xt(ot){return Ht||(Ht=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,jt=new Map([["ﬅ","ſt"]])),ot.replaceAll(Ht,(tt,H,mt)=>H?H.normalize("NFKC"):jt.get(mt))}function Gt(){if(typeof crypto<"u"&&typeof crypto?.randomUUID=="function")return crypto.randomUUID();const ot=new Uint8Array(32);if(typeof crypto<"u"&&typeof crypto?.getRandomValues=="function")crypto.getRandomValues(ot);else for(let tt=0;tt<32;tt++)ot[tt]=Math.floor(Math.random()*255);return O(ot)}const qt="pdfjs_internal_id_";u.AnnotationPrefix=qt},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{var pt,et,l,T,le,z,Se,B,k,g,L,N,M,S,y,Ee,m,E,Ne,_,a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultFilterFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,Object.defineProperty(exports,"SVGGraphics",{enumerable:!0,get:function(){return _displaySvg.SVGGraphics}}),exports.build=void 0,exports.getDocument=getDocument,exports.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(3),_display_utils=__w_pdfjs_require__(6),_font_loader=__w_pdfjs_require__(9),_displayNode_utils=__w_pdfjs_require__(10),_canvas=__w_pdfjs_require__(11),_worker_options=__w_pdfjs_require__(14),_message_handler=__w_pdfjs_require__(15),_metadata=__w_pdfjs_require__(16),_optional_content_config=__w_pdfjs_require__(17),_transport_stream=__w_pdfjs_require__(18),_displayFetch_stream=__w_pdfjs_require__(19),_displayNetwork=__w_pdfjs_require__(22),_displayNode_stream=__w_pdfjs_require__(23),_displaySvg=__w_pdfjs_require__(24),_xfa_text=__w_pdfjs_require__(25);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3,DefaultCanvasFactory=_util.isNodeJS?_displayNode_utils.NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;const DefaultCMapReaderFactory=_util.isNodeJS?_displayNode_utils.NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;const DefaultFilterFactory=_util.isNodeJS?_displayNode_utils.NodeFilterFactory:_display_utils.DOMFilterFactory;exports.DefaultFilterFactory=DefaultFilterFactory;const DefaultStandardFontDataFactory=_util.isNodeJS?_displayNode_utils.NodeStandardFontDataFactory:_display_utils.DOMStandardFontDataFactory;exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory;function getDocument(d){if(typeof d=="string"||d instanceof URL?d={url:d}:(0,_util.isArrayBuffer)(d)&&(d={data:d}),typeof d!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!d.url&&!d.data&&!d.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const r=new PDFDocumentLoadingTask,{docId:f}=r,F=d.url?getUrlProp(d.url):null,C=d.data?getDataProp(d.data):null,X=d.httpHeaders||null,Y=d.withCredentials===!0,P=d.password??null,V=d.range instanceof PDFDataRangeTransport?d.range:null,ut=Number.isInteger(d.rangeChunkSize)&&d.rangeChunkSize>0?d.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let nt=d.worker instanceof PDFWorker?d.worker:null;const G=d.verbosity,at=typeof d.docBaseUrl=="string"&&!(0,_display_utils.isDataScheme)(d.docBaseUrl)?d.docBaseUrl:null,At=typeof d.cMapUrl=="string"?d.cMapUrl:null,Tt=d.cMapPacked!==!1,xt=d.CMapReaderFactory||DefaultCMapReaderFactory,v=typeof d.standardFontDataUrl=="string"?d.standardFontDataUrl:null,i=d.StandardFontDataFactory||DefaultStandardFontDataFactory,n=d.stopAtErrors!==!0,s=Number.isInteger(d.maxImageSize)&&d.maxImageSize>-1?d.maxImageSize:-1,o=d.isEvalSupported!==!1,h=typeof d.isOffscreenCanvasSupported=="boolean"?d.isOffscreenCanvasSupported:!_util.isNodeJS,A=Number.isInteger(d.canvasMaxAreaInBytes)?d.canvasMaxAreaInBytes:-1,x=typeof d.disableFontFace=="boolean"?d.disableFontFace:_util.isNodeJS,O=d.fontExtraProperties===!0,Q=d.enableXfa===!0,Z=d.ownerDocument||globalThis.document,it=d.disableRange===!0,lt=d.disableStream===!0,yt=d.disableAutoFetch===!0,dt=d.pdfBug===!0,kt=V?V.length:d.length??NaN,Ut=typeof d.useSystemFonts=="boolean"?d.useSystemFonts:!_util.isNodeJS&&!x,vt=typeof d.useWorkerFetch=="boolean"?d.useWorkerFetch:xt===_display_utils.DOMCMapReaderFactory&&i===_display_utils.DOMStandardFontDataFactory&&At&&v&&(0,_display_utils.isValidFetchUrl)(At,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(v,document.baseURI),Rt=d.canvasFactory||new DefaultCanvasFactory({ownerDocument:Z}),ft=d.filterFactory||new DefaultFilterFactory({docId:f,ownerDocument:Z}),K=null;(0,_util.setVerbosityLevel)(G);const $={canvasFactory:Rt,filterFactory:ft};if(vt||($.cMapReaderFactory=new xt({baseUrl:At,isCompressed:Tt}),$.standardFontDataFactory=new i({baseUrl:v})),!nt){const St={verbosity:G,port:_worker_options.GlobalWorkerOptions.workerPort};nt=St.port?PDFWorker.fromPort(St):new PDFWorker(St),r._worker=nt}const ht={docId:f,apiVersion:"3.11.174",data:C,password:P,disableAutoFetch:yt,rangeChunkSize:ut,length:kt,docBaseUrl:at,enableXfa:Q,evaluatorOptions:{maxImageSize:s,disableFontFace:x,ignoreErrors:n,isEvalSupported:o,isOffscreenCanvasSupported:h,canvasMaxAreaInBytes:A,fontExtraProperties:O,useSystemFonts:Ut,cMapUrl:vt?At:null,standardFontDataUrl:vt?v:null}},Ct={ignoreErrors:n,isEvalSupported:o,disableFontFace:x,fontExtraProperties:O,enableXfa:Q,ownerDocument:Z,disableAutoFetch:yt,pdfBug:dt,styleElement:K};return nt.promise.then(function(){if(r.destroyed)throw new Error("Loading aborted");const St=_fetchDocument(nt,ht),Wt=new Promise(function(Ht){let jt;V?jt=new _transport_stream.PDFDataTransportStream({length:kt,initialData:V.initialData,progressiveDone:V.progressiveDone,contentDispositionFilename:V.contentDispositionFilename,disableRange:it,disableStream:lt},V):C||(jt=(Gt=>_util.isNodeJS?new _displayNode_stream.PDFNodeStream(Gt):(0,_display_utils.isValidFetchUrl)(Gt.url)?new _displayFetch_stream.PDFFetchStream(Gt):new _displayNetwork.PDFNetworkStream(Gt))({url:F,length:kt,httpHeaders:X,withCredentials:Y,rangeChunkSize:ut,disableRange:it,disableStream:lt})),Ht(jt)});return Promise.all([St,Wt]).then(function([Ht,jt]){if(r.destroyed)throw new Error("Loading aborted");const Xt=new _message_handler.MessageHandler(f,Ht,nt.port),Gt=new WorkerTransport(Xt,r,jt,Ct,$);r._transport=Gt,Xt.send("Ready",null)})}).catch(r._capability.reject),r}async function _fetchDocument(d,r){if(d.destroyed)throw new Error("Worker was destroyed");const f=await d.messageHandler.sendWithPromise("GetDocRequest",r,r.data?[r.data.buffer]:null);if(d.destroyed)throw new Error("Worker was destroyed");return f}function getUrlProp(d){if(d instanceof URL)return d.href;try{return new URL(d,window.location).href}catch{if(_util.isNodeJS&&typeof d=="string")return d}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(d){if(_util.isNodeJS&&typeof Buffer<"u"&&d instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(d instanceof Uint8Array&&d.byteLength===d.buffer.byteLength)return d;if(typeof d=="string")return(0,_util.stringToBytes)(d);if(typeof d=="object"&&!isNaN(d?.length)||(0,_util.isArrayBuffer)(d))return new Uint8Array(d);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}const u=class u{constructor(){this._capability=new _util.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${pe(u,pt)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(r){throw this._worker?.port&&delete this._worker._pendingDestroy,r}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};pt=new WeakMap,D(u,pt,0);let PDFDocumentLoadingTask=u;exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(r,f,F=!1,C=null){this.length=r,this.initialData=f,this.progressiveDone=F,this.contentDispositionFilename=C,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new _util.PromiseCapability}addRangeListener(r){this._rangeListeners.push(r)}addProgressListener(r){this._progressListeners.push(r)}addProgressiveReadListener(r){this._progressiveReadListeners.push(r)}addProgressiveDoneListener(r){this._progressiveDoneListeners.push(r)}onDataRange(r,f){for(const F of this._rangeListeners)F(r,f)}onDataProgress(r,f){this._readyCapability.promise.then(()=>{for(const F of this._progressListeners)F(r,f)})}onDataProgressiveRead(r){this._readyCapability.promise.then(()=>{for(const f of this._progressiveReadListeners)f(r)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const r of this._progressiveDoneListeners)r()})}transportReady(){this._readyCapability.resolve()}requestDataRange(r,f){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(r,f){this._pdfInfo=r,this._transport=f,Object.defineProperty(this,"getJavaScript",{value:()=>((0,_display_utils.deprecated)("`PDFDocumentProxy.getJavaScript`, please use `PDFDocumentProxy.getJSActions` instead."),this.getJSActions().then(F=>{if(!F)return F;const C=[];for(const X in F)C.push(...F[X]);return C}))})}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(r){return this._transport.getPage(r)}getPageIndex(r){return this._transport.getPageIndex(r)}getDestinations(){return this._transport.getDestinations()}getDestination(r){return this._transport.getDestination(r)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(r=!1){return this._transport.startCleanup(r||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(r,f,F,C=!1){D(this,T);D(this,z);D(this,et,null);D(this,l,!1);this._pageIndex=r,this._pageInfo=f,this._transport=F,this._stats=C?new _display_utils.StatTimer:null,this._pdfBug=C,this.commonObjs=F.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:r,rotation:f=this.rotate,offsetX:F=0,offsetY:C=0,dontFlip:X=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:r,rotation:f,offsetX:F,offsetY:C,dontFlip:X})}getAnnotations({intent:r="display"}={}){const f=this._transport.getRenderingIntent(r);return this._transport.getAnnotations(this._pageIndex,f.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:r,viewport:f,intent:F="display",annotationMode:C=_util.AnnotationMode.ENABLE,transform:X=null,background:Y=null,optionalContentConfigPromise:P=null,annotationCanvasMap:V=null,pageColors:ut=null,printAnnotationStorage:nt=null}){this._stats?.time("Overall");const G=this._transport.getRenderingIntent(F,C,nt);J(this,l,!1),j(this,z,Se).call(this),P||(P=this._transport.getOptionalContentConfig());let at=this._intentStates.get(G.cacheKey);at||(at=Object.create(null),this._intentStates.set(G.cacheKey,at)),at.streamReaderCancelTimeout&&(clearTimeout(at.streamReaderCancelTimeout),at.streamReaderCancelTimeout=null);const At=!!(G.renderingIntent&_util.RenderingIntentFlag.PRINT);at.displayReadyCapability||(at.displayReadyCapability=new _util.PromiseCapability,at.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(G));const Tt=i=>{at.renderTasks.delete(xt),(this._maybeCleanupAfterRender||At)&&J(this,l,!0),j(this,T,le).call(this,!At),i?(xt.capability.reject(i),this._abortOperatorList({intentState:at,reason:i instanceof Error?i:new Error(i)})):xt.capability.resolve(),this._stats?.timeEnd("Rendering"),this._stats?.timeEnd("Overall")},xt=new InternalRenderTask({callback:Tt,params:{canvasContext:r,viewport:f,transform:X,background:Y},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:V,operatorList:at.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!At,pdfBug:this._pdfBug,pageColors:ut});(at.renderTasks||(at.renderTasks=new Set)).add(xt);const v=xt.task;return Promise.all([at.displayReadyCapability.promise,P]).then(([i,n])=>{if(this.destroyed){Tt();return}this._stats?.time("Rendering"),xt.initializeGraphics({transparency:i,optionalContentConfig:n}),xt.operatorListChanged()}).catch(Tt),v}getOperatorList({intent:r="display",annotationMode:f=_util.AnnotationMode.ENABLE,printAnnotationStorage:F=null}={}){function C(){Y.operatorList.lastChunk&&(Y.opListReadCapability.resolve(Y.operatorList),Y.renderTasks.delete(P))}const X=this._transport.getRenderingIntent(r,f,F,!0);let Y=this._intentStates.get(X.cacheKey);Y||(Y=Object.create(null),this._intentStates.set(X.cacheKey,Y));let P;return Y.opListReadCapability||(P=Object.create(null),P.operatorListChanged=C,Y.opListReadCapability=new _util.PromiseCapability,(Y.renderTasks||(Y.renderTasks=new Set)).add(P),Y.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(X)),Y.opListReadCapability.promise}streamTextContent({includeMarkedContent:r=!1,disableNormalization:f=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:r===!0,disableNormalization:f===!0},{highWaterMark:100,size(C){return C.items.length}})}getTextContent(r={}){if(this._transport._htmlForXfa)return this.getXfa().then(F=>_xfa_text.XfaText.textContent(F));const f=this.streamTextContent(r);return new Promise(function(F,C){function X(){Y.read().then(function({value:V,done:ut}){if(ut){F(P);return}Object.assign(P.styles,V.styles),P.items.push(...V.items),X()},C)}const Y=f.getReader(),P={items:[],styles:Object.create(null)};X()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const r=[];for(const f of this._intentStates.values())if(this._abortOperatorList({intentState:f,reason:new Error("Page was destroyed."),force:!0}),!f.opListReadCapability)for(const F of f.renderTasks)r.push(F.completed),F.cancel();return this.objs.clear(),J(this,l,!1),j(this,z,Se).call(this),Promise.all(r)}cleanup(r=!1){J(this,l,!0);const f=j(this,T,le).call(this,!1);return r&&f&&this._stats&&(this._stats=new _display_utils.StatTimer),f}_startRenderPage(r,f){const F=this._intentStates.get(f);F&&(this._stats?.timeEnd("Page Request"),F.displayReadyCapability?.resolve(r))}_renderPageChunk(r,f){for(let F=0,C=r.length;F<C;F++)f.operatorList.fnArray.push(r.fnArray[F]),f.operatorList.argsArray.push(r.argsArray[F]);f.operatorList.lastChunk=r.lastChunk,f.operatorList.separateAnnots=r.separateAnnots;for(const F of f.renderTasks)F.operatorListChanged();r.lastChunk&&j(this,T,le).call(this,!0)}_pumpOperatorList({renderingIntent:r,cacheKey:f,annotationStorageSerializable:F}){const{map:C,transfers:X}=F,P=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:r,cacheKey:f,annotationStorage:C},X).getReader(),V=this._intentStates.get(f);V.streamReader=P;const ut=()=>{P.read().then(({value:nt,done:G})=>{if(G){V.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(nt,V),ut())},nt=>{if(V.streamReader=null,!this._transport.destroyed){if(V.operatorList){V.operatorList.lastChunk=!0;for(const G of V.renderTasks)G.operatorListChanged();j(this,T,le).call(this,!0)}if(V.displayReadyCapability)V.displayReadyCapability.reject(nt);else if(V.opListReadCapability)V.opListReadCapability.reject(nt);else throw nt}})};ut()}_abortOperatorList({intentState:r,reason:f,force:F=!1}){if(r.streamReader){if(r.streamReaderCancelTimeout&&(clearTimeout(r.streamReaderCancelTimeout),r.streamReaderCancelTimeout=null),!F){if(r.renderTasks.size>0)return;if(f instanceof _display_utils.RenderingCancelledException){let C=RENDERING_CANCELLED_TIMEOUT;f.extraDelay>0&&f.extraDelay<1e3&&(C+=f.extraDelay),r.streamReaderCancelTimeout=setTimeout(()=>{r.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:r,reason:f,force:!0})},C);return}}if(r.streamReader.cancel(new _util.AbortException(f.message)).catch(()=>{}),r.streamReader=null,!this._transport.destroyed){for(const[C,X]of this._intentStates)if(X===r){this._intentStates.delete(C);break}this.cleanup()}}}get stats(){return this._stats}}et=new WeakMap,l=new WeakMap,T=new WeakSet,le=function(r=!1){if(j(this,z,Se).call(this),!t(this,l)||this.destroyed)return!1;if(r)return J(this,et,setTimeout(()=>{J(this,et,null),j(this,T,le).call(this,!1)},DELAYED_CLEANUP_TIMEOUT)),!1;for(const{renderTasks:f,operatorList:F}of this._intentStates.values())if(f.size>0||!F.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),J(this,l,!1),!0},z=new WeakSet,Se=function(){t(this,et)&&(clearTimeout(t(this,et)),J(this,et,null))},exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){D(this,B,new Set);D(this,k,Promise.resolve())}postMessage(r,f){const F={data:structuredClone(r,f?{transfer:f}:null)};t(this,k).then(()=>{for(const C of t(this,B))C.call(this,F)})}addEventListener(r,f){t(this,B).add(f)}removeEventListener(r,f){t(this,B).delete(f)}terminate(){t(this,B).clear()}}B=new WeakMap,k=new WeakMap,exports.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports.PDFWorkerUtil=PDFWorkerUtil;{if(_util.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const d=document?.currentScript?.src;d&&(PDFWorkerUtil.fallbackWorkerSrc=d.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(d,r){let f;try{if(f=new URL(d),!f.origin||f.origin==="null")return!1}catch{return!1}const F=new URL(r,f);return f.origin===F.origin},PDFWorkerUtil.createCDNWrapper=function(d){const r=`importScripts("${d}");`;return URL.createObjectURL(new Blob([r]))}}const _PDFWorker=class _PDFWorker{constructor({name:d=null,port:r=null,verbosity:f=(0,_util.getVerbosityLevel)()}={}){if(this.name=d,this.destroyed=!1,this.verbosity=f,this._readyCapability=new _util.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,r){if(t(_PDFWorker,g)?.has(r))throw new Error("Cannot use more than one PDFWorker per port.");(t(_PDFWorker,g)||J(_PDFWorker,g,new WeakMap)).set(r,this),this._initializeFromPort(r);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(d){this._port=d,this._messageHandler=new _message_handler.MessageHandler("main","worker",d),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!_PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:d}=_PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,d)||(d=PDFWorkerUtil.createCDNWrapper(new URL(d,window.location).href));const r=new Worker(d),f=new _message_handler.MessageHandler("main","worker",r),F=()=>{r.removeEventListener("error",C),f.destroy(),r.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},C=()=>{this._webWorker||F()};r.addEventListener("error",C),f.on("test",Y=>{if(r.removeEventListener("error",C),this.destroyed){F();return}Y?(this._messageHandler=f,this._port=r,this._webWorker=r,this._readyCapability.resolve(),f.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),f.destroy(),r.terminate())}),f.on("ready",Y=>{if(r.removeEventListener("error",C),this.destroyed){F();return}try{X()}catch{this._setupFakeWorker()}});const X=()=>{const Y=new Uint8Array;f.send("test",Y,[Y.buffer])};X();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),_PDFWorker._setupFakeWorkerGlobal.then(d=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const r=new LoopbackPort;this._port=r;const f=`fake${PDFWorkerUtil.fakeWorkerId++}`,F=new _message_handler.MessageHandler(f+"_worker",f,r);d.setup(F,r);const C=new _message_handler.MessageHandler(f,f+"_worker",r);this._messageHandler=C,this._readyCapability.resolve(),C.send("configure",{verbosity:this.verbosity})}).catch(d=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${d.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),t(_PDFWorker,g)?.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(d){if(!d?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");const r=t(this,g)?.get(d.port);if(r){if(r._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return r}return new _PDFWorker(d)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _util.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_util.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}};g=new WeakMap,D(_PDFWorker,g,void 0);let PDFWorker=_PDFWorker;exports.PDFWorker=PDFWorker;class WorkerTransport{constructor(r,f,F,C,X){D(this,y);D(this,L,new Map);D(this,N,new Map);D(this,M,new Map);D(this,S,null);this.messageHandler=r,this.loadingTask=f,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({ownerDocument:C.ownerDocument,styleElement:C.styleElement}),this._params=C,this.canvasFactory=X.canvasFactory,this.filterFactory=X.filterFactory,this.cMapReaderFactory=X.cMapReaderFactory,this.standardFontDataFactory=X.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=F,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new _util.PromiseCapability,this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(r,f=_util.AnnotationMode.ENABLE,F=null,C=!1){let X=_util.RenderingIntentFlag.DISPLAY,Y=_annotation_storage.SerializableEmpty;switch(r){case"any":X=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":X=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${r}`)}switch(f){case _util.AnnotationMode.DISABLE:X+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:X+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:X+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,Y=(X&_util.RenderingIntentFlag.PRINT&&F instanceof _annotation_storage.PrintAnnotationStorage?F:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${f}`)}return C&&(X+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:X,cacheKey:`${X}_${Y.hash}`,annotationStorageSerializable:Y}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new _util.PromiseCapability,t(this,S)?.reject(new Error("Worker was destroyed during onPassword callback"));const r=[];for(const F of t(this,N).values())r.push(F._destroy());t(this,N).clear(),t(this,M).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const f=this.messageHandler.sendWithPromise("Terminate",null);return r.push(f),Promise.all(r).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),t(this,L).clear(),this.filterFactory.destroy(),this._networkStream?.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:r,loadingTask:f}=this;r.on("GetReader",(F,C)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=X=>{this._lastProgress={loaded:X.loaded,total:X.total}},C.onPull=()=>{this._fullReader.read().then(function({value:X,done:Y}){if(Y){C.close();return}(0,_util.assert)(X instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),C.enqueue(new Uint8Array(X),1,[X])}).catch(X=>{C.error(X)})},C.onCancel=X=>{this._fullReader.cancel(X),C.ready.catch(Y=>{if(!this.destroyed)throw Y})}}),r.on("ReaderHeadersReady",F=>{const C=new _util.PromiseCapability,X=this._fullReader;return X.headersReady.then(()=>{(!X.isStreamingSupported||!X.isRangeSupported)&&(this._lastProgress&&f.onProgress?.(this._lastProgress),X.onProgress=Y=>{f.onProgress?.({loaded:Y.loaded,total:Y.total})}),C.resolve({isStreamingSupported:X.isStreamingSupported,isRangeSupported:X.isRangeSupported,contentLength:X.contentLength})},C.reject),C.promise}),r.on("GetRangeReader",(F,C)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const X=this._networkStream.getRangeReader(F.begin,F.end);if(!X){C.close();return}C.onPull=()=>{X.read().then(function({value:Y,done:P}){if(P){C.close();return}(0,_util.assert)(Y instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),C.enqueue(new Uint8Array(Y),1,[Y])}).catch(Y=>{C.error(Y)})},C.onCancel=Y=>{X.cancel(Y),C.ready.catch(P=>{if(!this.destroyed)throw P})}}),r.on("GetDoc",({pdfInfo:F})=>{this._numPages=F.numPages,this._htmlForXfa=F.htmlForXfa,delete F.htmlForXfa,f._capability.resolve(new PDFDocumentProxy(F,this))}),r.on("DocException",function(F){let C;switch(F.name){case"PasswordException":C=new _util.PasswordException(F.message,F.code);break;case"InvalidPDFException":C=new _util.InvalidPDFException(F.message);break;case"MissingPDFException":C=new _util.MissingPDFException(F.message);break;case"UnexpectedResponseException":C=new _util.UnexpectedResponseException(F.message,F.status);break;case"UnknownErrorException":C=new _util.UnknownErrorException(F.message,F.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}f._capability.reject(C)}),r.on("PasswordRequest",F=>{if(J(this,S,new _util.PromiseCapability),f.onPassword){const C=X=>{X instanceof Error?t(this,S).reject(X):t(this,S).resolve({password:X})};try{f.onPassword(C,F.code)}catch(X){t(this,S).reject(X)}}else t(this,S).reject(new _util.PasswordException(F.message,F.code));return t(this,S).promise}),r.on("DataLoaded",F=>{f.onProgress?.({loaded:F.length,total:F.length}),this.downloadInfoCapability.resolve(F)}),r.on("StartRenderPage",F=>{if(this.destroyed)return;t(this,N).get(F.pageIndex)._startRenderPage(F.transparency,F.cacheKey)}),r.on("commonobj",([F,C,X])=>{if(!this.destroyed&&!this.commonObjs.has(F))switch(C){case"Font":const Y=this._params;if("error"in X){const ut=X.error;(0,_util.warn)(`Error during font loading: ${ut}`),this.commonObjs.resolve(F,ut);break}const P=Y.pdfBug&&globalThis.FontInspector?.enabled?(ut,nt)=>globalThis.FontInspector.fontAdded(ut,nt):null,V=new _font_loader.FontFaceObject(X,{isEvalSupported:Y.isEvalSupported,disableFontFace:Y.disableFontFace,ignoreErrors:Y.ignoreErrors,inspectFont:P});this.fontLoader.bind(V).catch(ut=>r.sendWithPromise("FontFallback",{id:F})).finally(()=>{!Y.fontExtraProperties&&V.data&&(V.data=null),this.commonObjs.resolve(F,V)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(F,X);break;default:throw new Error(`Got unknown common object type ${C}`)}}),r.on("obj",([F,C,X,Y])=>{if(this.destroyed)return;const P=t(this,N).get(C);if(!P.objs.has(F))switch(X){case"Image":if(P.objs.resolve(F,Y),Y){let V;if(Y.bitmap){const{width:ut,height:nt}=Y;V=ut*nt*4}else V=Y.data?.length||0;V>_util.MAX_IMAGE_SIZE_TO_CACHE&&(P._maybeCleanupAfterRender=!0)}break;case"Pattern":P.objs.resolve(F,Y);break;default:throw new Error(`Got unknown object type ${X}`)}}),r.on("DocProgress",F=>{this.destroyed||f.onProgress?.({loaded:F.loaded,total:F.total})}),r.on("FetchBuiltInCMap",F=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(F):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),r.on("FetchStandardFontData",F=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(F):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:r,transfers:f}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:r,filename:this._fullReader?.filename??null},f).finally(()=>{this.annotationStorage.resetModified()})}getPage(r){if(!Number.isInteger(r)||r<=0||r>this._numPages)return Promise.reject(new Error("Invalid page request."));const f=r-1,F=t(this,M).get(f);if(F)return F;const C=this.messageHandler.sendWithPromise("GetPage",{pageIndex:f}).then(X=>{if(this.destroyed)throw new Error("Transport destroyed");const Y=new PDFPageProxy(f,X,this,this._params.pdfBug);return t(this,N).set(f,Y),Y});return t(this,M).set(f,C),C}getPageIndex(r){return typeof r!="object"||r===null||!Number.isInteger(r.num)||r.num<0||!Number.isInteger(r.gen)||r.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:r.num,gen:r.gen})}getAnnotations(r,f){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:r,intent:f})}getFieldObjects(){return j(this,y,Ee).call(this,"GetFieldObjects")}hasJSActions(){return j(this,y,Ee).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(r){return typeof r!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:r})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return j(this,y,Ee).call(this,"GetDocJSActions")}getPageJSActions(r){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:r})}getStructTree(r){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:r})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(r=>new _optional_content_config.OptionalContentConfig(r))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const r="GetMetadata",f=t(this,L).get(r);if(f)return f;const F=this.messageHandler.sendWithPromise(r,null).then(C=>({info:C[0],metadata:C[1]?new _metadata.Metadata(C[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return t(this,L).set(r,F),F}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(r=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const f of t(this,N).values())if(!f.cleanup())throw new Error(`startCleanup: Page ${f.pageNumber} is currently rendering.`);this.commonObjs.clear(),r||this.fontLoader.clear(),t(this,L).clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:r,enableXfa:f}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:r,enableXfa:f})}}L=new WeakMap,N=new WeakMap,M=new WeakMap,S=new WeakMap,y=new WeakSet,Ee=function(r,f=null){const F=t(this,L).get(r);if(F)return F;const C=this.messageHandler.sendWithPromise(r,f);return t(this,L).set(r,C),C};class PDFObjects{constructor(){D(this,E);D(this,m,Object.create(null))}get(r,f=null){if(f){const C=j(this,E,Ne).call(this,r);return C.capability.promise.then(()=>f(C.data)),null}const F=t(this,m)[r];if(!F?.capability.settled)throw new Error(`Requesting object that isn't resolved yet ${r}.`);return F.data}has(r){return t(this,m)[r]?.capability.settled||!1}resolve(r,f=null){const F=j(this,E,Ne).call(this,r);F.data=f,F.capability.resolve()}clear(){for(const r in t(this,m)){const{data:f}=t(this,m)[r];f?.bitmap?.close()}J(this,m,Object.create(null))}}m=new WeakMap,E=new WeakSet,Ne=function(r){var f;return(f=t(this,m))[r]||(f[r]={capability:new _util.PromiseCapability,data:null})};class RenderTask{constructor(r){D(this,_,null);J(this,_,r),this.onContinue=null}get promise(){return t(this,_).capability.promise}cancel(r=0){t(this,_).cancel(null,r)}get separateAnnots(){const{separateAnnots:r}=t(this,_).operatorList;if(!r)return!1;const{annotationCanvasMap:f}=t(this,_);return r.form||r.canvas&&f?.size>0}}_=new WeakMap,exports.RenderTask=RenderTask;const c=class c{constructor({callback:r,params:f,objs:F,commonObjs:C,annotationCanvasMap:X,operatorList:Y,pageIndex:P,canvasFactory:V,filterFactory:ut,useRequestAnimationFrame:nt=!1,pdfBug:G=!1,pageColors:at=null}){this.callback=r,this.params=f,this.objs=F,this.commonObjs=C,this.annotationCanvasMap=X,this.operatorListIdx=null,this.operatorList=Y,this._pageIndex=P,this.canvasFactory=V,this.filterFactory=ut,this._pdfBug=G,this.pageColors=at,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=nt===!0&&typeof window<"u",this.cancelled=!1,this.capability=new _util.PromiseCapability,this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=f.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:r=!1,optionalContentConfig:f}){if(this.cancelled)return;if(this._canvas){if(t(c,a).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");t(c,a).add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:F,viewport:C,transform:X,background:Y}=this.params;this.gfx=new _canvas.CanvasGraphics(F,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:f},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:X,viewport:C,transparency:r,background:Y}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(r=null,f=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),t(c,a).delete(this._canvas),this.callback(r||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,f))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),t(c,a).delete(this._canvas),this.callback())))}};a=new WeakMap,D(c,a,new WeakSet);let InternalRenderTask=c;const version="3.11.174";exports.version=version;const build="ce8716743";exports.build=build},(pt,u,et)=>{var k,g,L,Ai,M;Object.defineProperty(u,"__esModule",{value:!0}),u.SerializableEmpty=u.PrintAnnotationStorage=u.AnnotationStorage=void 0;var l=et(1),T=et(4),rt=et(8);const z=Object.freeze({map:null,hash:"",transfers:void 0});u.SerializableEmpty=z;class gt{constructor(){D(this,L);D(this,k,!1);D(this,g,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(y,p){const m=t(this,g).get(y);return m===void 0?p:Object.assign(p,m)}getRawValue(y){return t(this,g).get(y)}remove(y){if(t(this,g).delete(y),t(this,g).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const p of t(this,g).values())if(p instanceof T.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(y,p){const m=t(this,g).get(y);let E=!1;if(m!==void 0)for(const[w,_]of Object.entries(p))m[w]!==_&&(E=!0,m[w]=_);else E=!0,t(this,g).set(y,p);E&&j(this,L,Ai).call(this),p instanceof T.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(p.constructor._type)}has(y){return t(this,g).has(y)}getAll(){return t(this,g).size>0?(0,l.objectFromMap)(t(this,g)):null}setAll(y){for(const[p,m]of Object.entries(y))this.setValue(p,m)}get size(){return t(this,g).size}resetModified(){t(this,k)&&(J(this,k,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new B(this)}get serializable(){if(t(this,g).size===0)return z;const y=new Map,p=new rt.MurmurHash3_64,m=[],E=Object.create(null);let w=!1;for(const[_,a]of t(this,g)){const c=a instanceof T.AnnotationEditor?a.serialize(!1,E):a;c&&(y.set(_,c),p.update(`${_}:${JSON.stringify(c)}`),w||(w=!!c.bitmap))}if(w)for(const _ of y.values())_.bitmap&&m.push(_.bitmap);return y.size>0?{map:y,hash:p.hexdigest(),transfers:m}:z}}k=new WeakMap,g=new WeakMap,L=new WeakSet,Ai=function(){t(this,k)||(J(this,k,!0),typeof this.onSetModified=="function"&&this.onSetModified())},u.AnnotationStorage=gt;class B extends gt{constructor(p){super();D(this,M,void 0);const{map:m,hash:E,transfers:w}=p.serializable,_=structuredClone(m,w?{transfer:w}:null);J(this,M,{map:_,hash:E,transfers:w})}get print(){(0,l.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return t(this,M)}}M=new WeakMap,u.PrintAnnotationStorage=B},(pt,u,et)=>{var B,k,g,L,N,M,S,y,p,m,E,w,_,a,c,Be,r,Ue,F,je,X,He,P,yi,ut,vi,G,Si,At,We,xt,Ei;Object.defineProperty(u,"__esModule",{value:!0}),u.AnnotationEditor=void 0;var l=et(5),T=et(1),rt=et(6);const i=class i{constructor(s){D(this,c);D(this,r);D(this,X);D(this,P);D(this,ut);D(this,G);D(this,At);D(this,xt);D(this,B,"");D(this,k,!1);D(this,g,null);D(this,L,null);D(this,N,null);D(this,M,!1);D(this,S,null);D(this,y,this.focusin.bind(this));D(this,p,this.focusout.bind(this));D(this,m,!1);D(this,E,!1);D(this,w,!1);Zt(this,"_initialOptions",Object.create(null));Zt(this,"_uiManager",null);Zt(this,"_focusEventsAllowed",!0);Zt(this,"_l10nPromise",null);D(this,_,!1);D(this,a,i._zIndex++);this.constructor===i&&(0,T.unreachable)("Cannot initialize AnnotationEditor."),this.parent=s.parent,this.id=s.id,this.width=this.height=null,this.pageIndex=s.parent.pageIndex,this.name=s.name,this.div=null,this._uiManager=s.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=s.isCentered,this._structTreeParentId=null;const{rotation:o,rawDims:{pageWidth:h,pageHeight:A,pageX:x,pageY:O}}=this.parent.viewport;this.rotation=o,this.pageRotation=(360+o-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[h,A],this.pageTranslation=[x,O];const[Q,Z]=this.parentDimensions;this.x=s.x/Q,this.y=s.y/Z,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,T.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(s){const o=new gt({id:s.parent.getNextId(),parent:s.parent,uiManager:s._uiManager});o.annotationElementId=s.annotationElementId,o.deleted=!0,o._uiManager.addToAnnotationStorage(o)}static initialize(s,o=null){if(i._l10nPromise||(i._l10nPromise=new Map(["editor_alt_text_button_label","editor_alt_text_edit_button_label","editor_alt_text_decorative_tooltip"].map(A=>[A,s.get(A)]))),o?.strings)for(const A of o.strings)i._l10nPromise.set(A,s.get(A));if(i._borderLineWidth!==-1)return;const h=getComputedStyle(document.documentElement);i._borderLineWidth=parseFloat(h.getPropertyValue("--outline-width"))||0}static updateDefaultParams(s,o){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(s){return!1}static paste(s,o){(0,T.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return t(this,_)}set _isDraggable(s){J(this,_,s),this.div?.classList.toggle("draggable",s)}center(){const[s,o]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*o/(s*2),this.y+=this.width*s/(o*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*o/(s*2),this.y-=this.width*s/(o*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(s){this._uiManager.addCommands(s)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=t(this,a)}setParent(s){s!==null&&(this.pageIndex=s.pageIndex,this.pageDimensions=s.pageDimensions),this.parent=s}focusin(s){this._focusEventsAllowed&&(t(this,m)?J(this,m,!1):this.parent.setSelected(this))}focusout(s){!this._focusEventsAllowed||!this.isAttachedToDOM||s.relatedTarget?.closest(`#${this.id}`)||(s.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(s,o,h,A){const[x,O]=this.parentDimensions;[h,A]=this.screenToPageTranslation(h,A),this.x=(s+h)/x,this.y=(o+A)/O,this.fixAndSetPosition()}translate(s,o){j(this,c,Be).call(this,this.parentDimensions,s,o)}translateInPage(s,o){j(this,c,Be).call(this,this.pageDimensions,s,o),this.div.scrollIntoView({block:"nearest"})}drag(s,o){const[h,A]=this.parentDimensions;if(this.x+=s/h,this.y+=o/A,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:it,y:lt}=this.div.getBoundingClientRect();this.parent.findNewParent(this,it,lt)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x,y:O}=this;const[Q,Z]=j(this,r,Ue).call(this);x+=Q,O+=Z,this.div.style.left=`${(100*x).toFixed(2)}%`,this.div.style.top=`${(100*O).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}fixAndSetPosition(){const[s,o]=this.pageDimensions;let{x:h,y:A,width:x,height:O}=this;switch(x*=s,O*=o,h*=s,A*=o,this.rotation){case 0:h=Math.max(0,Math.min(s-x,h)),A=Math.max(0,Math.min(o-O,A));break;case 90:h=Math.max(0,Math.min(s-O,h)),A=Math.min(o,Math.max(x,A));break;case 180:h=Math.min(s,Math.max(x,h)),A=Math.min(o,Math.max(O,A));break;case 270:h=Math.min(s,Math.max(O,h)),A=Math.max(0,Math.min(o-x,A));break}this.x=h/=s,this.y=A/=o;const[Q,Z]=j(this,r,Ue).call(this);h+=Q,A+=Z;const{style:it}=this.div;it.left=`${(100*h).toFixed(2)}%`,it.top=`${(100*A).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(s,o){var h;return j(h=i,F,je).call(h,s,o,this.parentRotation)}pageTranslationToScreen(s,o){var h;return j(h=i,F,je).call(h,s,o,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:s,pageDimensions:[o,h]}=this,A=o*s,x=h*s;return T.FeatureTest.isCSSRoundSupported?[Math.round(A),Math.round(x)]:[A,x]}setDims(s,o){const[h,A]=this.parentDimensions;this.div.style.width=`${(100*s/h).toFixed(2)}%`,t(this,M)||(this.div.style.height=`${(100*o/A).toFixed(2)}%`),t(this,g)?.classList.toggle("small",s<i.SMALL_EDITOR_SIZE||o<i.SMALL_EDITOR_SIZE)}fixDims(){const{style:s}=this.div,{height:o,width:h}=s,A=h.endsWith("%"),x=!t(this,M)&&o.endsWith("%");if(A&&x)return;const[O,Q]=this.parentDimensions;A||(s.width=`${(100*parseFloat(h)/O).toFixed(2)}%`),!t(this,M)&&!x&&(s.height=`${(100*parseFloat(o)/Q).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}async addAltTextButton(){if(t(this,g))return;const s=J(this,g,document.createElement("button"));s.className="altText";const o=await i._l10nPromise.get("editor_alt_text_button_label");s.textContent=o,s.setAttribute("aria-label",o),s.tabIndex="0",s.addEventListener("contextmenu",rt.noContextMenu),s.addEventListener("pointerdown",h=>h.stopPropagation()),s.addEventListener("click",h=>{h.preventDefault(),this._uiManager.editAltText(this)},{capture:!0}),s.addEventListener("keydown",h=>{h.target===s&&h.key==="Enter"&&(h.preventDefault(),this._uiManager.editAltText(this))}),j(this,At,We).call(this),this.div.append(s),i.SMALL_EDITOR_SIZE||(i.SMALL_EDITOR_SIZE=Math.min(128,Math.round(s.getBoundingClientRect().width*1.4)))}getClientDimensions(){return this.div.getBoundingClientRect()}get altTextData(){return{altText:t(this,B),decorative:t(this,k)}}set altTextData({altText:s,decorative:o}){t(this,B)===s&&t(this,k)===o||(J(this,B,s),J(this,k,o),j(this,At,We).call(this))}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",t(this,y)),this.div.addEventListener("focusout",t(this,p));const[s,o]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*o/s).toFixed(2)}%`,this.div.style.maxHeight=`${(100*s/o).toFixed(2)}%`);const[h,A]=this.getInitialTranslation();return this.translate(h,A),(0,l.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(s){const{isMac:o}=T.FeatureTest.platform;if(s.button!==0||s.ctrlKey&&o){s.preventDefault();return}J(this,m,!0),j(this,xt,Ei).call(this,s)}moveInDOM(){this.parent?.moveEditorInDOM(this)}_setParentAndPosition(s,o,h){s.changeParent(this),this.x=o,this.y=h,this.fixAndSetPosition()}getRect(s,o){const h=this.parentScale,[A,x]=this.pageDimensions,[O,Q]=this.pageTranslation,Z=s/h,it=o/h,lt=this.x*A,yt=this.y*x,dt=this.width*A,kt=this.height*x;switch(this.rotation){case 0:return[lt+Z+O,x-yt-it-kt+Q,lt+Z+dt+O,x-yt-it+Q];case 90:return[lt+it+O,x-yt+Z+Q,lt+it+kt+O,x-yt+Z+dt+Q];case 180:return[lt-Z-dt+O,x-yt+it+Q,lt-Z+O,x-yt+it+kt+Q];case 270:return[lt-it-kt+O,x-yt-Z-dt+Q,lt-it+O,x-yt-Z+Q];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(s,o){const[h,A,x,O]=s,Q=x-h,Z=O-A;switch(this.rotation){case 0:return[h,o-O,Q,Z];case 90:return[h,o-A,Z,Q];case 180:return[x,o-A,Q,Z];case 270:return[x,o-O,Z,Q];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){J(this,w,!0)}disableEditMode(){J(this,w,!1)}isInEditMode(){return t(this,w)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){this.div?.addEventListener("focusin",t(this,y)),this.div?.addEventListener("focusout",t(this,p))}serialize(s=!1,o=null){(0,T.unreachable)("An editor must be serializable")}static deserialize(s,o,h){const A=new this.prototype.constructor({parent:o,id:o.getNextId(),uiManager:h});A.rotation=s.rotation;const[x,O]=A.pageDimensions,[Q,Z,it,lt]=A.getRectInCurrentCoords(s.rect,O);return A.x=Q/x,A.y=Z/O,A.width=it/x,A.height=lt/O,A}remove(){this.div.removeEventListener("focusin",t(this,y)),this.div.removeEventListener("focusout",t(this,p)),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),t(this,g)?.remove(),J(this,g,null),J(this,L,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(j(this,P,yi).call(this),t(this,S).classList.remove("hidden"))}select(){this.makeResizable(),this.div?.classList.add("selectedEditor")}unselect(){t(this,S)?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus()}updateParams(s,o){}disableEditing(){t(this,g)&&(t(this,g).hidden=!0)}enableEditing(){t(this,g)&&(t(this,g).hidden=!1)}enterInEditMode(){}get contentDiv(){return this.div}get isEditing(){return t(this,E)}set isEditing(s){J(this,E,s),this.parent&&(s?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(s,o){J(this,M,!0);const h=s/o,{style:A}=this.div;A.aspectRatio=h,A.height="auto"}static get MIN_SIZE(){return 16}};B=new WeakMap,k=new WeakMap,g=new WeakMap,L=new WeakMap,N=new WeakMap,M=new WeakMap,S=new WeakMap,y=new WeakMap,p=new WeakMap,m=new WeakMap,E=new WeakMap,w=new WeakMap,_=new WeakMap,a=new WeakMap,c=new WeakSet,Be=function([s,o],h,A){[h,A]=this.screenToPageTranslation(h,A),this.x+=h/s,this.y+=A/o,this.fixAndSetPosition()},r=new WeakSet,Ue=function(){const[s,o]=this.parentDimensions,{_borderLineWidth:h}=i,A=h/s,x=h/o;switch(this.rotation){case 90:return[-A,x];case 180:return[A,x];case 270:return[A,-x];default:return[-A,-x]}},F=new WeakSet,je=function(s,o,h){switch(h){case 90:return[o,-s];case 180:return[-s,-o];case 270:return[-o,s];default:return[s,o]}},X=new WeakSet,He=function(s){switch(s){case 90:{const[o,h]=this.pageDimensions;return[0,-o/h,h/o,0]}case 180:return[-1,0,0,-1];case 270:{const[o,h]=this.pageDimensions;return[0,o/h,-h/o,0]}default:return[1,0,0,1]}},P=new WeakSet,yi=function(){if(t(this,S))return;J(this,S,document.createElement("div")),t(this,S).classList.add("resizers");const s=["topLeft","topRight","bottomRight","bottomLeft"];this._willKeepAspectRatio||s.push("topMiddle","middleRight","bottomMiddle","middleLeft");for(const o of s){const h=document.createElement("div");t(this,S).append(h),h.classList.add("resizer",o),h.addEventListener("pointerdown",j(this,ut,vi).bind(this,o)),h.addEventListener("contextmenu",rt.noContextMenu)}this.div.prepend(t(this,S))},ut=new WeakSet,vi=function(s,o){o.preventDefault();const{isMac:h}=T.FeatureTest.platform;if(o.button!==0||o.ctrlKey&&h)return;const A=j(this,G,Si).bind(this,s),x=this._isDraggable;this._isDraggable=!1;const O={passive:!0,capture:!0};window.addEventListener("pointermove",A,O);const Q=this.x,Z=this.y,it=this.width,lt=this.height,yt=this.parent.div.style.cursor,dt=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(o.target).cursor;const kt=()=>{this._isDraggable=x,window.removeEventListener("pointerup",kt),window.removeEventListener("blur",kt),window.removeEventListener("pointermove",A,O),this.parent.div.style.cursor=yt,this.div.style.cursor=dt;const Ut=this.x,vt=this.y,Rt=this.width,ft=this.height;Ut===Q&&vt===Z&&Rt===it&&ft===lt||this.addCommands({cmd:()=>{this.width=Rt,this.height=ft,this.x=Ut,this.y=vt;const[K,$]=this.parentDimensions;this.setDims(K*Rt,$*ft),this.fixAndSetPosition()},undo:()=>{this.width=it,this.height=lt,this.x=Q,this.y=Z;const[K,$]=this.parentDimensions;this.setDims(K*it,$*lt),this.fixAndSetPosition()},mustExec:!0})};window.addEventListener("pointerup",kt),window.addEventListener("blur",kt)},G=new WeakSet,Si=function(s,o){const[h,A]=this.parentDimensions,x=this.x,O=this.y,Q=this.width,Z=this.height,it=i.MIN_SIZE/h,lt=i.MIN_SIZE/A,yt=mt=>Math.round(mt*1e4)/1e4,dt=j(this,X,He).call(this,this.rotation),kt=(mt,_t)=>[dt[0]*mt+dt[2]*_t,dt[1]*mt+dt[3]*_t],Ut=j(this,X,He).call(this,360-this.rotation),vt=(mt,_t)=>[Ut[0]*mt+Ut[2]*_t,Ut[1]*mt+Ut[3]*_t];let Rt,ft,K=!1,$=!1;switch(s){case"topLeft":K=!0,Rt=(mt,_t)=>[0,0],ft=(mt,_t)=>[mt,_t];break;case"topMiddle":Rt=(mt,_t)=>[mt/2,0],ft=(mt,_t)=>[mt/2,_t];break;case"topRight":K=!0,Rt=(mt,_t)=>[mt,0],ft=(mt,_t)=>[0,_t];break;case"middleRight":$=!0,Rt=(mt,_t)=>[mt,_t/2],ft=(mt,_t)=>[0,_t/2];break;case"bottomRight":K=!0,Rt=(mt,_t)=>[mt,_t],ft=(mt,_t)=>[0,0];break;case"bottomMiddle":Rt=(mt,_t)=>[mt/2,_t],ft=(mt,_t)=>[mt/2,0];break;case"bottomLeft":K=!0,Rt=(mt,_t)=>[0,_t],ft=(mt,_t)=>[mt,0];break;case"middleLeft":$=!0,Rt=(mt,_t)=>[0,_t/2],ft=(mt,_t)=>[mt,_t/2];break}const ht=Rt(Q,Z),Ct=ft(Q,Z);let St=kt(...Ct);const Wt=yt(x+St[0]),Ht=yt(O+St[1]);let jt=1,Xt=1,[Gt,qt]=this.screenToPageTranslation(o.movementX,o.movementY);if([Gt,qt]=vt(Gt/h,qt/A),K){const mt=Math.hypot(Q,Z);jt=Xt=Math.max(Math.min(Math.hypot(Ct[0]-ht[0]-Gt,Ct[1]-ht[1]-qt)/mt,1/Q,1/Z),it/Q,lt/Z)}else $?jt=Math.max(it,Math.min(1,Math.abs(Ct[0]-ht[0]-Gt)))/Q:Xt=Math.max(lt,Math.min(1,Math.abs(Ct[1]-ht[1]-qt)))/Z;const zt=yt(Q*jt),ot=yt(Z*Xt);St=kt(...ft(zt,ot));const tt=Wt-St[0],H=Ht-St[1];this.width=zt,this.height=ot,this.x=tt,this.y=H,this.setDims(h*zt,A*ot),this.fixAndSetPosition()},At=new WeakSet,We=async function(){const s=t(this,g);if(!s)return;if(!t(this,B)&&!t(this,k)){s.classList.remove("done"),t(this,L)?.remove();return}i._l10nPromise.get("editor_alt_text_edit_button_label").then(h=>{s.setAttribute("aria-label",h)});let o=t(this,L);if(!o){J(this,L,o=document.createElement("span")),o.className="tooltip",o.setAttribute("role","tooltip");const h=o.id=`alt-text-tooltip-${this.id}`;s.setAttribute("aria-describedby",h);const A=100;s.addEventListener("mouseenter",()=>{J(this,N,setTimeout(()=>{J(this,N,null),t(this,L).classList.add("show"),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"alt_text_tooltip"}}})},A))}),s.addEventListener("mouseleave",()=>{clearTimeout(t(this,N)),J(this,N,null),t(this,L)?.classList.remove("show")})}s.classList.add("done"),o.innerText=t(this,k)?await i._l10nPromise.get("editor_alt_text_decorative_tooltip"):t(this,B),o.parentNode||s.append(o)},xt=new WeakSet,Ei=function(s){if(!this._isDraggable)return;const o=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let h,A;o&&(h={passive:!0,capture:!0},A=O=>{const[Q,Z]=this.screenToPageTranslation(O.movementX,O.movementY);this._uiManager.dragSelectedEditors(Q,Z)},window.addEventListener("pointermove",A,h));const x=()=>{if(window.removeEventListener("pointerup",x),window.removeEventListener("blur",x),o&&window.removeEventListener("pointermove",A,h),J(this,m,!1),!this._uiManager.endDragSession()){const{isMac:O}=T.FeatureTest.platform;s.ctrlKey&&!O||s.shiftKey||s.metaKey&&O?this.parent.toggleSelected(this):this.parent.setSelected(this)}};window.addEventListener("pointerup",x),window.addEventListener("blur",x)},D(i,F),Zt(i,"_borderLineWidth",-1),Zt(i,"_colorManager",new l.ColorManager),Zt(i,"_zIndex",1),Zt(i,"SMALL_EDITOR_SIZE",0);let z=i;u.AnnotationEditor=z;class gt extends z{constructor(s){super(s),this.annotationElementId=s.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},(pt,u,et)=>{var M,S,y,p,m,Ge,_,a,c,d,r,wi,C,X,Y,P,V,ut,nt,G,at,At,Tt,xt,v,i,n,s,o,h,A,x,O,Q,Z,it,lt,yt,dt,kt,Ut,vt,Rt,ft,K,$,ht,Ci,St,ze,Ht,Xe,Xt,we,qt,qe,ot,Ve,H,ne,_t,ge,Jt,Ti,Et,xi,wt,$e,Bt,me,bt,Ye;Object.defineProperty(u,"__esModule",{value:!0}),u.KeyboardManager=u.CommandManager=u.ColorManager=u.AnnotationEditorUIManager=void 0,u.bindEvents=rt,u.opacityToHex=z;var l=et(1),T=et(6);function rt(R,e,b){for(const I of b)e.addEventListener(I,R[I].bind(R))}function z(R){return Math.round(Math.min(255,Math.max(1,255*R))).toString(16).padStart(2,"0")}class gt{constructor(){D(this,M,0)}getId(){return`${l.AnnotationEditorPrefix}${pe(this,M)._++}`}}M=new WeakMap;const w=class w{constructor(){D(this,m);D(this,S,(0,l.getUuid)());D(this,y,0);D(this,p,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',I=new OffscreenCanvas(1,3).getContext("2d"),U=new Image;U.src=e;const W=U.decode().then(()=>(I.drawImage(U,0,0,1,1,0,0,1,3),new Uint32Array(I.getImageData(0,0,1,1).data.buffer)[0]===0));return(0,l.shadow)(this,"_isSVGFittingCanvas",W)}async getFromFile(e){const{lastModified:b,name:I,size:U,type:W}=e;return j(this,m,Ge).call(this,`${b}_${I}_${U}_${W}`,e)}async getFromUrl(e){return j(this,m,Ge).call(this,e,e)}async getFromId(e){t(this,p)||J(this,p,new Map);const b=t(this,p).get(e);return b?b.bitmap?(b.refCounter+=1,b):b.file?this.getFromFile(b.file):this.getFromUrl(b.url):null}getSvgUrl(e){const b=t(this,p).get(e);return b?.isSvg?b.svgUrl:null}deleteId(e){t(this,p)||J(this,p,new Map);const b=t(this,p).get(e);b&&(b.refCounter-=1,b.refCounter===0&&(b.bitmap=null))}isValidId(e){return e.startsWith(`image_${t(this,S)}_`)}};S=new WeakMap,y=new WeakMap,p=new WeakMap,m=new WeakSet,Ge=async function(e,b){t(this,p)||J(this,p,new Map);let I=t(this,p).get(e);if(I===null)return null;if(I?.bitmap)return I.refCounter+=1,I;try{I||(I={bitmap:null,id:`image_${t(this,S)}_${pe(this,y)._++}`,refCounter:0,isSvg:!1});let U;if(typeof b=="string"){I.url=b;const W=await fetch(b);if(!W.ok)throw new Error(W.statusText);U=await W.blob()}else U=I.file=b;if(U.type==="image/svg+xml"){const W=w._isSVGFittingCanvas,st=new FileReader,ct=new Image,Mt=new Promise((It,Pt)=>{ct.onload=()=>{I.bitmap=ct,I.isSvg=!0,It()},st.onload=async()=>{const Ft=I.svgUrl=st.result;ct.src=await W?`${Ft}#svgView(preserveAspectRatio(none))`:Ft},ct.onerror=st.onerror=Pt});st.readAsDataURL(U),await Mt}else I.bitmap=await createImageBitmap(U);I.refCounter=1}catch(U){console.error(U),I=null}return t(this,p).set(e,I),I&&t(this,p).set(I.id,I),I};let B=w;class k{constructor(e=128){D(this,_,[]);D(this,a,!1);D(this,c,void 0);D(this,d,-1);J(this,c,e)}add({cmd:e,undo:b,mustExec:I,type:U=NaN,overwriteIfSameType:W=!1,keepUndo:st=!1}){if(I&&e(),t(this,a))return;const ct={cmd:e,undo:b,type:U};if(t(this,d)===-1){t(this,_).length>0&&(t(this,_).length=0),J(this,d,0),t(this,_).push(ct);return}if(W&&t(this,_)[t(this,d)].type===U){st&&(ct.undo=t(this,_)[t(this,d)].undo),t(this,_)[t(this,d)]=ct;return}const Mt=t(this,d)+1;Mt===t(this,c)?t(this,_).splice(0,1):(J(this,d,Mt),Mt<t(this,_).length&&t(this,_).splice(Mt)),t(this,_).push(ct)}undo(){t(this,d)!==-1&&(J(this,a,!0),t(this,_)[t(this,d)].undo(),J(this,a,!1),J(this,d,t(this,d)-1))}redo(){t(this,d)<t(this,_).length-1&&(J(this,d,t(this,d)+1),J(this,a,!0),t(this,_)[t(this,d)].cmd(),J(this,a,!1))}hasSomethingToUndo(){return t(this,d)!==-1}hasSomethingToRedo(){return t(this,d)<t(this,_).length-1}destroy(){J(this,_,null)}}_=new WeakMap,a=new WeakMap,c=new WeakMap,d=new WeakMap,u.CommandManager=k;class g{constructor(e){D(this,r);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:b}=l.FeatureTest.platform;for(const[I,U,W={}]of e)for(const st of I){const ct=st.startsWith("mac+");b&&ct?(this.callbacks.set(st.slice(4),{callback:U,options:W}),this.allKeys.add(st.split("+").at(-1))):!b&&!ct&&(this.callbacks.set(st,{callback:U,options:W}),this.allKeys.add(st.split("+").at(-1)))}}exec(e,b){if(!this.allKeys.has(b.key))return;const I=this.callbacks.get(j(this,r,wi).call(this,b));if(!I)return;const{callback:U,options:{bubbles:W=!1,args:st=[],checker:ct=null}}=I;ct&&!ct(e,b)||(U.bind(e,...st)(),W||(b.stopPropagation(),b.preventDefault()))}}r=new WeakSet,wi=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const b=this.buffer.join("+");return this.buffer.length=0,b},u.KeyboardManager=g;const F=class F{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return(0,T.getColorValues)(e),(0,l.shadow)(this,"_colors",e)}convert(e){const b=(0,T.getRGB)(e);if(!window.matchMedia("(forced-colors: active)").matches)return b;for(const[I,U]of this._colors)if(U.every((W,st)=>W===b[st]))return F._colorsMapping.get(I);return b}getHexCode(e){const b=this._colors.get(e);return b?l.Util.makeHexColor(...b):e}};Zt(F,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let L=F;u.ColorManager=L;const Lt=class Lt{constructor(e,b,I,U,W,st){D(this,ht);D(this,St);D(this,Ht);D(this,Xt);D(this,qt);D(this,ot);D(this,H);D(this,_t);D(this,Jt);D(this,Et);D(this,wt);D(this,Bt);D(this,bt);D(this,C,null);D(this,X,new Map);D(this,Y,new Map);D(this,P,null);D(this,V,null);D(this,ut,new k);D(this,nt,0);D(this,G,new Set);D(this,at,null);D(this,At,null);D(this,Tt,new Set);D(this,xt,null);D(this,v,new gt);D(this,i,!1);D(this,n,!1);D(this,s,null);D(this,o,l.AnnotationEditorType.NONE);D(this,h,new Set);D(this,A,null);D(this,x,this.blur.bind(this));D(this,O,this.focus.bind(this));D(this,Q,this.copy.bind(this));D(this,Z,this.cut.bind(this));D(this,it,this.paste.bind(this));D(this,lt,this.keydown.bind(this));D(this,yt,this.onEditingAction.bind(this));D(this,dt,this.onPageChanging.bind(this));D(this,kt,this.onScaleChanging.bind(this));D(this,Ut,this.onRotationChanging.bind(this));D(this,vt,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1});D(this,Rt,[0,0]);D(this,ft,null);D(this,K,null);D(this,$,null);J(this,K,e),J(this,$,b),J(this,P,I),this._eventBus=U,this._eventBus._on("editingaction",t(this,yt)),this._eventBus._on("pagechanging",t(this,dt)),this._eventBus._on("scalechanging",t(this,kt)),this._eventBus._on("rotationchanging",t(this,Ut)),J(this,V,W.annotationStorage),J(this,xt,W.filterFactory),J(this,A,st),this.viewParameters={realScale:T.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}static get _keyboardManager(){const e=Lt.prototype,b=W=>{const{activeElement:st}=document;return st&&t(W,K).contains(st)&&W.hasSomethingToControl()},I=this.TRANSLATE_SMALL,U=this.TRANSLATE_BIG;return(0,l.shadow)(this,"_keyboardManager",new g([[["ctrl+a","mac+meta+a"],e.selectAll],[["ctrl+z","mac+meta+z"],e.undo],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-I,0],checker:b}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-U,0],checker:b}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[I,0],checker:b}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[U,0],checker:b}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-I],checker:b}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-U],checker:b}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,I],checker:b}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,U],checker:b}]]))}destroy(){j(this,Xt,we).call(this),j(this,St,ze).call(this),this._eventBus._off("editingaction",t(this,yt)),this._eventBus._off("pagechanging",t(this,dt)),this._eventBus._off("scalechanging",t(this,kt)),this._eventBus._off("rotationchanging",t(this,Ut));for(const e of t(this,Y).values())e.destroy();t(this,Y).clear(),t(this,X).clear(),t(this,Tt).clear(),J(this,C,null),t(this,h).clear(),t(this,ut).destroy(),t(this,P).destroy()}get hcmFilter(){return(0,l.shadow)(this,"hcmFilter",t(this,A)?t(this,xt).addHCMFilter(t(this,A).foreground,t(this,A).background):"none")}get direction(){return(0,l.shadow)(this,"direction",getComputedStyle(t(this,K)).direction)}editAltText(e){t(this,P)?.editAltText(this,e)}onPageChanging({pageNumber:e}){J(this,nt,e-1)}focusMainContainer(){t(this,K).focus()}findParent(e,b){for(const I of t(this,Y).values()){const{x:U,y:W,width:st,height:ct}=I.div.getBoundingClientRect();if(e>=U&&e<=U+st&&b>=W&&b<=W+ct)return I}return null}disableUserSelect(e=!1){t(this,$).classList.toggle("noUserSelect",e)}addShouldRescale(e){t(this,Tt).add(e)}removeShouldRescale(e){t(this,Tt).delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*T.PixelsPerInch.PDF_TO_CSS_UNITS;for(const b of t(this,Tt))b.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}addToAnnotationStorage(e){!e.isEmpty()&&t(this,V)&&!t(this,V).has(e.id)&&t(this,V).setValue(e.id,e)}blur(){if(!this.hasSelection)return;const{activeElement:e}=document;for(const b of t(this,h))if(b.div.contains(e)){J(this,s,[b,e]),b._focusEventsAllowed=!1;break}}focus(){if(!t(this,s))return;const[e,b]=t(this,s);J(this,s,null),b.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0}),b.focus()}addEditListeners(){j(this,Ht,Xe).call(this),j(this,qt,qe).call(this)}removeEditListeners(){j(this,Xt,we).call(this),j(this,ot,Ve).call(this)}copy(e){if(e.preventDefault(),t(this,C)?.commitOrRemove(),!this.hasSelection)return;const b=[];for(const I of t(this,h)){const U=I.serialize(!0);U&&b.push(U)}b.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(b))}cut(e){this.copy(e),this.delete()}paste(e){e.preventDefault();const{clipboardData:b}=e;for(const W of b.items)for(const st of t(this,At))if(st.isHandlingMimeForPasting(W.type)){st.paste(W,this.currentLayer);return}let I=b.getData("application/pdfjs");if(!I)return;try{I=JSON.parse(I)}catch(W){(0,l.warn)(`paste: "${W.message}".`);return}if(!Array.isArray(I))return;this.unselectAll();const U=this.currentLayer;try{const W=[];for(const Mt of I){const It=U.deserialize(Mt);if(!It)return;W.push(It)}const st=()=>{for(const Mt of W)j(this,wt,$e).call(this,Mt);j(this,bt,Ye).call(this,W)},ct=()=>{for(const Mt of W)Mt.remove()};this.addCommands({cmd:st,undo:ct,mustExec:!0})}catch(W){(0,l.warn)(`paste: "${W.message}".`)}}keydown(e){this.getActive()?.shouldGetKeyboardEvents()||Lt._keyboardManager.exec(this,e)}onEditingAction(e){["undo","redo","delete","selectAll"].includes(e.name)&&this[e.name]()}setEditingState(e){e?(j(this,ht,Ci).call(this),j(this,Ht,Xe).call(this),j(this,qt,qe).call(this),j(this,H,ne).call(this,{isEditing:t(this,o)!==l.AnnotationEditorType.NONE,isEmpty:j(this,Bt,me).call(this),hasSomethingToUndo:t(this,ut).hasSomethingToUndo(),hasSomethingToRedo:t(this,ut).hasSomethingToRedo(),hasSelectedEditor:!1})):(j(this,St,ze).call(this),j(this,Xt,we).call(this),j(this,ot,Ve).call(this),j(this,H,ne).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!t(this,At)){J(this,At,e);for(const b of t(this,At))j(this,_t,ge).call(this,b.defaultPropertiesToUpdate)}}getId(){return t(this,v).getId()}get currentLayer(){return t(this,Y).get(t(this,nt))}getLayer(e){return t(this,Y).get(e)}get currentPageIndex(){return t(this,nt)}addLayer(e){t(this,Y).set(e.pageIndex,e),t(this,i)?e.enable():e.disable()}removeLayer(e){t(this,Y).delete(e.pageIndex)}updateMode(e,b=null){if(t(this,o)!==e){if(J(this,o,e),e===l.AnnotationEditorType.NONE){this.setEditingState(!1),j(this,Et,xi).call(this);return}this.setEditingState(!0),j(this,Jt,Ti).call(this),this.unselectAll();for(const I of t(this,Y).values())I.updateMode(e);if(b){for(const I of t(this,X).values())if(I.annotationElementId===b){this.setSelected(I),I.enterInEditMode();break}}}}updateToolbar(e){e!==t(this,o)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,b){if(t(this,At)){if(e===l.AnnotationEditorParamsType.CREATE){this.currentLayer.addNewEditor(e);return}for(const I of t(this,h))I.updateParams(e,b);for(const I of t(this,At))I.updateDefaultParams(e,b)}}enableWaiting(e=!1){if(t(this,n)!==e){J(this,n,e);for(const b of t(this,Y).values())e?b.disableClick():b.enableClick(),b.div.classList.toggle("waiting",e)}}getEditors(e){const b=[];for(const I of t(this,X).values())I.pageIndex===e&&b.push(I);return b}getEditor(e){return t(this,X).get(e)}addEditor(e){t(this,X).set(e.id,e)}removeEditor(e){t(this,X).delete(e.id),this.unselect(e),(!e.annotationElementId||!t(this,G).has(e.annotationElementId))&&t(this,V)?.remove(e.id)}addDeletedAnnotationElement(e){t(this,G).add(e.annotationElementId),e.deleted=!0}isDeletedAnnotationElement(e){return t(this,G).has(e)}removeDeletedAnnotationElement(e){t(this,G).delete(e.annotationElementId),e.deleted=!1}setActiveEditor(e){t(this,C)!==e&&(J(this,C,e),e&&j(this,_t,ge).call(this,e.propertiesToUpdate))}toggleSelected(e){if(t(this,h).has(e)){t(this,h).delete(e),e.unselect(),j(this,H,ne).call(this,{hasSelectedEditor:this.hasSelection});return}t(this,h).add(e),e.select(),j(this,_t,ge).call(this,e.propertiesToUpdate),j(this,H,ne).call(this,{hasSelectedEditor:!0})}setSelected(e){for(const b of t(this,h))b!==e&&b.unselect();t(this,h).clear(),t(this,h).add(e),e.select(),j(this,_t,ge).call(this,e.propertiesToUpdate),j(this,H,ne).call(this,{hasSelectedEditor:!0})}isSelected(e){return t(this,h).has(e)}unselect(e){e.unselect(),t(this,h).delete(e),j(this,H,ne).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return t(this,h).size!==0}undo(){t(this,ut).undo(),j(this,H,ne).call(this,{hasSomethingToUndo:t(this,ut).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:j(this,Bt,me).call(this)})}redo(){t(this,ut).redo(),j(this,H,ne).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:t(this,ut).hasSomethingToRedo(),isEmpty:j(this,Bt,me).call(this)})}addCommands(e){t(this,ut).add(e),j(this,H,ne).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:j(this,Bt,me).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const e=[...t(this,h)],b=()=>{for(const U of e)U.remove()},I=()=>{for(const U of e)j(this,wt,$e).call(this,U)};this.addCommands({cmd:b,undo:I,mustExec:!0})}commitOrRemove(){t(this,C)?.commitOrRemove()}hasSomethingToControl(){return t(this,C)||this.hasSelection}selectAll(){for(const e of t(this,h))e.commit();j(this,bt,Ye).call(this,t(this,X).values())}unselectAll(){if(t(this,C)){t(this,C).commitOrRemove();return}if(this.hasSelection){for(const e of t(this,h))e.unselect();t(this,h).clear(),j(this,H,ne).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,b,I=!1){if(I||this.commitOrRemove(),!this.hasSelection)return;t(this,Rt)[0]+=e,t(this,Rt)[1]+=b;const[U,W]=t(this,Rt),st=[...t(this,h)],ct=1e3;t(this,ft)&&clearTimeout(t(this,ft)),J(this,ft,setTimeout(()=>{J(this,ft,null),t(this,Rt)[0]=t(this,Rt)[1]=0,this.addCommands({cmd:()=>{for(const Mt of st)t(this,X).has(Mt.id)&&Mt.translateInPage(U,W)},undo:()=>{for(const Mt of st)t(this,X).has(Mt.id)&&Mt.translateInPage(-U,-W)},mustExec:!1})},ct));for(const Mt of st)Mt.translateInPage(e,b)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),J(this,at,new Map);for(const e of t(this,h))t(this,at).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!t(this,at))return!1;this.disableUserSelect(!1);const e=t(this,at);J(this,at,null);let b=!1;for(const[{x:U,y:W,pageIndex:st},ct]of e)ct.newX=U,ct.newY=W,ct.newPageIndex=st,b||(b=U!==ct.savedX||W!==ct.savedY||st!==ct.savedPageIndex);if(!b)return!1;const I=(U,W,st,ct)=>{if(t(this,X).has(U.id)){const Mt=t(this,Y).get(ct);Mt?U._setParentAndPosition(Mt,W,st):(U.pageIndex=ct,U.x=W,U.y=st)}};return this.addCommands({cmd:()=>{for(const[U,{newX:W,newY:st,newPageIndex:ct}]of e)I(U,W,st,ct)},undo:()=>{for(const[U,{savedX:W,savedY:st,savedPageIndex:ct}]of e)I(U,W,st,ct)},mustExec:!0}),!0}dragSelectedEditors(e,b){if(t(this,at))for(const I of t(this,at).keys())I.drag(e,b)}rebuild(e){if(e.parent===null){const b=this.getLayer(e.pageIndex);b?(b.changeParent(e),b.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}isActive(e){return t(this,C)===e}getActive(){return t(this,C)}getMode(){return t(this,o)}get imageManager(){return(0,l.shadow)(this,"imageManager",new B)}};C=new WeakMap,X=new WeakMap,Y=new WeakMap,P=new WeakMap,V=new WeakMap,ut=new WeakMap,nt=new WeakMap,G=new WeakMap,at=new WeakMap,At=new WeakMap,Tt=new WeakMap,xt=new WeakMap,v=new WeakMap,i=new WeakMap,n=new WeakMap,s=new WeakMap,o=new WeakMap,h=new WeakMap,A=new WeakMap,x=new WeakMap,O=new WeakMap,Q=new WeakMap,Z=new WeakMap,it=new WeakMap,lt=new WeakMap,yt=new WeakMap,dt=new WeakMap,kt=new WeakMap,Ut=new WeakMap,vt=new WeakMap,Rt=new WeakMap,ft=new WeakMap,K=new WeakMap,$=new WeakMap,ht=new WeakSet,Ci=function(){window.addEventListener("focus",t(this,O)),window.addEventListener("blur",t(this,x))},St=new WeakSet,ze=function(){window.removeEventListener("focus",t(this,O)),window.removeEventListener("blur",t(this,x))},Ht=new WeakSet,Xe=function(){window.addEventListener("keydown",t(this,lt),{capture:!0})},Xt=new WeakSet,we=function(){window.removeEventListener("keydown",t(this,lt),{capture:!0})},qt=new WeakSet,qe=function(){document.addEventListener("copy",t(this,Q)),document.addEventListener("cut",t(this,Z)),document.addEventListener("paste",t(this,it))},ot=new WeakSet,Ve=function(){document.removeEventListener("copy",t(this,Q)),document.removeEventListener("cut",t(this,Z)),document.removeEventListener("paste",t(this,it))},H=new WeakSet,ne=function(e){Object.entries(e).some(([I,U])=>t(this,vt)[I]!==U)&&this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(t(this,vt),e)})},_t=new WeakSet,ge=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},Jt=new WeakSet,Ti=function(){if(!t(this,i)){J(this,i,!0);for(const e of t(this,Y).values())e.enable()}},Et=new WeakSet,xi=function(){if(this.unselectAll(),t(this,i)){J(this,i,!1);for(const e of t(this,Y).values())e.disable()}},wt=new WeakSet,$e=function(e){const b=t(this,Y).get(e.pageIndex);b?b.addOrRebuild(e):this.addEditor(e)},Bt=new WeakSet,me=function(){if(t(this,X).size===0)return!0;if(t(this,X).size===1)for(const e of t(this,X).values())return e.isEmpty();return!1},bt=new WeakSet,Ye=function(e){t(this,h).clear();for(const b of e)b.isEmpty()||(t(this,h).add(b),b.select());j(this,H,ne).call(this,{hasSelectedEditor:!0})},Zt(Lt,"TRANSLATE_SMALL",1),Zt(Lt,"TRANSLATE_BIG",10);let N=Lt;u.AnnotationEditorUIManager=N},(pt,u,et)=>{var nt,G,at,At,Tt,xt,v,i,n,s,o,h,ce,x,he,Q,Ke,it,Ce,yt,Te,kt,be,vt,_e;Object.defineProperty(u,"__esModule",{value:!0}),u.StatTimer=u.RenderingCancelledException=u.PixelsPerInch=u.PageViewport=u.PDFDateString=u.DOMStandardFontDataFactory=u.DOMSVGFactory=u.DOMFilterFactory=u.DOMCanvasFactory=u.DOMCMapReaderFactory=void 0,u.deprecated=d,u.getColorValues=X,u.getCurrentTransform=Y,u.getCurrentTransformInverse=P,u.getFilenameFromUrl=m,u.getPdfFilenameFromUrl=E,u.getRGB=C,u.getXfaPageViewport=F,u.isDataScheme=y,u.isPdfFile=p,u.isValidFetchUrl=_,u.loadScript=c,u.noContextMenu=a,u.setLayerDimensions=V;var l=et(7),T=et(1);const rt="http://www.w3.org/2000/svg",ut=class ut{};Zt(ut,"CSS",96),Zt(ut,"PDF",72),Zt(ut,"PDF_TO_CSS_UNITS",ut.CSS/ut.PDF);let z=ut;u.PixelsPerInch=z;class gt extends l.BaseFilterFactory{constructor({docId:$,ownerDocument:ht=globalThis.document}={}){super();D(this,h);D(this,x);D(this,Q);D(this,it);D(this,yt);D(this,kt);D(this,vt);D(this,nt,void 0);D(this,G,void 0);D(this,at,void 0);D(this,At,void 0);D(this,Tt,void 0);D(this,xt,void 0);D(this,v,void 0);D(this,i,void 0);D(this,n,void 0);D(this,s,void 0);D(this,o,0);J(this,at,$),J(this,At,ht)}addFilter($){if(!$)return"none";let ht=t(this,h,ce).get($);if(ht)return ht;let Ct,St,Wt,Ht;if($.length===1){const qt=$[0],zt=new Array(256);for(let ot=0;ot<256;ot++)zt[ot]=qt[ot]/255;Ht=Ct=St=Wt=zt.join(",")}else{const[qt,zt,ot]=$,tt=new Array(256),H=new Array(256),mt=new Array(256);for(let _t=0;_t<256;_t++)tt[_t]=qt[_t]/255,H[_t]=zt[_t]/255,mt[_t]=ot[_t]/255;Ct=tt.join(","),St=H.join(","),Wt=mt.join(","),Ht=`${Ct}${St}${Wt}`}if(ht=t(this,h,ce).get(Ht),ht)return t(this,h,ce).set($,ht),ht;const jt=`g_${t(this,at)}_transfer_map_${pe(this,o)._++}`,Xt=`url(#${jt})`;t(this,h,ce).set($,Xt),t(this,h,ce).set(Ht,Xt);const Gt=j(this,it,Ce).call(this,jt);return j(this,kt,be).call(this,Ct,St,Wt,Gt),Xt}addHCMFilter($,ht){const Ct=`${$}-${ht}`;if(t(this,xt)===Ct)return t(this,v);if(J(this,xt,Ct),J(this,v,"none"),t(this,Tt)?.remove(),!$||!ht)return t(this,v);const St=j(this,vt,_e).call(this,$);$=T.Util.makeHexColor(...St);const Wt=j(this,vt,_e).call(this,ht);if(ht=T.Util.makeHexColor(...Wt),t(this,x,he).style.color="",$==="#000000"&&ht==="#ffffff"||$===ht)return t(this,v);const Ht=new Array(256);for(let zt=0;zt<=255;zt++){const ot=zt/255;Ht[zt]=ot<=.03928?ot/12.92:((ot+.055)/1.055)**2.4}const jt=Ht.join(","),Xt=`g_${t(this,at)}_hcm_filter`,Gt=J(this,i,j(this,it,Ce).call(this,Xt));j(this,kt,be).call(this,jt,jt,jt,Gt),j(this,Q,Ke).call(this,Gt);const qt=(zt,ot)=>{const tt=St[zt]/255,H=Wt[zt]/255,mt=new Array(ot+1);for(let _t=0;_t<=ot;_t++)mt[_t]=tt+_t/ot*(H-tt);return mt.join(",")};return j(this,kt,be).call(this,qt(0,5),qt(1,5),qt(2,5),Gt),J(this,v,`url(#${Xt})`),t(this,v)}addHighlightHCMFilter($,ht,Ct,St){const Wt=`${$}-${ht}-${Ct}-${St}`;if(t(this,n)===Wt)return t(this,s);if(J(this,n,Wt),J(this,s,"none"),t(this,i)?.remove(),!$||!ht)return t(this,s);const[Ht,jt]=[$,ht].map(j(this,vt,_e).bind(this));let Xt=Math.round(.2126*Ht[0]+.7152*Ht[1]+.0722*Ht[2]),Gt=Math.round(.2126*jt[0]+.7152*jt[1]+.0722*jt[2]),[qt,zt]=[Ct,St].map(j(this,vt,_e).bind(this));Gt<Xt&&([Xt,Gt,qt,zt]=[Gt,Xt,zt,qt]),t(this,x,he).style.color="";const ot=(mt,_t,ee)=>{const Jt=new Array(256),q=(Gt-Xt)/ee,Et=mt/255,Nt=(_t-mt)/(255*ee);let wt=0;for(let Dt=0;Dt<=ee;Dt++){const Bt=Math.round(Xt+Dt*q),Yt=Et+Dt*Nt;for(let bt=wt;bt<=Bt;bt++)Jt[bt]=Yt;wt=Bt+1}for(let Dt=wt;Dt<256;Dt++)Jt[Dt]=Jt[wt-1];return Jt.join(",")},tt=`g_${t(this,at)}_hcm_highlight_filter`,H=J(this,i,j(this,it,Ce).call(this,tt));return j(this,Q,Ke).call(this,H),j(this,kt,be).call(this,ot(qt[0],zt[0],5),ot(qt[1],zt[1],5),ot(qt[2],zt[2],5),H),J(this,s,`url(#${tt})`),t(this,s)}destroy($=!1){$&&(t(this,v)||t(this,s))||(t(this,G)&&(t(this,G).parentNode.parentNode.remove(),J(this,G,null)),t(this,nt)&&(t(this,nt).clear(),J(this,nt,null)),J(this,o,0))}}nt=new WeakMap,G=new WeakMap,at=new WeakMap,At=new WeakMap,Tt=new WeakMap,xt=new WeakMap,v=new WeakMap,i=new WeakMap,n=new WeakMap,s=new WeakMap,o=new WeakMap,h=new WeakSet,ce=function(){return t(this,nt)||J(this,nt,new Map)},x=new WeakSet,he=function(){if(!t(this,G)){const $=t(this,At).createElement("div"),{style:ht}=$;ht.visibility="hidden",ht.contain="strict",ht.width=ht.height=0,ht.position="absolute",ht.top=ht.left=0,ht.zIndex=-1;const Ct=t(this,At).createElementNS(rt,"svg");Ct.setAttribute("width",0),Ct.setAttribute("height",0),J(this,G,t(this,At).createElementNS(rt,"defs")),$.append(Ct),Ct.append(t(this,G)),t(this,At).body.append($)}return t(this,G)},Q=new WeakSet,Ke=function($){const ht=t(this,At).createElementNS(rt,"feColorMatrix");ht.setAttribute("type","matrix"),ht.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),$.append(ht)},it=new WeakSet,Ce=function($){const ht=t(this,At).createElementNS(rt,"filter");return ht.setAttribute("color-interpolation-filters","sRGB"),ht.setAttribute("id",$),t(this,x,he).append(ht),ht},yt=new WeakSet,Te=function($,ht,Ct){const St=t(this,At).createElementNS(rt,ht);St.setAttribute("type","discrete"),St.setAttribute("tableValues",Ct),$.append(St)},kt=new WeakSet,be=function($,ht,Ct,St){const Wt=t(this,At).createElementNS(rt,"feComponentTransfer");St.append(Wt),j(this,yt,Te).call(this,Wt,"feFuncR",$),j(this,yt,Te).call(this,Wt,"feFuncG",ht),j(this,yt,Te).call(this,Wt,"feFuncB",Ct)},vt=new WeakSet,_e=function($){return t(this,x,he).style.color=$,C(getComputedStyle(t(this,x,he)).getPropertyValue("color"))},u.DOMFilterFactory=gt;class B extends l.BaseCanvasFactory{constructor({ownerDocument:K=globalThis.document}={}){super(),this._document=K}_createCanvas(K,$){const ht=this._document.createElement("canvas");return ht.width=K,ht.height=$,ht}}u.DOMCanvasFactory=B;async function k(ft,K=!1){if(_(ft,document.baseURI)){const $=await fetch(ft);if(!$.ok)throw new Error($.statusText);return K?new Uint8Array(await $.arrayBuffer()):(0,T.stringToBytes)(await $.text())}return new Promise(($,ht)=>{const Ct=new XMLHttpRequest;Ct.open("GET",ft,!0),K&&(Ct.responseType="arraybuffer"),Ct.onreadystatechange=()=>{if(Ct.readyState===XMLHttpRequest.DONE){if(Ct.status===200||Ct.status===0){let St;if(K&&Ct.response?St=new Uint8Array(Ct.response):!K&&Ct.responseText&&(St=(0,T.stringToBytes)(Ct.responseText)),St){$(St);return}}ht(new Error(Ct.statusText))}},Ct.send(null)})}class g extends l.BaseCMapReaderFactory{_fetchData(K,$){return k(K,this.isCompressed).then(ht=>({cMapData:ht,compressionType:$}))}}u.DOMCMapReaderFactory=g;class L extends l.BaseStandardFontDataFactory{_fetchData(K){return k(K,!0)}}u.DOMStandardFontDataFactory=L;class N extends l.BaseSVGFactory{_createSVG(K){return document.createElementNS(rt,K)}}u.DOMSVGFactory=N;class M{constructor({viewBox:K,scale:$,rotation:ht,offsetX:Ct=0,offsetY:St=0,dontFlip:Wt=!1}){this.viewBox=K,this.scale=$,this.rotation=ht,this.offsetX=Ct,this.offsetY=St;const Ht=(K[2]+K[0])/2,jt=(K[3]+K[1])/2;let Xt,Gt,qt,zt;switch(ht%=360,ht<0&&(ht+=360),ht){case 180:Xt=-1,Gt=0,qt=0,zt=1;break;case 90:Xt=0,Gt=1,qt=1,zt=0;break;case 270:Xt=0,Gt=-1,qt=-1,zt=0;break;case 0:Xt=1,Gt=0,qt=0,zt=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}Wt&&(qt=-qt,zt=-zt);let ot,tt,H,mt;Xt===0?(ot=Math.abs(jt-K[1])*$+Ct,tt=Math.abs(Ht-K[0])*$+St,H=(K[3]-K[1])*$,mt=(K[2]-K[0])*$):(ot=Math.abs(Ht-K[0])*$+Ct,tt=Math.abs(jt-K[1])*$+St,H=(K[2]-K[0])*$,mt=(K[3]-K[1])*$),this.transform=[Xt*$,Gt*$,qt*$,zt*$,ot-Xt*$*Ht-qt*$*jt,tt-Gt*$*Ht-zt*$*jt],this.width=H,this.height=mt}get rawDims(){const{viewBox:K}=this;return(0,T.shadow)(this,"rawDims",{pageWidth:K[2]-K[0],pageHeight:K[3]-K[1],pageX:K[0],pageY:K[1]})}clone({scale:K=this.scale,rotation:$=this.rotation,offsetX:ht=this.offsetX,offsetY:Ct=this.offsetY,dontFlip:St=!1}={}){return new M({viewBox:this.viewBox.slice(),scale:K,rotation:$,offsetX:ht,offsetY:Ct,dontFlip:St})}convertToViewportPoint(K,$){return T.Util.applyTransform([K,$],this.transform)}convertToViewportRectangle(K){const $=T.Util.applyTransform([K[0],K[1]],this.transform),ht=T.Util.applyTransform([K[2],K[3]],this.transform);return[$[0],$[1],ht[0],ht[1]]}convertToPdfPoint(K,$){return T.Util.applyInverseTransform([K,$],this.transform)}}u.PageViewport=M;class S extends T.BaseException{constructor(K,$=0){super(K,"RenderingCancelledException"),this.extraDelay=$}}u.RenderingCancelledException=S;function y(ft){const K=ft.length;let $=0;for(;$<K&&ft[$].trim()==="";)$++;return ft.substring($,$+5).toLowerCase()==="data:"}function p(ft){return typeof ft=="string"&&/\.pdf$/i.test(ft)}function m(ft,K=!1){return K||([ft]=ft.split(/[#?]/,1)),ft.substring(ft.lastIndexOf("/")+1)}function E(ft,K="document.pdf"){if(typeof ft!="string")return K;if(y(ft))return(0,T.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),K;const $=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,ht=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,Ct=$.exec(ft);let St=ht.exec(Ct[1])||ht.exec(Ct[2])||ht.exec(Ct[3]);if(St&&(St=St[0],St.includes("%")))try{St=ht.exec(decodeURIComponent(St))[0]}catch{}return St||K}class w{constructor(){Zt(this,"started",Object.create(null));Zt(this,"times",[])}time(K){K in this.started&&(0,T.warn)(`Timer is already running for ${K}`),this.started[K]=Date.now()}timeEnd(K){K in this.started||(0,T.warn)(`Timer has not been started for ${K}`),this.times.push({name:K,start:this.started[K],end:Date.now()}),delete this.started[K]}toString(){const K=[];let $=0;for(const{name:ht}of this.times)$=Math.max(ht.length,$);for(const{name:ht,start:Ct,end:St}of this.times)K.push(`${ht.padEnd($)} ${St-Ct}ms
`);return K.join("")}}u.StatTimer=w;function _(ft,K){try{const{protocol:$}=K?new URL(ft,K):new URL(ft);return $==="http:"||$==="https:"}catch{return!1}}function a(ft){ft.preventDefault()}function c(ft,K=!1){return new Promise(($,ht)=>{const Ct=document.createElement("script");Ct.src=ft,Ct.onload=function(St){K&&Ct.remove(),$(St)},Ct.onerror=function(){ht(new Error(`Cannot load script at: ${Ct.src}`))},(document.head||document.documentElement).append(Ct)})}function d(ft){console.log("Deprecated API usage: "+ft)}let r;class f{static toDateObject(K){if(!K||typeof K!="string")return null;r||(r=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const $=r.exec(K);if(!$)return null;const ht=parseInt($[1],10);let Ct=parseInt($[2],10);Ct=Ct>=1&&Ct<=12?Ct-1:0;let St=parseInt($[3],10);St=St>=1&&St<=31?St:1;let Wt=parseInt($[4],10);Wt=Wt>=0&&Wt<=23?Wt:0;let Ht=parseInt($[5],10);Ht=Ht>=0&&Ht<=59?Ht:0;let jt=parseInt($[6],10);jt=jt>=0&&jt<=59?jt:0;const Xt=$[7]||"Z";let Gt=parseInt($[8],10);Gt=Gt>=0&&Gt<=23?Gt:0;let qt=parseInt($[9],10)||0;return qt=qt>=0&&qt<=59?qt:0,Xt==="-"?(Wt+=Gt,Ht+=qt):Xt==="+"&&(Wt-=Gt,Ht-=qt),new Date(Date.UTC(ht,Ct,St,Wt,Ht,jt))}}u.PDFDateString=f;function F(ft,{scale:K=1,rotation:$=0}){const{width:ht,height:Ct}=ft.attributes.style,St=[0,0,parseInt(ht),parseInt(Ct)];return new M({viewBox:St,scale:K,rotation:$})}function C(ft){if(ft.startsWith("#")){const K=parseInt(ft.slice(1),16);return[(K&16711680)>>16,(K&65280)>>8,K&255]}return ft.startsWith("rgb(")?ft.slice(4,-1).split(",").map(K=>parseInt(K)):ft.startsWith("rgba(")?ft.slice(5,-1).split(",").map(K=>parseInt(K)).slice(0,3):((0,T.warn)(`Not a valid color format: "${ft}"`),[0,0,0])}function X(ft){const K=document.createElement("span");K.style.visibility="hidden",document.body.append(K);for(const $ of ft.keys()){K.style.color=$;const ht=window.getComputedStyle(K).color;ft.set($,C(ht))}K.remove()}function Y(ft){const{a:K,b:$,c:ht,d:Ct,e:St,f:Wt}=ft.getTransform();return[K,$,ht,Ct,St,Wt]}function P(ft){const{a:K,b:$,c:ht,d:Ct,e:St,f:Wt}=ft.getTransform().invertSelf();return[K,$,ht,Ct,St,Wt]}function V(ft,K,$=!1,ht=!0){if(K instanceof M){const{pageWidth:Ct,pageHeight:St}=K.rawDims,{style:Wt}=ft,Ht=T.FeatureTest.isCSSRoundSupported,jt=`var(--scale-factor) * ${Ct}px`,Xt=`var(--scale-factor) * ${St}px`,Gt=Ht?`round(${jt}, 1px)`:`calc(${jt})`,qt=Ht?`round(${Xt}, 1px)`:`calc(${Xt})`;!$||K.rotation%180===0?(Wt.width=Gt,Wt.height=qt):(Wt.width=qt,Wt.height=Gt)}ht&&ft.setAttribute("data-main-rotation",K.rotation)}},(pt,u,et)=>{Object.defineProperty(u,"__esModule",{value:!0}),u.BaseStandardFontDataFactory=u.BaseSVGFactory=u.BaseFilterFactory=u.BaseCanvasFactory=u.BaseCMapReaderFactory=void 0;var l=et(1);class T{constructor(){this.constructor===T&&(0,l.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(g){return"none"}addHCMFilter(g,L){return"none"}addHighlightHCMFilter(g,L,N,M){return"none"}destroy(g=!1){}}u.BaseFilterFactory=T;class rt{constructor(){this.constructor===rt&&(0,l.unreachable)("Cannot initialize BaseCanvasFactory.")}create(g,L){if(g<=0||L<=0)throw new Error("Invalid canvas size");const N=this._createCanvas(g,L);return{canvas:N,context:N.getContext("2d")}}reset(g,L,N){if(!g.canvas)throw new Error("Canvas is not specified");if(L<=0||N<=0)throw new Error("Invalid canvas size");g.canvas.width=L,g.canvas.height=N}destroy(g){if(!g.canvas)throw new Error("Canvas is not specified");g.canvas.width=0,g.canvas.height=0,g.canvas=null,g.context=null}_createCanvas(g,L){(0,l.unreachable)("Abstract method `_createCanvas` called.")}}u.BaseCanvasFactory=rt;class z{constructor({baseUrl:g=null,isCompressed:L=!0}){this.constructor===z&&(0,l.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=g,this.isCompressed=L}async fetch({name:g}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!g)throw new Error("CMap name must be specified.");const L=this.baseUrl+g+(this.isCompressed?".bcmap":""),N=this.isCompressed?l.CMapCompressionType.BINARY:l.CMapCompressionType.NONE;return this._fetchData(L,N).catch(M=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${L}`)})}_fetchData(g,L){(0,l.unreachable)("Abstract method `_fetchData` called.")}}u.BaseCMapReaderFactory=z;class gt{constructor({baseUrl:g=null}){this.constructor===gt&&(0,l.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=g}async fetch({filename:g}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!g)throw new Error("Font filename must be specified.");const L=`${this.baseUrl}${g}`;return this._fetchData(L).catch(N=>{throw new Error(`Unable to load font data at: ${L}`)})}_fetchData(g){(0,l.unreachable)("Abstract method `_fetchData` called.")}}u.BaseStandardFontDataFactory=gt;class B{constructor(){this.constructor===B&&(0,l.unreachable)("Cannot initialize BaseSVGFactory.")}create(g,L,N=!1){if(g<=0||L<=0)throw new Error("Invalid SVG dimensions");const M=this._createSVG("svg:svg");return M.setAttribute("version","1.1"),N||(M.setAttribute("width",`${g}px`),M.setAttribute("height",`${L}px`)),M.setAttribute("preserveAspectRatio","none"),M.setAttribute("viewBox",`0 0 ${g} ${L}`),M}createElement(g){if(typeof g!="string")throw new Error("Invalid SVG element type");return this._createSVG(g)}_createSVG(g){(0,l.unreachable)("Abstract method `_createSVG` called.")}}u.BaseSVGFactory=B},(pt,u,et)=>{Object.defineProperty(u,"__esModule",{value:!0}),u.MurmurHash3_64=void 0;var l=et(1);const T=3285377520,rt=4294901760,z=65535;class gt{constructor(k){this.h1=k?k&4294967295:T,this.h2=k?k&4294967295:T}update(k){let g,L;if(typeof k=="string"){g=new Uint8Array(k.length*2),L=0;for(let d=0,r=k.length;d<r;d++){const f=k.charCodeAt(d);f<=255?g[L++]=f:(g[L++]=f>>>8,g[L++]=f&255)}}else if((0,l.isArrayBuffer)(k))g=k.slice(),L=g.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const N=L>>2,M=L-N*4,S=new Uint32Array(g.buffer,0,N);let y=0,p=0,m=this.h1,E=this.h2;const w=3432918353,_=461845907,a=w&z,c=_&z;for(let d=0;d<N;d++)d&1?(y=S[d],y=y*w&rt|y*a&z,y=y<<15|y>>>17,y=y*_&rt|y*c&z,m^=y,m=m<<13|m>>>19,m=m*5+3864292196):(p=S[d],p=p*w&rt|p*a&z,p=p<<15|p>>>17,p=p*_&rt|p*c&z,E^=p,E=E<<13|E>>>19,E=E*5+3864292196);switch(y=0,M){case 3:y^=g[N*4+2]<<16;case 2:y^=g[N*4+1]<<8;case 1:y^=g[N*4],y=y*w&rt|y*a&z,y=y<<15|y>>>17,y=y*_&rt|y*c&z,N&1?m^=y:E^=y}this.h1=m,this.h2=E}hexdigest(){let k=this.h1,g=this.h2;return k^=g>>>1,k=k*3981806797&rt|k*36045&z,g=g*4283543511&rt|((g<<16|k>>>16)*2950163797&rt)>>>16,k^=g>>>1,k=k*444984403&rt|k*60499&z,g=g*3301882366&rt|((g<<16|k>>>16)*3120437893&rt)>>>16,k^=g>>>1,(k>>>0).toString(16).padStart(8,"0")+(g>>>0).toString(16).padStart(8,"0")}}u.MurmurHash3_64=gt},(pt,u,et)=>{var z;Object.defineProperty(u,"__esModule",{value:!0}),u.FontLoader=u.FontFaceObject=void 0;var l=et(1);class T{constructor({ownerDocument:B=globalThis.document,styleElement:k=null}){D(this,z,new Set);this._document=B,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(B){this.nativeFontFaces.add(B),this._document.fonts.add(B)}removeNativeFontFace(B){this.nativeFontFaces.delete(B),this._document.fonts.delete(B)}insertRule(B){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const k=this.styleElement.sheet;k.insertRule(B,k.cssRules.length)}clear(){for(const B of this.nativeFontFaces)this._document.fonts.delete(B);this.nativeFontFaces.clear(),t(this,z).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(B){if(!(!B||t(this,z).has(B.loadedName))){if((0,l.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:k,src:g,style:L}=B,N=new FontFace(k,g,L);this.addNativeFontFace(N);try{await N.load(),t(this,z).add(k)}catch{(0,l.warn)(`Cannot load system font: ${B.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(N)}return}(0,l.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(B){if(B.attached||B.missingFile&&!B.systemFontInfo)return;if(B.attached=!0,B.systemFontInfo){await this.loadSystemFont(B.systemFontInfo);return}if(this.isFontLoadingAPISupported){const g=B.createNativeFontFace();if(g){this.addNativeFontFace(g);try{await g.loaded}catch(L){throw(0,l.warn)(`Failed to load font '${g.family}': '${L}'.`),B.disableFontFace=!0,L}}return}const k=B.createFontFaceRule();if(k){if(this.insertRule(k),this.isSyncFontLoadingSupported)return;await new Promise(g=>{const L=this._queueLoadingCallback(g);this._prepareFontLoadEvent(B,L)})}}get isFontLoadingAPISupported(){const B=!!this._document?.fonts;return(0,l.shadow)(this,"isFontLoadingAPISupported",B)}get isSyncFontLoadingSupported(){let B=!1;return(l.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(B=!0),(0,l.shadow)(this,"isSyncFontLoadingSupported",B)}_queueLoadingCallback(B){function k(){for((0,l.assert)(!L.done,"completeRequest() cannot be called twice."),L.done=!0;g.length>0&&g[0].done;){const N=g.shift();setTimeout(N.callback,0)}}const{loadingRequests:g}=this,L={done:!1,complete:k,callback:B};return g.push(L),L}get _loadTestFont(){const B=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,l.shadow)(this,"_loadTestFont",B)}_prepareFontLoadEvent(B,k){function g(C,X){return C.charCodeAt(X)<<24|C.charCodeAt(X+1)<<16|C.charCodeAt(X+2)<<8|C.charCodeAt(X+3)&255}function L(C,X,Y,P){const V=C.substring(0,X),ut=C.substring(X+Y);return V+P+ut}let N,M;const S=this._document.createElement("canvas");S.width=1,S.height=1;const y=S.getContext("2d");let p=0;function m(C,X){if(++p>30){(0,l.warn)("Load test font never loaded."),X();return}if(y.font="30px "+C,y.fillText(".",0,20),y.getImageData(0,0,1,1).data[3]>0){X();return}setTimeout(m.bind(null,C,X))}const E=`lt${Date.now()}${this.loadTestFontId++}`;let w=this._loadTestFont;w=L(w,976,E.length,E);const a=16,c=1482184792;let d=g(w,a);for(N=0,M=E.length-3;N<M;N+=4)d=d-c+g(E,N)|0;N<E.length&&(d=d-c+g(E+"XXX",N)|0),w=L(w,a,4,(0,l.string32)(d));const r=`url(data:font/opentype;base64,${btoa(w)});`,f=`@font-face {font-family:"${E}";src:${r}}`;this.insertRule(f);const F=this._document.createElement("div");F.style.visibility="hidden",F.style.width=F.style.height="10px",F.style.position="absolute",F.style.top=F.style.left="0px";for(const C of[B.loadedName,E]){const X=this._document.createElement("span");X.textContent="Hi",X.style.fontFamily=C,F.append(X)}this._document.body.append(F),m(E,()=>{F.remove(),k.complete()})}}z=new WeakMap,u.FontLoader=T;class rt{constructor(B,{isEvalSupported:k=!0,disableFontFace:g=!1,ignoreErrors:L=!1,inspectFont:N=null}){this.compiledGlyphs=Object.create(null);for(const M in B)this[M]=B[M];this.isEvalSupported=k!==!1,this.disableFontFace=g===!0,this.ignoreErrors=L===!0,this._inspectFont=N}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let B;if(!this.cssFontInfo)B=new FontFace(this.loadedName,this.data,{});else{const k={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(k.style=`oblique ${this.cssFontInfo.italicAngle}deg`),B=new FontFace(this.cssFontInfo.fontFamily,this.data,k)}return this._inspectFont?.(this),B}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const B=(0,l.bytesToString)(this.data),k=`url(data:${this.mimetype};base64,${btoa(B)});`;let g;if(!this.cssFontInfo)g=`@font-face {font-family:"${this.loadedName}";src:${k}}`;else{let L=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(L+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),g=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${L}src:${k}}`}return this._inspectFont?.(this,k),g}getPathGenerator(B,k){if(this.compiledGlyphs[k]!==void 0)return this.compiledGlyphs[k];let g;try{g=B.get(this.loadedName+"_path_"+k)}catch(L){if(!this.ignoreErrors)throw L;return(0,l.warn)(`getPathGenerator - ignoring character: "${L}".`),this.compiledGlyphs[k]=function(N,M){}}if(this.isEvalSupported&&l.FeatureTest.isEvalSupported){const L=[];for(const N of g){const M=N.args!==void 0?N.args.join(","):"";L.push("c.",N.cmd,"(",M,`);
`)}return this.compiledGlyphs[k]=new Function("c","size",L.join(""))}return this.compiledGlyphs[k]=function(L,N){for(const M of g)M.cmd==="scale"&&(M.args=[N,-N]),L[M.cmd].apply(L,M.args)}}}u.FontFaceObject=rt},(pt,u,et)=>{Object.defineProperty(u,"__esModule",{value:!0}),u.NodeStandardFontDataFactory=u.NodeFilterFactory=u.NodeCanvasFactory=u.NodeCMapReaderFactory=void 0;var l=et(7);et(1);const T=function(k){return new Promise((g,L)=>{require$$5.readFile(k,(M,S)=>{if(M||!S){L(new Error(M));return}g(new Uint8Array(S))})})};class rt extends l.BaseFilterFactory{}u.NodeFilterFactory=rt;class z extends l.BaseCanvasFactory{_createCanvas(g,L){return require$$5.createCanvas(g,L)}}u.NodeCanvasFactory=z;class gt extends l.BaseCMapReaderFactory{_fetchData(g,L){return T(g).then(N=>({cMapData:N,compressionType:L}))}}u.NodeCMapReaderFactory=gt;class B extends l.BaseStandardFontDataFactory{_fetchData(g){return T(g)}}u.NodeStandardFontDataFactory=B},(pt,u,et)=>{var G,Je,At,Qe;Object.defineProperty(u,"__esModule",{value:!0}),u.CanvasGraphics=void 0;var l=et(1),T=et(6),rt=et(12),z=et(13);const gt=16,B=100,k=4096,g=15,L=10,N=1e3,M=16;function S(v,i){if(v._removeMirroring)throw new Error("Context is already forwarding operations.");v.__originalSave=v.save,v.__originalRestore=v.restore,v.__originalRotate=v.rotate,v.__originalScale=v.scale,v.__originalTranslate=v.translate,v.__originalTransform=v.transform,v.__originalSetTransform=v.setTransform,v.__originalResetTransform=v.resetTransform,v.__originalClip=v.clip,v.__originalMoveTo=v.moveTo,v.__originalLineTo=v.lineTo,v.__originalBezierCurveTo=v.bezierCurveTo,v.__originalRect=v.rect,v.__originalClosePath=v.closePath,v.__originalBeginPath=v.beginPath,v._removeMirroring=()=>{v.save=v.__originalSave,v.restore=v.__originalRestore,v.rotate=v.__originalRotate,v.scale=v.__originalScale,v.translate=v.__originalTranslate,v.transform=v.__originalTransform,v.setTransform=v.__originalSetTransform,v.resetTransform=v.__originalResetTransform,v.clip=v.__originalClip,v.moveTo=v.__originalMoveTo,v.lineTo=v.__originalLineTo,v.bezierCurveTo=v.__originalBezierCurveTo,v.rect=v.__originalRect,v.closePath=v.__originalClosePath,v.beginPath=v.__originalBeginPath,delete v._removeMirroring},v.save=function(){i.save(),this.__originalSave()},v.restore=function(){i.restore(),this.__originalRestore()},v.translate=function(s,o){i.translate(s,o),this.__originalTranslate(s,o)},v.scale=function(s,o){i.scale(s,o),this.__originalScale(s,o)},v.transform=function(s,o,h,A,x,O){i.transform(s,o,h,A,x,O),this.__originalTransform(s,o,h,A,x,O)},v.setTransform=function(s,o,h,A,x,O){i.setTransform(s,o,h,A,x,O),this.__originalSetTransform(s,o,h,A,x,O)},v.resetTransform=function(){i.resetTransform(),this.__originalResetTransform()},v.rotate=function(s){i.rotate(s),this.__originalRotate(s)},v.clip=function(s){i.clip(s),this.__originalClip(s)},v.moveTo=function(n,s){i.moveTo(n,s),this.__originalMoveTo(n,s)},v.lineTo=function(n,s){i.lineTo(n,s),this.__originalLineTo(n,s)},v.bezierCurveTo=function(n,s,o,h,A,x){i.bezierCurveTo(n,s,o,h,A,x),this.__originalBezierCurveTo(n,s,o,h,A,x)},v.rect=function(n,s,o,h){i.rect(n,s,o,h),this.__originalRect(n,s,o,h)},v.closePath=function(){i.closePath(),this.__originalClosePath()},v.beginPath=function(){i.beginPath(),this.__originalBeginPath()}}class y{constructor(i){this.canvasFactory=i,this.cache=Object.create(null)}getCanvas(i,n,s){let o;return this.cache[i]!==void 0?(o=this.cache[i],this.canvasFactory.reset(o,n,s)):(o=this.canvasFactory.create(n,s),this.cache[i]=o),o}delete(i){delete this.cache[i]}clear(){for(const i in this.cache){const n=this.cache[i];this.canvasFactory.destroy(n),delete this.cache[i]}}}function p(v,i,n,s,o,h,A,x,O,Q){const[Z,it,lt,yt,dt,kt]=(0,T.getCurrentTransform)(v);if(it===0&&lt===0){const Rt=A*Z+dt,ft=Math.round(Rt),K=x*yt+kt,$=Math.round(K),ht=(A+O)*Z+dt,Ct=Math.abs(Math.round(ht)-ft)||1,St=(x+Q)*yt+kt,Wt=Math.abs(Math.round(St)-$)||1;return v.setTransform(Math.sign(Z),0,0,Math.sign(yt),ft,$),v.drawImage(i,n,s,o,h,0,0,Ct,Wt),v.setTransform(Z,it,lt,yt,dt,kt),[Ct,Wt]}if(Z===0&&yt===0){const Rt=x*lt+dt,ft=Math.round(Rt),K=A*it+kt,$=Math.round(K),ht=(x+Q)*lt+dt,Ct=Math.abs(Math.round(ht)-ft)||1,St=(A+O)*it+kt,Wt=Math.abs(Math.round(St)-$)||1;return v.setTransform(0,Math.sign(it),Math.sign(lt),0,ft,$),v.drawImage(i,n,s,o,h,0,0,Wt,Ct),v.setTransform(Z,it,lt,yt,dt,kt),[Wt,Ct]}v.drawImage(i,n,s,o,h,A,x,O,Q);const Ut=Math.hypot(Z,it),vt=Math.hypot(lt,yt);return[Ut*O,vt*Q]}function m(v){const{width:i,height:n}=v;if(i>N||n>N)return null;const s=1e3,o=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),h=i+1;let A=new Uint8Array(h*(n+1)),x,O,Q;const Z=i+7&-8;let it=new Uint8Array(Z*n),lt=0;for(const vt of v.data){let Rt=128;for(;Rt>0;)it[lt++]=vt&Rt?0:255,Rt>>=1}let yt=0;for(lt=0,it[lt]!==0&&(A[0]=1,++yt),O=1;O<i;O++)it[lt]!==it[lt+1]&&(A[O]=it[lt]?2:1,++yt),lt++;for(it[lt]!==0&&(A[O]=2,++yt),x=1;x<n;x++){lt=x*Z,Q=x*h,it[lt-Z]!==it[lt]&&(A[Q]=it[lt]?1:8,++yt);let vt=(it[lt]?4:0)+(it[lt-Z]?8:0);for(O=1;O<i;O++)vt=(vt>>2)+(it[lt+1]?4:0)+(it[lt-Z+1]?8:0),o[vt]&&(A[Q+O]=o[vt],++yt),lt++;if(it[lt-Z]!==it[lt]&&(A[Q+O]=it[lt]?2:4,++yt),yt>s)return null}for(lt=Z*(n-1),Q=x*h,it[lt]!==0&&(A[Q]=8,++yt),O=1;O<i;O++)it[lt]!==it[lt+1]&&(A[Q+O]=it[lt]?4:8,++yt),lt++;if(it[lt]!==0&&(A[Q+O]=4,++yt),yt>s)return null;const dt=new Int32Array([0,h,-1,0,-h,0,0,0,1]),kt=new Path2D;for(x=0;yt&&x<=n;x++){let vt=x*h;const Rt=vt+i;for(;vt<Rt&&!A[vt];)vt++;if(vt===Rt)continue;kt.moveTo(vt%h,x);const ft=vt;let K=A[vt];do{const $=dt[K];do vt+=$;while(!A[vt]);const ht=A[vt];ht!==5&&ht!==10?(K=ht,A[vt]=0):(K=ht&51*K>>4,A[vt]&=K>>2|K<<2),kt.lineTo(vt%h,vt/h|0),A[vt]||--yt}while(ft!==vt);--x}return it=null,A=null,function(vt){vt.save(),vt.scale(1/i,-1/n),vt.translate(0,-n),vt.fill(kt),vt.beginPath(),vt.restore()}}class E{constructor(i,n){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=l.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=l.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=l.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,i,n])}clone(){const i=Object.create(this);return i.clipBox=this.clipBox.slice(),i}setCurrentPoint(i,n){this.x=i,this.y=n}updatePathMinMax(i,n,s){[n,s]=l.Util.applyTransform([n,s],i),this.minX=Math.min(this.minX,n),this.minY=Math.min(this.minY,s),this.maxX=Math.max(this.maxX,n),this.maxY=Math.max(this.maxY,s)}updateRectMinMax(i,n){const s=l.Util.applyTransform(n,i),o=l.Util.applyTransform(n.slice(2),i);this.minX=Math.min(this.minX,s[0],o[0]),this.minY=Math.min(this.minY,s[1],o[1]),this.maxX=Math.max(this.maxX,s[0],o[0]),this.maxY=Math.max(this.maxY,s[1],o[1])}updateScalingPathMinMax(i,n){l.Util.scaleMinMax(i,n),this.minX=Math.min(this.minX,n[0]),this.maxX=Math.max(this.maxX,n[1]),this.minY=Math.min(this.minY,n[2]),this.maxY=Math.max(this.maxY,n[3])}updateCurvePathMinMax(i,n,s,o,h,A,x,O,Q,Z){const it=l.Util.bezierBoundingBox(n,s,o,h,A,x,O,Q);if(Z){Z[0]=Math.min(Z[0],it[0],it[2]),Z[1]=Math.max(Z[1],it[0],it[2]),Z[2]=Math.min(Z[2],it[1],it[3]),Z[3]=Math.max(Z[3],it[1],it[3]);return}this.updateRectMinMax(i,it)}getPathBoundingBox(i=rt.PathType.FILL,n=null){const s=[this.minX,this.minY,this.maxX,this.maxY];if(i===rt.PathType.STROKE){n||(0,l.unreachable)("Stroke bounding box must include transform.");const o=l.Util.singularValueDecompose2dScale(n),h=o[0]*this.lineWidth/2,A=o[1]*this.lineWidth/2;s[0]-=h,s[1]-=A,s[2]+=h,s[3]+=A}return s}updateClipFromPath(){const i=l.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(i||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(i){this.clipBox=i,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(i=rt.PathType.FILL,n=null){return l.Util.intersect(this.clipBox,this.getPathBoundingBox(i,n))}}function w(v,i){if(typeof ImageData<"u"&&i instanceof ImageData){v.putImageData(i,0,0);return}const n=i.height,s=i.width,o=n%M,h=(n-o)/M,A=o===0?h:h+1,x=v.createImageData(s,M);let O=0,Q;const Z=i.data,it=x.data;let lt,yt,dt,kt;if(i.kind===l.ImageKind.GRAYSCALE_1BPP){const Ut=Z.byteLength,vt=new Uint32Array(it.buffer,0,it.byteLength>>2),Rt=vt.length,ft=s+7>>3,K=4294967295,$=l.FeatureTest.isLittleEndian?4278190080:255;for(lt=0;lt<A;lt++){for(dt=lt<h?M:o,Q=0,yt=0;yt<dt;yt++){const ht=Ut-O;let Ct=0;const St=ht>ft?s:ht*8-7,Wt=St&-8;let Ht=0,jt=0;for(;Ct<Wt;Ct+=8)jt=Z[O++],vt[Q++]=jt&128?K:$,vt[Q++]=jt&64?K:$,vt[Q++]=jt&32?K:$,vt[Q++]=jt&16?K:$,vt[Q++]=jt&8?K:$,vt[Q++]=jt&4?K:$,vt[Q++]=jt&2?K:$,vt[Q++]=jt&1?K:$;for(;Ct<St;Ct++)Ht===0&&(jt=Z[O++],Ht=128),vt[Q++]=jt&Ht?K:$,Ht>>=1}for(;Q<Rt;)vt[Q++]=0;v.putImageData(x,0,lt*M)}}else if(i.kind===l.ImageKind.RGBA_32BPP){for(yt=0,kt=s*M*4,lt=0;lt<h;lt++)it.set(Z.subarray(O,O+kt)),O+=kt,v.putImageData(x,0,yt),yt+=M;lt<A&&(kt=s*o*4,it.set(Z.subarray(O,O+kt)),v.putImageData(x,0,yt))}else if(i.kind===l.ImageKind.RGB_24BPP)for(dt=M,kt=s*dt,lt=0;lt<A;lt++){for(lt>=h&&(dt=o,kt=s*dt),Q=0,yt=kt;yt--;)it[Q++]=Z[O++],it[Q++]=Z[O++],it[Q++]=Z[O++],it[Q++]=255;v.putImageData(x,0,lt*M)}else throw new Error(`bad image kind: ${i.kind}`)}function _(v,i){if(i.bitmap){v.drawImage(i.bitmap,0,0);return}const n=i.height,s=i.width,o=n%M,h=(n-o)/M,A=o===0?h:h+1,x=v.createImageData(s,M);let O=0;const Q=i.data,Z=x.data;for(let it=0;it<A;it++){const lt=it<h?M:o;({srcPos:O}=(0,z.convertBlackAndWhiteToRGBA)({src:Q,srcPos:O,dest:Z,width:s,height:lt,nonBlackColor:0})),v.putImageData(x,0,it*M)}}function a(v,i){const n=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of n)v[s]!==void 0&&(i[s]=v[s]);v.setLineDash!==void 0&&(i.setLineDash(v.getLineDash()),i.lineDashOffset=v.lineDashOffset)}function c(v){if(v.strokeStyle=v.fillStyle="#000000",v.fillRule="nonzero",v.globalAlpha=1,v.lineWidth=1,v.lineCap="butt",v.lineJoin="miter",v.miterLimit=10,v.globalCompositeOperation="source-over",v.font="10px sans-serif",v.setLineDash!==void 0&&(v.setLineDash([]),v.lineDashOffset=0),!l.isNodeJS){const{filter:i}=v;i!=="none"&&i!==""&&(v.filter="none")}}function d(v,i,n,s){const o=v.length;for(let h=3;h<o;h+=4){const A=v[h];if(A===0)v[h-3]=i,v[h-2]=n,v[h-1]=s;else if(A<255){const x=255-A;v[h-3]=v[h-3]*A+i*x>>8,v[h-2]=v[h-2]*A+n*x>>8,v[h-1]=v[h-1]*A+s*x>>8}}}function r(v,i,n){const s=v.length,o=1/255;for(let h=3;h<s;h+=4){const A=n?n[v[h]]:v[h];i[h]=i[h]*A*o|0}}function f(v,i,n){const s=v.length;for(let o=3;o<s;o+=4){const h=v[o-3]*77+v[o-2]*152+v[o-1]*28;i[o]=n?i[o]*n[h>>8]>>8:i[o]*h>>16}}function F(v,i,n,s,o,h,A,x,O,Q,Z){const it=!!h,lt=it?h[0]:0,yt=it?h[1]:0,dt=it?h[2]:0,kt=o==="Luminosity"?f:r,vt=Math.min(s,Math.ceil(1048576/n));for(let Rt=0;Rt<s;Rt+=vt){const ft=Math.min(vt,s-Rt),K=v.getImageData(x-Q,Rt+(O-Z),n,ft),$=i.getImageData(x,Rt+O,n,ft);it&&d(K.data,lt,yt,dt),kt(K.data,$.data,A),i.putImageData($,x,Rt+O)}}function C(v,i,n,s){const o=s[0],h=s[1],A=s[2]-o,x=s[3]-h;A===0||x===0||(F(i.context,n,A,x,i.subtype,i.backdrop,i.transferMap,o,h,i.offsetX,i.offsetY),v.save(),v.globalAlpha=1,v.globalCompositeOperation="source-over",v.setTransform(1,0,0,1,0,0),v.drawImage(n.canvas,0,0),v.restore())}function X(v,i){const n=l.Util.singularValueDecompose2dScale(v);n[0]=Math.fround(n[0]),n[1]=Math.fround(n[1]);const s=Math.fround((globalThis.devicePixelRatio||1)*T.PixelsPerInch.PDF_TO_CSS_UNITS);return i!==void 0?i:n[0]<=s||n[1]<=s}const Y=["butt","round","square"],P=["miter","round","bevel"],V={},ut={},xt=class xt{constructor(i,n,s,o,h,{optionalContentConfig:A,markedContentStack:x=null},O,Q){D(this,G);D(this,At);this.ctx=i,this.current=new E(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=n,this.objs=s,this.canvasFactory=o,this.filterFactory=h,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=x||[],this.optionalContentConfig=A,this.cachedCanvases=new y(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=O,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=Q,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(i,n=null){return typeof i=="string"?i.startsWith("g_")?this.commonObjs.get(i):this.objs.get(i):n}beginDrawing({transform:i,viewport:n,transparency:s=!1,background:o=null}){const h=this.ctx.canvas.width,A=this.ctx.canvas.height,x=this.ctx.fillStyle;if(this.ctx.fillStyle=o||"#ffffff",this.ctx.fillRect(0,0,h,A),this.ctx.fillStyle=x,s){const O=this.cachedCanvases.getCanvas("transparent",h,A);this.compositeCtx=this.ctx,this.transparentCanvas=O.canvas,this.ctx=O.context,this.ctx.save(),this.ctx.transform(...(0,T.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),c(this.ctx),i&&(this.ctx.transform(...i),this.outputScaleX=i[0],this.outputScaleY=i[0]),this.ctx.transform(...n.transform),this.viewportScale=n.scale,this.baseTransform=(0,T.getCurrentTransform)(this.ctx)}executeOperatorList(i,n,s,o){const h=i.argsArray,A=i.fnArray;let x=n||0;const O=h.length;if(O===x)return x;const Q=O-x>L&&typeof s=="function",Z=Q?Date.now()+g:0;let it=0;const lt=this.commonObjs,yt=this.objs;let dt;for(;;){if(o!==void 0&&x===o.nextBreakPoint)return o.breakIt(x,s),x;if(dt=A[x],dt!==l.OPS.dependency)this[dt].apply(this,h[x]);else for(const kt of h[x]){const Ut=kt.startsWith("g_")?lt:yt;if(!Ut.has(kt))return Ut.get(kt,s),x}if(x++,x===O)return x;if(Q&&++it>L){if(Date.now()>Z)return s(),x;it=0}}}endDrawing(){j(this,G,Je).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const i of this._cachedBitmapsMap.values()){for(const n of i.values())typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement&&(n.width=n.height=0);i.clear()}this._cachedBitmapsMap.clear(),j(this,At,Qe).call(this)}_scaleImage(i,n){const s=i.width,o=i.height;let h=Math.max(Math.hypot(n[0],n[1]),1),A=Math.max(Math.hypot(n[2],n[3]),1),x=s,O=o,Q="prescale1",Z,it;for(;h>2&&x>1||A>2&&O>1;){let lt=x,yt=O;h>2&&x>1&&(lt=x>=16384?Math.floor(x/2)-1||1:Math.ceil(x/2),h/=x/lt),A>2&&O>1&&(yt=O>=16384?Math.floor(O/2)-1||1:Math.ceil(O)/2,A/=O/yt),Z=this.cachedCanvases.getCanvas(Q,lt,yt),it=Z.context,it.clearRect(0,0,lt,yt),it.drawImage(i,0,0,x,O,0,0,lt,yt),i=Z.canvas,x=lt,O=yt,Q=Q==="prescale1"?"prescale2":"prescale1"}return{img:i,paintWidth:x,paintHeight:O}}_createMaskCanvas(i){const n=this.ctx,{width:s,height:o}=i,h=this.current.fillColor,A=this.current.patternFill,x=(0,T.getCurrentTransform)(n);let O,Q,Z,it;if((i.bitmap||i.data)&&i.count>1){const Ct=i.bitmap||i.data.buffer;Q=JSON.stringify(A?x:[x.slice(0,4),h]),O=this._cachedBitmapsMap.get(Ct),O||(O=new Map,this._cachedBitmapsMap.set(Ct,O));const St=O.get(Q);if(St&&!A){const Wt=Math.round(Math.min(x[0],x[2])+x[4]),Ht=Math.round(Math.min(x[1],x[3])+x[5]);return{canvas:St,offsetX:Wt,offsetY:Ht}}Z=St}Z||(it=this.cachedCanvases.getCanvas("maskCanvas",s,o),_(it.context,i));let lt=l.Util.transform(x,[1/s,0,0,-1/o,0,0]);lt=l.Util.transform(lt,[1,0,0,1,0,-o]);const yt=l.Util.applyTransform([0,0],lt),dt=l.Util.applyTransform([s,o],lt),kt=l.Util.normalizeRect([yt[0],yt[1],dt[0],dt[1]]),Ut=Math.round(kt[2]-kt[0])||1,vt=Math.round(kt[3]-kt[1])||1,Rt=this.cachedCanvases.getCanvas("fillCanvas",Ut,vt),ft=Rt.context,K=Math.min(yt[0],dt[0]),$=Math.min(yt[1],dt[1]);ft.translate(-K,-$),ft.transform(...lt),Z||(Z=this._scaleImage(it.canvas,(0,T.getCurrentTransformInverse)(ft)),Z=Z.img,O&&A&&O.set(Q,Z)),ft.imageSmoothingEnabled=X((0,T.getCurrentTransform)(ft),i.interpolate),p(ft,Z,0,0,Z.width,Z.height,0,0,s,o),ft.globalCompositeOperation="source-in";const ht=l.Util.transform((0,T.getCurrentTransformInverse)(ft),[1,0,0,1,-K,-$]);return ft.fillStyle=A?h.getPattern(n,this,ht,rt.PathType.FILL):h,ft.fillRect(0,0,s,o),O&&!A&&(this.cachedCanvases.delete("fillCanvas"),O.set(Q,Rt.canvas)),{canvas:Rt.canvas,offsetX:Math.round(K),offsetY:Math.round($)}}setLineWidth(i){i!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=i,this.ctx.lineWidth=i}setLineCap(i){this.ctx.lineCap=Y[i]}setLineJoin(i){this.ctx.lineJoin=P[i]}setMiterLimit(i){this.ctx.miterLimit=i}setDash(i,n){const s=this.ctx;s.setLineDash!==void 0&&(s.setLineDash(i),s.lineDashOffset=n)}setRenderingIntent(i){}setFlatness(i){}setGState(i){for(const[n,s]of i)switch(n){case"LW":this.setLineWidth(s);break;case"LC":this.setLineCap(s);break;case"LJ":this.setLineJoin(s);break;case"ML":this.setMiterLimit(s);break;case"D":this.setDash(s[0],s[1]);break;case"RI":this.setRenderingIntent(s);break;case"FL":this.setFlatness(s);break;case"Font":this.setFont(s[0],s[1]);break;case"CA":this.current.strokeAlpha=s;break;case"ca":this.current.fillAlpha=s,this.ctx.globalAlpha=s;break;case"BM":this.ctx.globalCompositeOperation=s;break;case"SMask":this.current.activeSMask=s?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(s);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const i=this.inSMaskMode;this.current.activeSMask&&!i?this.beginSMaskMode():!this.current.activeSMask&&i&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const i=this.ctx.canvas.width,n=this.ctx.canvas.height,s="smaskGroupAt"+this.groupLevel,o=this.cachedCanvases.getCanvas(s,i,n);this.suspendedCtx=this.ctx,this.ctx=o.context;const h=this.ctx;h.setTransform(...(0,T.getCurrentTransform)(this.suspendedCtx)),a(this.suspendedCtx,h),S(h,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),a(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(i){if(!this.current.activeSMask)return;i?(i[0]=Math.floor(i[0]),i[1]=Math.floor(i[1]),i[2]=Math.ceil(i[2]),i[3]=Math.ceil(i[3])):i=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const n=this.current.activeSMask,s=this.suspendedCtx;C(s,n,this.ctx,i),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(a(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const i=this.current;this.stateStack.push(i),this.current=i.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),a(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(i,n,s,o,h,A){this.ctx.transform(i,n,s,o,h,A),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(i,n,s){const o=this.ctx,h=this.current;let A=h.x,x=h.y,O,Q;const Z=(0,T.getCurrentTransform)(o),it=Z[0]===0&&Z[3]===0||Z[1]===0&&Z[2]===0,lt=it?s.slice(0):null;for(let yt=0,dt=0,kt=i.length;yt<kt;yt++)switch(i[yt]|0){case l.OPS.rectangle:A=n[dt++],x=n[dt++];const Ut=n[dt++],vt=n[dt++],Rt=A+Ut,ft=x+vt;o.moveTo(A,x),Ut===0||vt===0?o.lineTo(Rt,ft):(o.lineTo(Rt,x),o.lineTo(Rt,ft),o.lineTo(A,ft)),it||h.updateRectMinMax(Z,[A,x,Rt,ft]),o.closePath();break;case l.OPS.moveTo:A=n[dt++],x=n[dt++],o.moveTo(A,x),it||h.updatePathMinMax(Z,A,x);break;case l.OPS.lineTo:A=n[dt++],x=n[dt++],o.lineTo(A,x),it||h.updatePathMinMax(Z,A,x);break;case l.OPS.curveTo:O=A,Q=x,A=n[dt+4],x=n[dt+5],o.bezierCurveTo(n[dt],n[dt+1],n[dt+2],n[dt+3],A,x),h.updateCurvePathMinMax(Z,O,Q,n[dt],n[dt+1],n[dt+2],n[dt+3],A,x,lt),dt+=6;break;case l.OPS.curveTo2:O=A,Q=x,o.bezierCurveTo(A,x,n[dt],n[dt+1],n[dt+2],n[dt+3]),h.updateCurvePathMinMax(Z,O,Q,A,x,n[dt],n[dt+1],n[dt+2],n[dt+3],lt),A=n[dt+2],x=n[dt+3],dt+=4;break;case l.OPS.curveTo3:O=A,Q=x,A=n[dt+2],x=n[dt+3],o.bezierCurveTo(n[dt],n[dt+1],A,x,A,x),h.updateCurvePathMinMax(Z,O,Q,n[dt],n[dt+1],A,x,A,x,lt),dt+=4;break;case l.OPS.closePath:o.closePath();break}it&&h.updateScalingPathMinMax(Z,lt),h.setCurrentPoint(A,x)}closePath(){this.ctx.closePath()}stroke(i=!0){const n=this.ctx,s=this.current.strokeColor;n.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof s=="object"&&s?.getPattern?(n.save(),n.strokeStyle=s.getPattern(n,this,(0,T.getCurrentTransformInverse)(n),rt.PathType.STROKE),this.rescaleAndStroke(!1),n.restore()):this.rescaleAndStroke(!0)),i&&this.consumePath(this.current.getClippedPathBoundingBox()),n.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(i=!0){const n=this.ctx,s=this.current.fillColor,o=this.current.patternFill;let h=!1;o&&(n.save(),n.fillStyle=s.getPattern(n,this,(0,T.getCurrentTransformInverse)(n),rt.PathType.FILL),h=!0);const A=this.current.getClippedPathBoundingBox();this.contentVisible&&A!==null&&(this.pendingEOFill?(n.fill("evenodd"),this.pendingEOFill=!1):n.fill()),h&&n.restore(),i&&this.consumePath(A)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=V}eoClip(){this.pendingClip=ut}beginText(){this.current.textMatrix=l.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const i=this.pendingTextPaths,n=this.ctx;if(i===void 0){n.beginPath();return}n.save(),n.beginPath();for(const s of i)n.setTransform(...s.transform),n.translate(s.x,s.y),s.addToPath(n,s.fontSize);n.restore(),n.clip(),n.beginPath(),delete this.pendingTextPaths}setCharSpacing(i){this.current.charSpacing=i}setWordSpacing(i){this.current.wordSpacing=i}setHScale(i){this.current.textHScale=i/100}setLeading(i){this.current.leading=-i}setFont(i,n){const s=this.commonObjs.get(i),o=this.current;if(!s)throw new Error(`Can't find font for ${i}`);if(o.fontMatrix=s.fontMatrix||l.FONT_IDENTITY_MATRIX,(o.fontMatrix[0]===0||o.fontMatrix[3]===0)&&(0,l.warn)("Invalid font matrix for font "+i),n<0?(n=-n,o.fontDirection=-1):o.fontDirection=1,this.current.font=s,this.current.fontSize=n,s.isType3Font)return;const h=s.loadedName||"sans-serif",A=s.systemFontInfo?.css||`"${h}", ${s.fallbackName}`;let x="normal";s.black?x="900":s.bold&&(x="bold");const O=s.italic?"italic":"normal";let Q=n;n<gt?Q=gt:n>B&&(Q=B),this.current.fontSizeScale=n/Q,this.ctx.font=`${O} ${x} ${Q}px ${A}`}setTextRenderingMode(i){this.current.textRenderingMode=i}setTextRise(i){this.current.textRise=i}moveText(i,n){this.current.x=this.current.lineX+=i,this.current.y=this.current.lineY+=n}setLeadingMoveText(i,n){this.setLeading(-n),this.moveText(i,n)}setTextMatrix(i,n,s,o,h,A){this.current.textMatrix=[i,n,s,o,h,A],this.current.textMatrixScale=Math.hypot(i,n),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(i,n,s,o){const h=this.ctx,A=this.current,x=A.font,O=A.textRenderingMode,Q=A.fontSize/A.fontSizeScale,Z=O&l.TextRenderingMode.FILL_STROKE_MASK,it=!!(O&l.TextRenderingMode.ADD_TO_PATH_FLAG),lt=A.patternFill&&!x.missingFile;let yt;(x.disableFontFace||it||lt)&&(yt=x.getPathGenerator(this.commonObjs,i)),x.disableFontFace||lt?(h.save(),h.translate(n,s),h.beginPath(),yt(h,Q),o&&h.setTransform(...o),(Z===l.TextRenderingMode.FILL||Z===l.TextRenderingMode.FILL_STROKE)&&h.fill(),(Z===l.TextRenderingMode.STROKE||Z===l.TextRenderingMode.FILL_STROKE)&&h.stroke(),h.restore()):((Z===l.TextRenderingMode.FILL||Z===l.TextRenderingMode.FILL_STROKE)&&h.fillText(i,n,s),(Z===l.TextRenderingMode.STROKE||Z===l.TextRenderingMode.FILL_STROKE)&&h.strokeText(i,n,s)),it&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,T.getCurrentTransform)(h),x:n,y:s,fontSize:Q,addToPath:yt})}get isFontSubpixelAAEnabled(){const{context:i}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);i.scale(1.5,1),i.fillText("I",0,10);const n=i.getImageData(0,0,10,10).data;let s=!1;for(let o=3;o<n.length;o+=4)if(n[o]>0&&n[o]<255){s=!0;break}return(0,l.shadow)(this,"isFontSubpixelAAEnabled",s)}showText(i){const n=this.current,s=n.font;if(s.isType3Font)return this.showType3Text(i);const o=n.fontSize;if(o===0)return;const h=this.ctx,A=n.fontSizeScale,x=n.charSpacing,O=n.wordSpacing,Q=n.fontDirection,Z=n.textHScale*Q,it=i.length,lt=s.vertical,yt=lt?1:-1,dt=s.defaultVMetrics,kt=o*n.fontMatrix[0],Ut=n.textRenderingMode===l.TextRenderingMode.FILL&&!s.disableFontFace&&!n.patternFill;h.save(),h.transform(...n.textMatrix),h.translate(n.x,n.y+n.textRise),Q>0?h.scale(Z,-1):h.scale(Z,1);let vt;if(n.patternFill){h.save();const ht=n.fillColor.getPattern(h,this,(0,T.getCurrentTransformInverse)(h),rt.PathType.FILL);vt=(0,T.getCurrentTransform)(h),h.restore(),h.fillStyle=ht}let Rt=n.lineWidth;const ft=n.textMatrixScale;if(ft===0||Rt===0){const ht=n.textRenderingMode&l.TextRenderingMode.FILL_STROKE_MASK;(ht===l.TextRenderingMode.STROKE||ht===l.TextRenderingMode.FILL_STROKE)&&(Rt=this.getSinglePixelWidth())}else Rt/=ft;if(A!==1&&(h.scale(A,A),Rt/=A),h.lineWidth=Rt,s.isInvalidPDFjsFont){const ht=[];let Ct=0;for(const St of i)ht.push(St.unicode),Ct+=St.width;h.fillText(ht.join(""),0,0),n.x+=Ct*kt*Z,h.restore(),this.compose();return}let K=0,$;for($=0;$<it;++$){const ht=i[$];if(typeof ht=="number"){K+=yt*ht*o/1e3;continue}let Ct=!1;const St=(ht.isSpace?O:0)+x,Wt=ht.fontChar,Ht=ht.accent;let jt,Xt,Gt=ht.width;if(lt){const zt=ht.vmetric||dt,ot=-(ht.vmetric?zt[1]:Gt*.5)*kt,tt=zt[2]*kt;Gt=zt?-zt[0]:Gt,jt=ot/A,Xt=(K+tt)/A}else jt=K/A,Xt=0;if(s.remeasure&&Gt>0){const zt=h.measureText(Wt).width*1e3/o*A;if(Gt<zt&&this.isFontSubpixelAAEnabled){const ot=Gt/zt;Ct=!0,h.save(),h.scale(ot,1),jt/=ot}else Gt!==zt&&(jt+=(Gt-zt)/2e3*o/A)}if(this.contentVisible&&(ht.isInFont||s.missingFile)){if(Ut&&!Ht)h.fillText(Wt,jt,Xt);else if(this.paintChar(Wt,jt,Xt,vt),Ht){const zt=jt+o*Ht.offset.x/A,ot=Xt-o*Ht.offset.y/A;this.paintChar(Ht.fontChar,zt,ot,vt)}}const qt=lt?Gt*kt-St*Q:Gt*kt+St*Q;K+=qt,Ct&&h.restore()}lt?n.y-=K:n.x+=K*Z,h.restore(),this.compose()}showType3Text(i){const n=this.ctx,s=this.current,o=s.font,h=s.fontSize,A=s.fontDirection,x=o.vertical?1:-1,O=s.charSpacing,Q=s.wordSpacing,Z=s.textHScale*A,it=s.fontMatrix||l.FONT_IDENTITY_MATRIX,lt=i.length,yt=s.textRenderingMode===l.TextRenderingMode.INVISIBLE;let dt,kt,Ut,vt;if(!(yt||h===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,n.save(),n.transform(...s.textMatrix),n.translate(s.x,s.y),n.scale(Z,A),dt=0;dt<lt;++dt){if(kt=i[dt],typeof kt=="number"){vt=x*kt*h/1e3,this.ctx.translate(vt,0),s.x+=vt*Z;continue}const Rt=(kt.isSpace?Q:0)+O,ft=o.charProcOperatorList[kt.operatorListId];if(!ft){(0,l.warn)(`Type3 character "${kt.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=kt,this.save(),n.scale(h,h),n.transform(...it),this.executeOperatorList(ft),this.restore()),Ut=l.Util.applyTransform([kt.width,0],it)[0]*h+Rt,n.translate(Ut,0),s.x+=Ut*Z}n.restore(),this.processingType3=null}}setCharWidth(i,n){}setCharWidthAndBounds(i,n,s,o,h,A){this.ctx.rect(s,o,h-s,A-o),this.ctx.clip(),this.endPath()}getColorN_Pattern(i){let n;if(i[0]==="TilingPattern"){const s=i[1],o=this.baseTransform||(0,T.getCurrentTransform)(this.ctx),h={createCanvasGraphics:A=>new xt(A,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};n=new rt.TilingPattern(i,s,this.ctx,h,o)}else n=this._getPattern(i[1],i[2]);return n}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(i,n,s){const o=l.Util.makeHexColor(i,n,s);this.ctx.strokeStyle=o,this.current.strokeColor=o}setFillRGBColor(i,n,s){const o=l.Util.makeHexColor(i,n,s);this.ctx.fillStyle=o,this.current.fillColor=o,this.current.patternFill=!1}_getPattern(i,n=null){let s;return this.cachedPatterns.has(i)?s=this.cachedPatterns.get(i):(s=(0,rt.getShadingPattern)(this.getObject(i)),this.cachedPatterns.set(i,s)),n&&(s.matrix=n),s}shadingFill(i){if(!this.contentVisible)return;const n=this.ctx;this.save();const s=this._getPattern(i);n.fillStyle=s.getPattern(n,this,(0,T.getCurrentTransformInverse)(n),rt.PathType.SHADING);const o=(0,T.getCurrentTransformInverse)(n);if(o){const{width:h,height:A}=n.canvas,[x,O,Q,Z]=l.Util.getAxialAlignedBoundingBox([0,0,h,A],o);this.ctx.fillRect(x,O,Q-x,Z-O)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,l.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,l.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(i,n){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(i)&&i.length===6&&this.transform(...i),this.baseTransform=(0,T.getCurrentTransform)(this.ctx),n)){const s=n[2]-n[0],o=n[3]-n[1];this.ctx.rect(n[0],n[1],s,o),this.current.updateRectMinMax((0,T.getCurrentTransform)(this.ctx),n),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(i){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const n=this.ctx;i.isolated||(0,l.info)("TODO: Support non-isolated groups."),i.knockout&&(0,l.warn)("Knockout groups not supported.");const s=(0,T.getCurrentTransform)(n);if(i.matrix&&n.transform(...i.matrix),!i.bbox)throw new Error("Bounding box is required.");let o=l.Util.getAxialAlignedBoundingBox(i.bbox,(0,T.getCurrentTransform)(n));const h=[0,0,n.canvas.width,n.canvas.height];o=l.Util.intersect(o,h)||[0,0,0,0];const A=Math.floor(o[0]),x=Math.floor(o[1]);let O=Math.max(Math.ceil(o[2])-A,1),Q=Math.max(Math.ceil(o[3])-x,1),Z=1,it=1;O>k&&(Z=O/k,O=k),Q>k&&(it=Q/k,Q=k),this.current.startNewPathAndClipBox([0,0,O,Q]);let lt="groupAt"+this.groupLevel;i.smask&&(lt+="_smask_"+this.smaskCounter++%2);const yt=this.cachedCanvases.getCanvas(lt,O,Q),dt=yt.context;dt.scale(1/Z,1/it),dt.translate(-A,-x),dt.transform(...s),i.smask?this.smaskStack.push({canvas:yt.canvas,context:dt,offsetX:A,offsetY:x,scaleX:Z,scaleY:it,subtype:i.smask.subtype,backdrop:i.smask.backdrop,transferMap:i.smask.transferMap||null,startTransformInverse:null}):(n.setTransform(1,0,0,1,0,0),n.translate(A,x),n.scale(Z,it),n.save()),a(n,dt),this.ctx=dt,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(n),this.groupLevel++}endGroup(i){if(!this.contentVisible)return;this.groupLevel--;const n=this.ctx,s=this.groupStack.pop();if(this.ctx=s,this.ctx.imageSmoothingEnabled=!1,i.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const o=(0,T.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...o);const h=l.Util.getAxialAlignedBoundingBox([0,0,n.canvas.width,n.canvas.height],o);this.ctx.drawImage(n.canvas,0,0),this.ctx.restore(),this.compose(h)}}beginAnnotation(i,n,s,o,h){if(j(this,G,Je).call(this),c(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(n)&&n.length===4){const A=n[2]-n[0],x=n[3]-n[1];if(h&&this.annotationCanvasMap){s=s.slice(),s[4]-=n[0],s[5]-=n[1],n=n.slice(),n[0]=n[1]=0,n[2]=A,n[3]=x;const[O,Q]=l.Util.singularValueDecompose2dScale((0,T.getCurrentTransform)(this.ctx)),{viewportScale:Z}=this,it=Math.ceil(A*this.outputScaleX*Z),lt=Math.ceil(x*this.outputScaleY*Z);this.annotationCanvas=this.canvasFactory.create(it,lt);const{canvas:yt,context:dt}=this.annotationCanvas;this.annotationCanvasMap.set(i,yt),this.annotationCanvas.savedCtx=this.ctx,this.ctx=dt,this.ctx.save(),this.ctx.setTransform(O,0,0,-Q,0,x*Q),c(this.ctx)}else c(this.ctx),this.ctx.rect(n[0],n[1],A,x),this.ctx.clip(),this.endPath()}this.current=new E(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...s),this.transform(...o)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),j(this,At,Qe).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(i){if(!this.contentVisible)return;const n=i.count;i=this.getObject(i.data,i),i.count=n;const s=this.ctx,o=this.processingType3;if(o&&(o.compiled===void 0&&(o.compiled=m(i)),o.compiled)){o.compiled(s);return}const h=this._createMaskCanvas(i),A=h.canvas;s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(A,h.offsetX,h.offsetY),s.restore(),this.compose()}paintImageMaskXObjectRepeat(i,n,s=0,o=0,h,A){if(!this.contentVisible)return;i=this.getObject(i.data,i);const x=this.ctx;x.save();const O=(0,T.getCurrentTransform)(x);x.transform(n,s,o,h,0,0);const Q=this._createMaskCanvas(i);x.setTransform(1,0,0,1,Q.offsetX-O[4],Q.offsetY-O[5]);for(let Z=0,it=A.length;Z<it;Z+=2){const lt=l.Util.transform(O,[n,s,o,h,A[Z],A[Z+1]]),[yt,dt]=l.Util.applyTransform([0,0],lt);x.drawImage(Q.canvas,yt,dt)}x.restore(),this.compose()}paintImageMaskXObjectGroup(i){if(!this.contentVisible)return;const n=this.ctx,s=this.current.fillColor,o=this.current.patternFill;for(const h of i){const{data:A,width:x,height:O,transform:Q}=h,Z=this.cachedCanvases.getCanvas("maskCanvas",x,O),it=Z.context;it.save();const lt=this.getObject(A,h);_(it,lt),it.globalCompositeOperation="source-in",it.fillStyle=o?s.getPattern(it,this,(0,T.getCurrentTransformInverse)(n),rt.PathType.FILL):s,it.fillRect(0,0,x,O),it.restore(),n.save(),n.transform(...Q),n.scale(1,-1),p(n,Z.canvas,0,0,x,O,0,-1,1,1),n.restore()}this.compose()}paintImageXObject(i){if(!this.contentVisible)return;const n=this.getObject(i);if(!n){(0,l.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(n)}paintImageXObjectRepeat(i,n,s,o){if(!this.contentVisible)return;const h=this.getObject(i);if(!h){(0,l.warn)("Dependent image isn't ready yet");return}const A=h.width,x=h.height,O=[];for(let Q=0,Z=o.length;Q<Z;Q+=2)O.push({transform:[n,0,0,s,o[Q],o[Q+1]],x:0,y:0,w:A,h:x});this.paintInlineImageXObjectGroup(h,O)}applyTransferMapsToCanvas(i){return this.current.transferMaps!=="none"&&(i.filter=this.current.transferMaps,i.drawImage(i.canvas,0,0),i.filter="none"),i.canvas}applyTransferMapsToBitmap(i){if(this.current.transferMaps==="none")return i.bitmap;const{bitmap:n,width:s,height:o}=i,h=this.cachedCanvases.getCanvas("inlineImage",s,o),A=h.context;return A.filter=this.current.transferMaps,A.drawImage(n,0,0),A.filter="none",h.canvas}paintInlineImageXObject(i){if(!this.contentVisible)return;const n=i.width,s=i.height,o=this.ctx;if(this.save(),!l.isNodeJS){const{filter:x}=o;x!=="none"&&x!==""&&(o.filter="none")}o.scale(1/n,-1/s);let h;if(i.bitmap)h=this.applyTransferMapsToBitmap(i);else if(typeof HTMLElement=="function"&&i instanceof HTMLElement||!i.data)h=i;else{const O=this.cachedCanvases.getCanvas("inlineImage",n,s).context;w(O,i),h=this.applyTransferMapsToCanvas(O)}const A=this._scaleImage(h,(0,T.getCurrentTransformInverse)(o));o.imageSmoothingEnabled=X((0,T.getCurrentTransform)(o),i.interpolate),p(o,A.img,0,0,A.paintWidth,A.paintHeight,0,-s,n,s),this.compose(),this.restore()}paintInlineImageXObjectGroup(i,n){if(!this.contentVisible)return;const s=this.ctx;let o;if(i.bitmap)o=i.bitmap;else{const h=i.width,A=i.height,O=this.cachedCanvases.getCanvas("inlineImage",h,A).context;w(O,i),o=this.applyTransferMapsToCanvas(O)}for(const h of n)s.save(),s.transform(...h.transform),s.scale(1,-1),p(s,o,h.x,h.y,h.w,h.h,0,-1,1,1),s.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(i){}markPointProps(i,n){}beginMarkedContent(i){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(i,n){i==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(n)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(i){const n=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(i);const s=this.ctx;this.pendingClip&&(n||(this.pendingClip===ut?s.clip("evenodd"):s.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),s.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const i=(0,T.getCurrentTransform)(this.ctx);if(i[1]===0&&i[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(i[0]),Math.abs(i[3]));else{const n=Math.abs(i[0]*i[3]-i[2]*i[1]),s=Math.hypot(i[0],i[2]),o=Math.hypot(i[1],i[3]);this._cachedGetSinglePixelWidth=Math.max(s,o)/n}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:i}=this.current,{a:n,b:s,c:o,d:h}=this.ctx.getTransform();let A,x;if(s===0&&o===0){const O=Math.abs(n),Q=Math.abs(h);if(O===Q)if(i===0)A=x=1/O;else{const Z=O*i;A=x=Z<1?1/Z:1}else if(i===0)A=1/O,x=1/Q;else{const Z=O*i,it=Q*i;A=Z<1?1/Z:1,x=it<1?1/it:1}}else{const O=Math.abs(n*h-s*o),Q=Math.hypot(n,s),Z=Math.hypot(o,h);if(i===0)A=Z/O,x=Q/O;else{const it=i*O;A=Z>it?Z/it:1,x=Q>it?Q/it:1}}this._cachedScaleForStroking[0]=A,this._cachedScaleForStroking[1]=x}return this._cachedScaleForStroking}rescaleAndStroke(i){const{ctx:n}=this,{lineWidth:s}=this.current,[o,h]=this.getScaleForStroking();if(n.lineWidth=s||1,o===1&&h===1){n.stroke();return}const A=n.getLineDash();if(i&&n.save(),n.scale(o,h),A.length>0){const x=Math.max(o,h);n.setLineDash(A.map(O=>O/x)),n.lineDashOffset/=x}n.stroke(),i&&n.restore()}isContentVisible(){for(let i=this.markedContentStack.length-1;i>=0;i--)if(!this.markedContentStack[i].visible)return!1;return!0}};G=new WeakSet,Je=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},At=new WeakSet,Qe=function(){if(this.pageColors){const i=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(i!=="none"){const n=this.ctx.filter;this.ctx.filter=i,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=n}}};let nt=xt;u.CanvasGraphics=nt;for(const v in l.OPS)nt.prototype[v]!==void 0&&(nt.prototype[l.OPS[v]]=nt.prototype[v])},(pt,u,et)=>{Object.defineProperty(u,"__esModule",{value:!0}),u.TilingPattern=u.PathType=void 0,u.getShadingPattern=M;var l=et(1),T=et(6);const rt={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};u.PathType=rt;function z(m,E){if(!E)return;const w=E[2]-E[0],_=E[3]-E[1],a=new Path2D;a.rect(E[0],E[1],w,_),m.clip(a)}class gt{constructor(){this.constructor===gt&&(0,l.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,l.unreachable)("Abstract method `getPattern` called.")}}class B extends gt{constructor(E){super(),this._type=E[1],this._bbox=E[2],this._colorStops=E[3],this._p0=E[4],this._p1=E[5],this._r0=E[6],this._r1=E[7],this.matrix=null}_createGradient(E){let w;this._type==="axial"?w=E.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(w=E.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const _ of this._colorStops)w.addColorStop(_[0],_[1]);return w}getPattern(E,w,_,a){let c;if(a===rt.STROKE||a===rt.FILL){const d=w.current.getClippedPathBoundingBox(a,(0,T.getCurrentTransform)(E))||[0,0,0,0],r=Math.ceil(d[2]-d[0])||1,f=Math.ceil(d[3]-d[1])||1,F=w.cachedCanvases.getCanvas("pattern",r,f,!0),C=F.context;C.clearRect(0,0,C.canvas.width,C.canvas.height),C.beginPath(),C.rect(0,0,C.canvas.width,C.canvas.height),C.translate(-d[0],-d[1]),_=l.Util.transform(_,[1,0,0,1,d[0],d[1]]),C.transform(...w.baseTransform),this.matrix&&C.transform(...this.matrix),z(C,this._bbox),C.fillStyle=this._createGradient(C),C.fill(),c=E.createPattern(F.canvas,"no-repeat");const X=new DOMMatrix(_);c.setTransform(X)}else z(E,this._bbox),c=this._createGradient(E);return c}}function k(m,E,w,_,a,c,d,r){const f=E.coords,F=E.colors,C=m.data,X=m.width*4;let Y;f[w+1]>f[_+1]&&(Y=w,w=_,_=Y,Y=c,c=d,d=Y),f[_+1]>f[a+1]&&(Y=_,_=a,a=Y,Y=d,d=r,r=Y),f[w+1]>f[_+1]&&(Y=w,w=_,_=Y,Y=c,c=d,d=Y);const P=(f[w]+E.offsetX)*E.scaleX,V=(f[w+1]+E.offsetY)*E.scaleY,ut=(f[_]+E.offsetX)*E.scaleX,nt=(f[_+1]+E.offsetY)*E.scaleY,G=(f[a]+E.offsetX)*E.scaleX,at=(f[a+1]+E.offsetY)*E.scaleY;if(V>=at)return;const At=F[c],Tt=F[c+1],xt=F[c+2],v=F[d],i=F[d+1],n=F[d+2],s=F[r],o=F[r+1],h=F[r+2],A=Math.round(V),x=Math.round(at);let O,Q,Z,it,lt,yt,dt,kt;for(let Ut=A;Ut<=x;Ut++){if(Ut<nt){const $=Ut<V?0:(V-Ut)/(V-nt);O=P-(P-ut)*$,Q=At-(At-v)*$,Z=Tt-(Tt-i)*$,it=xt-(xt-n)*$}else{let $;Ut>at?$=1:nt===at?$=0:$=(nt-Ut)/(nt-at),O=ut-(ut-G)*$,Q=v-(v-s)*$,Z=i-(i-o)*$,it=n-(n-h)*$}let vt;Ut<V?vt=0:Ut>at?vt=1:vt=(V-Ut)/(V-at),lt=P-(P-G)*vt,yt=At-(At-s)*vt,dt=Tt-(Tt-o)*vt,kt=xt-(xt-h)*vt;const Rt=Math.round(Math.min(O,lt)),ft=Math.round(Math.max(O,lt));let K=X*Ut+Rt*4;for(let $=Rt;$<=ft;$++)vt=(O-$)/(O-lt),vt<0?vt=0:vt>1&&(vt=1),C[K++]=Q-(Q-yt)*vt|0,C[K++]=Z-(Z-dt)*vt|0,C[K++]=it-(it-kt)*vt|0,C[K++]=255}}function g(m,E,w){const _=E.coords,a=E.colors;let c,d;switch(E.type){case"lattice":const r=E.verticesPerRow,f=Math.floor(_.length/r)-1,F=r-1;for(c=0;c<f;c++){let C=c*r;for(let X=0;X<F;X++,C++)k(m,w,_[C],_[C+1],_[C+r],a[C],a[C+1],a[C+r]),k(m,w,_[C+r+1],_[C+1],_[C+r],a[C+r+1],a[C+1],a[C+r])}break;case"triangles":for(c=0,d=_.length;c<d;c+=3)k(m,w,_[c],_[c+1],_[c+2],a[c],a[c+1],a[c+2]);break;default:throw new Error("illegal figure")}}class L extends gt{constructor(E){super(),this._coords=E[2],this._colors=E[3],this._figures=E[4],this._bounds=E[5],this._bbox=E[7],this._background=E[8],this.matrix=null}_createMeshCanvas(E,w,_){const r=Math.floor(this._bounds[0]),f=Math.floor(this._bounds[1]),F=Math.ceil(this._bounds[2])-r,C=Math.ceil(this._bounds[3])-f,X=Math.min(Math.ceil(Math.abs(F*E[0]*1.1)),3e3),Y=Math.min(Math.ceil(Math.abs(C*E[1]*1.1)),3e3),P=F/X,V=C/Y,ut={coords:this._coords,colors:this._colors,offsetX:-r,offsetY:-f,scaleX:1/P,scaleY:1/V},nt=X+2*2,G=Y+2*2,at=_.getCanvas("mesh",nt,G,!1),At=at.context,Tt=At.createImageData(X,Y);if(w){const v=Tt.data;for(let i=0,n=v.length;i<n;i+=4)v[i]=w[0],v[i+1]=w[1],v[i+2]=w[2],v[i+3]=255}for(const v of this._figures)g(Tt,v,ut);return At.putImageData(Tt,2,2),{canvas:at.canvas,offsetX:r-2*P,offsetY:f-2*V,scaleX:P,scaleY:V}}getPattern(E,w,_,a){z(E,this._bbox);let c;if(a===rt.SHADING)c=l.Util.singularValueDecompose2dScale((0,T.getCurrentTransform)(E));else if(c=l.Util.singularValueDecompose2dScale(w.baseTransform),this.matrix){const r=l.Util.singularValueDecompose2dScale(this.matrix);c=[c[0]*r[0],c[1]*r[1]]}const d=this._createMeshCanvas(c,a===rt.SHADING?null:this._background,w.cachedCanvases);return a!==rt.SHADING&&(E.setTransform(...w.baseTransform),this.matrix&&E.transform(...this.matrix)),E.translate(d.offsetX,d.offsetY),E.scale(d.scaleX,d.scaleY),E.createPattern(d.canvas,"no-repeat")}}class N extends gt{getPattern(){return"hotpink"}}function M(m){switch(m[0]){case"RadialAxial":return new B(m);case"Mesh":return new L(m);case"Dummy":return new N}throw new Error(`Unknown IR type: ${m[0]}`)}const S={COLORED:1,UNCOLORED:2},p=class p{constructor(E,w,_,a,c){this.operatorList=E[2],this.matrix=E[3]||[1,0,0,1,0,0],this.bbox=E[4],this.xstep=E[5],this.ystep=E[6],this.paintType=E[7],this.tilingType=E[8],this.color=w,this.ctx=_,this.canvasGraphicsFactory=a,this.baseTransform=c}createPatternCanvas(E){const w=this.operatorList,_=this.bbox,a=this.xstep,c=this.ystep,d=this.paintType,r=this.tilingType,f=this.color,F=this.canvasGraphicsFactory;(0,l.info)("TilingType: "+r);const C=_[0],X=_[1],Y=_[2],P=_[3],V=l.Util.singularValueDecompose2dScale(this.matrix),ut=l.Util.singularValueDecompose2dScale(this.baseTransform),nt=[V[0]*ut[0],V[1]*ut[1]],G=this.getSizeAndScale(a,this.ctx.canvas.width,nt[0]),at=this.getSizeAndScale(c,this.ctx.canvas.height,nt[1]),At=E.cachedCanvases.getCanvas("pattern",G.size,at.size,!0),Tt=At.context,xt=F.createCanvasGraphics(Tt);xt.groupLevel=E.groupLevel,this.setFillAndStrokeStyleToContext(xt,d,f);let v=C,i=X,n=Y,s=P;return C<0&&(v=0,n+=Math.abs(C)),X<0&&(i=0,s+=Math.abs(X)),Tt.translate(-(G.scale*v),-(at.scale*i)),xt.transform(G.scale,0,0,at.scale,0,0),Tt.save(),this.clipBbox(xt,v,i,n,s),xt.baseTransform=(0,T.getCurrentTransform)(xt.ctx),xt.executeOperatorList(w),xt.endDrawing(),{canvas:At.canvas,scaleX:G.scale,scaleY:at.scale,offsetX:v,offsetY:i}}getSizeAndScale(E,w,_){E=Math.abs(E);const a=Math.max(p.MAX_PATTERN_SIZE,w);let c=Math.ceil(E*_);return c>=a?c=a:_=c/E,{scale:_,size:c}}clipBbox(E,w,_,a,c){const d=a-w,r=c-_;E.ctx.rect(w,_,d,r),E.current.updateRectMinMax((0,T.getCurrentTransform)(E.ctx),[w,_,a,c]),E.clip(),E.endPath()}setFillAndStrokeStyleToContext(E,w,_){const a=E.ctx,c=E.current;switch(w){case S.COLORED:const d=this.ctx;a.fillStyle=d.fillStyle,a.strokeStyle=d.strokeStyle,c.fillColor=d.fillStyle,c.strokeColor=d.strokeStyle;break;case S.UNCOLORED:const r=l.Util.makeHexColor(_[0],_[1],_[2]);a.fillStyle=r,a.strokeStyle=r,c.fillColor=r,c.strokeColor=r;break;default:throw new l.FormatError(`Unsupported paint type: ${w}`)}}getPattern(E,w,_,a){let c=_;a!==rt.SHADING&&(c=l.Util.transform(c,w.baseTransform),this.matrix&&(c=l.Util.transform(c,this.matrix)));const d=this.createPatternCanvas(w);let r=new DOMMatrix(c);r=r.translate(d.offsetX,d.offsetY),r=r.scale(1/d.scaleX,1/d.scaleY);const f=E.createPattern(d.canvas,"repeat");return f.setTransform(r),f}};Zt(p,"MAX_PATTERN_SIZE",3e3);let y=p;u.TilingPattern=y},(pt,u,et)=>{Object.defineProperty(u,"__esModule",{value:!0}),u.convertBlackAndWhiteToRGBA=rt,u.convertToRGBA=T,u.grayToRGBA=gt;var l=et(1);function T(B){switch(B.kind){case l.ImageKind.GRAYSCALE_1BPP:return rt(B);case l.ImageKind.RGB_24BPP:return z(B)}return null}function rt({src:B,srcPos:k=0,dest:g,width:L,height:N,nonBlackColor:M=4294967295,inverseDecode:S=!1}){const y=l.FeatureTest.isLittleEndian?4278190080:255,[p,m]=S?[M,y]:[y,M],E=L>>3,w=L&7,_=B.length;g=new Uint32Array(g.buffer);let a=0;for(let c=0;c<N;c++){for(const r=k+E;k<r;k++){const f=k<_?B[k]:255;g[a++]=f&128?m:p,g[a++]=f&64?m:p,g[a++]=f&32?m:p,g[a++]=f&16?m:p,g[a++]=f&8?m:p,g[a++]=f&4?m:p,g[a++]=f&2?m:p,g[a++]=f&1?m:p}if(w===0)continue;const d=k<_?B[k++]:255;for(let r=0;r<w;r++)g[a++]=d&1<<7-r?m:p}return{srcPos:k,destPos:a}}function z({src:B,srcPos:k=0,dest:g,destPos:L=0,width:N,height:M}){let S=0;const y=B.length>>2,p=new Uint32Array(B.buffer,k,y);if(l.FeatureTest.isLittleEndian){for(;S<y-2;S+=3,L+=4){const m=p[S],E=p[S+1],w=p[S+2];g[L]=m|4278190080,g[L+1]=m>>>24|E<<8|4278190080,g[L+2]=E>>>16|w<<16|4278190080,g[L+3]=w>>>8|4278190080}for(let m=S*4,E=B.length;m<E;m+=3)g[L++]=B[m]|B[m+1]<<8|B[m+2]<<16|4278190080}else{for(;S<y-2;S+=3,L+=4){const m=p[S],E=p[S+1],w=p[S+2];g[L]=m|255,g[L+1]=m<<24|E>>>8|255,g[L+2]=E<<16|w>>>16|255,g[L+3]=w<<8|255}for(let m=S*4,E=B.length;m<E;m+=3)g[L++]=B[m]<<24|B[m+1]<<16|B[m+2]<<8|255}return{srcPos:k,destPos:L}}function gt(B,k){if(l.FeatureTest.isLittleEndian)for(let g=0,L=B.length;g<L;g++)k[g]=B[g]*65793|4278190080;else for(let g=0,L=B.length;g<L;g++)k[g]=B[g]*16843008|255}},(pt,u)=>{Object.defineProperty(u,"__esModule",{value:!0}),u.GlobalWorkerOptions=void 0;const et=Object.create(null);u.GlobalWorkerOptions=et,et.workerPort=null,et.workerSrc=""},(pt,u,et)=>{var B,Pi,g,ki,N,xe;Object.defineProperty(u,"__esModule",{value:!0}),u.MessageHandler=void 0;var l=et(1);const T={UNKNOWN:0,DATA:1,ERROR:2},rt={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function z(S){switch(S instanceof Error||typeof S=="object"&&S!==null||(0,l.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),S.name){case"AbortException":return new l.AbortException(S.message);case"MissingPDFException":return new l.MissingPDFException(S.message);case"PasswordException":return new l.PasswordException(S.message,S.code);case"UnexpectedResponseException":return new l.UnexpectedResponseException(S.message,S.status);case"UnknownErrorException":return new l.UnknownErrorException(S.message,S.details);default:return new l.UnknownErrorException(S.message,S.toString())}}class gt{constructor(y,p,m){D(this,B);D(this,g);D(this,N);this.sourceName=y,this.targetName=p,this.comObj=m,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=E=>{const w=E.data;if(w.targetName!==this.sourceName)return;if(w.stream){j(this,g,ki).call(this,w);return}if(w.callback){const a=w.callbackId,c=this.callbackCapabilities[a];if(!c)throw new Error(`Cannot resolve callback ${a}`);if(delete this.callbackCapabilities[a],w.callback===T.DATA)c.resolve(w.data);else if(w.callback===T.ERROR)c.reject(z(w.reason));else throw new Error("Unexpected callback case");return}const _=this.actionHandler[w.action];if(!_)throw new Error(`Unknown action from worker: ${w.action}`);if(w.callbackId){const a=this.sourceName,c=w.sourceName;new Promise(function(d){d(_(w.data))}).then(function(d){m.postMessage({sourceName:a,targetName:c,callback:T.DATA,callbackId:w.callbackId,data:d})},function(d){m.postMessage({sourceName:a,targetName:c,callback:T.ERROR,callbackId:w.callbackId,reason:z(d)})});return}if(w.streamId){j(this,B,Pi).call(this,w);return}_(w.data)},m.addEventListener("message",this._onComObjOnMessage)}on(y,p){const m=this.actionHandler;if(m[y])throw new Error(`There is already an actionName called "${y}"`);m[y]=p}send(y,p,m){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:y,data:p},m)}sendWithPromise(y,p,m){const E=this.callbackId++,w=new l.PromiseCapability;this.callbackCapabilities[E]=w;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:y,callbackId:E,data:p},m)}catch(_){w.reject(_)}return w.promise}sendWithStream(y,p,m,E){const w=this.streamId++,_=this.sourceName,a=this.targetName,c=this.comObj;return new ReadableStream({start:d=>{const r=new l.PromiseCapability;return this.streamControllers[w]={controller:d,startCall:r,pullCall:null,cancelCall:null,isClosed:!1},c.postMessage({sourceName:_,targetName:a,action:y,streamId:w,data:p,desiredSize:d.desiredSize},E),r.promise},pull:d=>{const r=new l.PromiseCapability;return this.streamControllers[w].pullCall=r,c.postMessage({sourceName:_,targetName:a,stream:rt.PULL,streamId:w,desiredSize:d.desiredSize}),r.promise},cancel:d=>{(0,l.assert)(d instanceof Error,"cancel must have a valid reason");const r=new l.PromiseCapability;return this.streamControllers[w].cancelCall=r,this.streamControllers[w].isClosed=!0,c.postMessage({sourceName:_,targetName:a,stream:rt.CANCEL,streamId:w,reason:z(d)}),r.promise}},m)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}B=new WeakSet,Pi=function(y){const p=y.streamId,m=this.sourceName,E=y.sourceName,w=this.comObj,_=this,a=this.actionHandler[y.action],c={enqueue(d,r=1,f){if(this.isCancelled)return;const F=this.desiredSize;this.desiredSize-=r,F>0&&this.desiredSize<=0&&(this.sinkCapability=new l.PromiseCapability,this.ready=this.sinkCapability.promise),w.postMessage({sourceName:m,targetName:E,stream:rt.ENQUEUE,streamId:p,chunk:d},f)},close(){this.isCancelled||(this.isCancelled=!0,w.postMessage({sourceName:m,targetName:E,stream:rt.CLOSE,streamId:p}),delete _.streamSinks[p])},error(d){(0,l.assert)(d instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,w.postMessage({sourceName:m,targetName:E,stream:rt.ERROR,streamId:p,reason:z(d)}))},sinkCapability:new l.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:y.desiredSize,ready:null};c.sinkCapability.resolve(),c.ready=c.sinkCapability.promise,this.streamSinks[p]=c,new Promise(function(d){d(a(y.data,c))}).then(function(){w.postMessage({sourceName:m,targetName:E,stream:rt.START_COMPLETE,streamId:p,success:!0})},function(d){w.postMessage({sourceName:m,targetName:E,stream:rt.START_COMPLETE,streamId:p,reason:z(d)})})},g=new WeakSet,ki=function(y){const p=y.streamId,m=this.sourceName,E=y.sourceName,w=this.comObj,_=this.streamControllers[p],a=this.streamSinks[p];switch(y.stream){case rt.START_COMPLETE:y.success?_.startCall.resolve():_.startCall.reject(z(y.reason));break;case rt.PULL_COMPLETE:y.success?_.pullCall.resolve():_.pullCall.reject(z(y.reason));break;case rt.PULL:if(!a){w.postMessage({sourceName:m,targetName:E,stream:rt.PULL_COMPLETE,streamId:p,success:!0});break}a.desiredSize<=0&&y.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=y.desiredSize,new Promise(function(c){c(a.onPull?.())}).then(function(){w.postMessage({sourceName:m,targetName:E,stream:rt.PULL_COMPLETE,streamId:p,success:!0})},function(c){w.postMessage({sourceName:m,targetName:E,stream:rt.PULL_COMPLETE,streamId:p,reason:z(c)})});break;case rt.ENQUEUE:if((0,l.assert)(_,"enqueue should have stream controller"),_.isClosed)break;_.controller.enqueue(y.chunk);break;case rt.CLOSE:if((0,l.assert)(_,"close should have stream controller"),_.isClosed)break;_.isClosed=!0,_.controller.close(),j(this,N,xe).call(this,_,p);break;case rt.ERROR:(0,l.assert)(_,"error should have stream controller"),_.controller.error(z(y.reason)),j(this,N,xe).call(this,_,p);break;case rt.CANCEL_COMPLETE:y.success?_.cancelCall.resolve():_.cancelCall.reject(z(y.reason)),j(this,N,xe).call(this,_,p);break;case rt.CANCEL:if(!a)break;new Promise(function(c){c(a.onCancel?.(z(y.reason)))}).then(function(){w.postMessage({sourceName:m,targetName:E,stream:rt.CANCEL_COMPLETE,streamId:p,success:!0})},function(c){w.postMessage({sourceName:m,targetName:E,stream:rt.CANCEL_COMPLETE,streamId:p,reason:z(c)})}),a.sinkCapability.reject(z(y.reason)),a.isCancelled=!0,delete this.streamSinks[p];break;default:throw new Error("Unexpected stream case")}},N=new WeakSet,xe=async function(y,p){await Promise.allSettled([y.startCall?.promise,y.pullCall?.promise,y.cancelCall?.promise]),delete this.streamControllers[p]},u.MessageHandler=gt},(pt,u,et)=>{var rt,z;Object.defineProperty(u,"__esModule",{value:!0}),u.Metadata=void 0;var l=et(1);class T{constructor({parsedData:B,rawData:k}){D(this,rt,void 0);D(this,z,void 0);J(this,rt,B),J(this,z,k)}getRaw(){return t(this,z)}get(B){return t(this,rt).get(B)??null}getAll(){return(0,l.objectFromMap)(t(this,rt))}has(B){return t(this,rt).has(B)}}rt=new WeakMap,z=new WeakMap,u.Metadata=T},(pt,u,et)=>{var B,k,g,L,N,M,Ze;Object.defineProperty(u,"__esModule",{value:!0}),u.OptionalContentConfig=void 0;var l=et(1),T=et(8);const rt=Symbol("INTERNAL");class z{constructor(p,m){D(this,B,!0);this.name=p,this.intent=m}get visible(){return t(this,B)}_setVisible(p,m){p!==rt&&(0,l.unreachable)("Internal method `_setVisible` called."),J(this,B,m)}}B=new WeakMap;class gt{constructor(p){D(this,M);D(this,k,null);D(this,g,new Map);D(this,L,null);D(this,N,null);if(this.name=null,this.creator=null,p!==null){this.name=p.name,this.creator=p.creator,J(this,N,p.order);for(const m of p.groups)t(this,g).set(m.id,new z(m.name,m.intent));if(p.baseState==="OFF")for(const m of t(this,g).values())m._setVisible(rt,!1);for(const m of p.on)t(this,g).get(m)._setVisible(rt,!0);for(const m of p.off)t(this,g).get(m)._setVisible(rt,!1);J(this,L,this.getHash())}}isVisible(p){if(t(this,g).size===0)return!0;if(!p)return(0,l.warn)("Optional content group not defined."),!0;if(p.type==="OCG")return t(this,g).has(p.id)?t(this,g).get(p.id).visible:((0,l.warn)(`Optional content group not found: ${p.id}`),!0);if(p.type==="OCMD"){if(p.expression)return j(this,M,Ze).call(this,p.expression);if(!p.policy||p.policy==="AnyOn"){for(const m of p.ids){if(!t(this,g).has(m))return(0,l.warn)(`Optional content group not found: ${m}`),!0;if(t(this,g).get(m).visible)return!0}return!1}else if(p.policy==="AllOn"){for(const m of p.ids){if(!t(this,g).has(m))return(0,l.warn)(`Optional content group not found: ${m}`),!0;if(!t(this,g).get(m).visible)return!1}return!0}else if(p.policy==="AnyOff"){for(const m of p.ids){if(!t(this,g).has(m))return(0,l.warn)(`Optional content group not found: ${m}`),!0;if(!t(this,g).get(m).visible)return!0}return!1}else if(p.policy==="AllOff"){for(const m of p.ids){if(!t(this,g).has(m))return(0,l.warn)(`Optional content group not found: ${m}`),!0;if(t(this,g).get(m).visible)return!1}return!0}return(0,l.warn)(`Unknown optional content policy ${p.policy}.`),!0}return(0,l.warn)(`Unknown group type ${p.type}.`),!0}setVisibility(p,m=!0){if(!t(this,g).has(p)){(0,l.warn)(`Optional content group not found: ${p}`);return}t(this,g).get(p)._setVisible(rt,!!m),J(this,k,null)}get hasInitialVisibility(){return t(this,L)===null||this.getHash()===t(this,L)}getOrder(){return t(this,g).size?t(this,N)?t(this,N).slice():[...t(this,g).keys()]:null}getGroups(){return t(this,g).size>0?(0,l.objectFromMap)(t(this,g)):null}getGroup(p){return t(this,g).get(p)||null}getHash(){if(t(this,k)!==null)return t(this,k);const p=new T.MurmurHash3_64;for(const[m,E]of t(this,g))p.update(`${m}:${E.visible}`);return J(this,k,p.hexdigest())}}k=new WeakMap,g=new WeakMap,L=new WeakMap,N=new WeakMap,M=new WeakSet,Ze=function(p){const m=p.length;if(m<2)return!0;const E=p[0];for(let w=1;w<m;w++){const _=p[w];let a;if(Array.isArray(_))a=j(this,M,Ze).call(this,_);else if(t(this,g).has(_))a=t(this,g).get(_).visible;else return(0,l.warn)(`Optional content group not found: ${_}`),!0;switch(E){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return E==="And"},u.OptionalContentConfig=gt},(pt,u,et)=>{Object.defineProperty(u,"__esModule",{value:!0}),u.PDFDataTransportStream=void 0;var l=et(1),T=et(6);class rt{constructor({length:k,initialData:g,progressiveDone:L=!1,contentDispositionFilename:N=null,disableRange:M=!1,disableStream:S=!1},y){if((0,l.assert)(y,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=L,this._contentDispositionFilename=N,g?.length>0){const p=g instanceof Uint8Array&&g.byteLength===g.buffer.byteLength?g.buffer:new Uint8Array(g).buffer;this._queuedChunks.push(p)}this._pdfDataRangeTransport=y,this._isStreamingSupported=!S,this._isRangeSupported=!M,this._contentLength=k,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((p,m)=>{this._onReceiveData({begin:p,chunk:m})}),this._pdfDataRangeTransport.addProgressListener((p,m)=>{this._onProgress({loaded:p,total:m})}),this._pdfDataRangeTransport.addProgressiveReadListener(p=>{this._onReceiveData({chunk:p})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:k,chunk:g}){const L=g instanceof Uint8Array&&g.byteLength===g.buffer.byteLength?g.buffer:new Uint8Array(g).buffer;if(k===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(L):this._queuedChunks.push(L);else{const N=this._rangeReaders.some(function(M){return M._begin!==k?!1:(M._enqueue(L),!0)});(0,l.assert)(N,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(k){k.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:k.loaded}):this._fullRequestReader?.onProgress?.({loaded:k.loaded,total:k.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(k){const g=this._rangeReaders.indexOf(k);g>=0&&this._rangeReaders.splice(g,1)}getFullReader(){(0,l.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const k=this._queuedChunks;return this._queuedChunks=null,new z(this,k,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(k,g){if(g<=this._progressiveDataLength)return null;const L=new gt(this,k,g);return this._pdfDataRangeTransport.requestDataRange(k,g),this._rangeReaders.push(L),L}cancelAllRequests(k){this._fullRequestReader?.cancel(k);for(const g of this._rangeReaders.slice(0))g.cancel(k);this._pdfDataRangeTransport.abort()}}u.PDFDataTransportStream=rt;class z{constructor(k,g,L=!1,N=null){this._stream=k,this._done=L||!1,this._filename=(0,T.isPdfFile)(N)?N:null,this._queuedChunks=g||[],this._loaded=0;for(const M of this._queuedChunks)this._loaded+=M.byteLength;this._requests=[],this._headersReady=Promise.resolve(),k._fullRequestReader=this,this.onProgress=null}_enqueue(k){this._done||(this._requests.length>0?this._requests.shift().resolve({value:k,done:!1}):this._queuedChunks.push(k),this._loaded+=k.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const k=new l.PromiseCapability;return this._requests.push(k),k.promise}cancel(k){this._done=!0;for(const g of this._requests)g.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class gt{constructor(k,g,L){this._stream=k,this._begin=g,this._end=L,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(k){if(!this._done){if(this._requests.length===0)this._queuedChunk=k;else{this._requests.shift().resolve({value:k,done:!1});for(const L of this._requests)L.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const g=this._queuedChunk;return this._queuedChunk=null,{value:g,done:!1}}if(this._done)return{value:void 0,done:!0};const k=new l.PromiseCapability;return this._requests.push(k),k.promise}cancel(k){this._done=!0;for(const g of this._requests)g.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(pt,u,et)=>{Object.defineProperty(u,"__esModule",{value:!0}),u.PDFFetchStream=void 0;var l=et(1),T=et(20);function rt(L,N,M){return{method:"GET",headers:L,signal:M.signal,mode:"cors",credentials:N?"include":"same-origin",redirect:"follow"}}function z(L){const N=new Headers;for(const M in L){const S=L[M];S!==void 0&&N.append(M,S)}return N}function gt(L){return L instanceof Uint8Array?L.buffer:L instanceof ArrayBuffer?L:((0,l.warn)(`getArrayBuffer - unexpected data format: ${L}`),new Uint8Array(L).buffer)}class B{constructor(N){this.source=N,this.isHttp=/^https?:/i.test(N.url),this.httpHeaders=this.isHttp&&N.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,l.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new k(this),this._fullRequestReader}getRangeReader(N,M){if(M<=this._progressiveDataLength)return null;const S=new g(this,N,M);return this._rangeRequestReaders.push(S),S}cancelAllRequests(N){this._fullRequestReader?.cancel(N);for(const M of this._rangeRequestReaders.slice(0))M.cancel(N)}}u.PDFFetchStream=B;class k{constructor(N){this._stream=N,this._reader=null,this._loaded=0,this._filename=null;const M=N.source;this._withCredentials=M.withCredentials||!1,this._contentLength=M.length,this._headersCapability=new l.PromiseCapability,this._disableRange=M.disableRange||!1,this._rangeChunkSize=M.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!M.disableStream,this._isRangeSupported=!M.disableRange,this._headers=z(this._stream.httpHeaders);const S=M.url;fetch(S,rt(this._headers,this._withCredentials,this._abortController)).then(y=>{if(!(0,T.validateResponseStatus)(y.status))throw(0,T.createResponseStatusError)(y.status,S);this._reader=y.body.getReader(),this._headersCapability.resolve();const p=w=>y.headers.get(w),{allowRangeRequests:m,suggestedLength:E}=(0,T.validateRangeRequestCapabilities)({getResponseHeader:p,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=m,this._contentLength=E||this._contentLength,this._filename=(0,T.extractFilenameFromHeader)(p),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new l.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:N,done:M}=await this._reader.read();return M?{value:N,done:M}:(this._loaded+=N.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:gt(N),done:!1})}cancel(N){this._reader?.cancel(N),this._abortController.abort()}}class g{constructor(N,M,S){this._stream=N,this._reader=null,this._loaded=0;const y=N.source;this._withCredentials=y.withCredentials||!1,this._readCapability=new l.PromiseCapability,this._isStreamingSupported=!y.disableStream,this._abortController=new AbortController,this._headers=z(this._stream.httpHeaders),this._headers.append("Range",`bytes=${M}-${S-1}`);const p=y.url;fetch(p,rt(this._headers,this._withCredentials,this._abortController)).then(m=>{if(!(0,T.validateResponseStatus)(m.status))throw(0,T.createResponseStatusError)(m.status,p);this._readCapability.resolve(),this._reader=m.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:N,done:M}=await this._reader.read();return M?{value:N,done:M}:(this._loaded+=N.byteLength,this.onProgress?.({loaded:this._loaded}),{value:gt(N),done:!1})}cancel(N){this._reader?.cancel(N),this._abortController.abort()}}},(pt,u,et)=>{Object.defineProperty(u,"__esModule",{value:!0}),u.createResponseStatusError=B,u.extractFilenameFromHeader=gt,u.validateRangeRequestCapabilities=z,u.validateResponseStatus=k;var l=et(1),T=et(21),rt=et(6);function z({getResponseHeader:g,isHttp:L,rangeChunkSize:N,disableRange:M}){const S={allowRangeRequests:!1,suggestedLength:void 0},y=parseInt(g("Content-Length"),10);return!Number.isInteger(y)||(S.suggestedLength=y,y<=2*N)||M||!L||g("Accept-Ranges")!=="bytes"||(g("Content-Encoding")||"identity")!=="identity"||(S.allowRangeRequests=!0),S}function gt(g){const L=g("Content-Disposition");if(L){let N=(0,T.getFilenameFromContentDispositionHeader)(L);if(N.includes("%"))try{N=decodeURIComponent(N)}catch{}if((0,rt.isPdfFile)(N))return N}return null}function B(g,L){return g===404||g===0&&L.startsWith("file:")?new l.MissingPDFException('Missing PDF "'+L+'".'):new l.UnexpectedResponseException(`Unexpected server response (${g}) while retrieving PDF "${L}".`,g)}function k(g){return g===200||g===206}},(pt,u,et)=>{Object.defineProperty(u,"__esModule",{value:!0}),u.getFilenameFromContentDispositionHeader=T;var l=et(1);function T(rt){let z=!0,gt=B("filename\\*","i").exec(rt);if(gt){gt=gt[1];let y=N(gt);return y=unescape(y),y=M(y),y=S(y),g(y)}if(gt=L(rt),gt){const y=S(gt);return g(y)}if(gt=B("filename","i").exec(rt),gt){gt=gt[1];let y=N(gt);return y=S(y),g(y)}function B(y,p){return new RegExp("(?:^|;)\\s*"+y+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',p)}function k(y,p){if(y){if(!/^[\x00-\xFF]+$/.test(p))return p;try{const m=new TextDecoder(y,{fatal:!0}),E=(0,l.stringToBytes)(p);p=m.decode(E),z=!1}catch{}}return p}function g(y){return z&&/[\x80-\xff]/.test(y)&&(y=k("utf-8",y),z&&(y=k("iso-8859-1",y))),y}function L(y){const p=[];let m;const E=B("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(m=E.exec(y))!==null;){let[,_,a,c]=m;if(_=parseInt(_,10),_ in p){if(_===0)break;continue}p[_]=[a,c]}const w=[];for(let _=0;_<p.length&&_ in p;++_){let[a,c]=p[_];c=N(c),a&&(c=unescape(c),_===0&&(c=M(c))),w.push(c)}return w.join("")}function N(y){if(y.startsWith('"')){const p=y.slice(1).split('\\"');for(let m=0;m<p.length;++m){const E=p[m].indexOf('"');E!==-1&&(p[m]=p[m].slice(0,E),p.length=m+1),p[m]=p[m].replaceAll(/\\(.)/g,"$1")}y=p.join('"')}return y}function M(y){const p=y.indexOf("'");if(p===-1)return y;const m=y.slice(0,p),w=y.slice(p+1).replace(/^[^']*'/,"");return k(m,w)}function S(y){return!y.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(y)?y:y.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(p,m,E,w){if(E==="q"||E==="Q")return w=w.replaceAll("_"," "),w=w.replaceAll(/=([0-9a-fA-F]{2})/g,function(_,a){return String.fromCharCode(parseInt(a,16))}),k(m,w);try{w=atob(w)}catch{}return k(m,w)})}return""}},(pt,u,et)=>{Object.defineProperty(u,"__esModule",{value:!0}),u.PDFNetworkStream=void 0;var l=et(1),T=et(20);const rt=200,z=206;function gt(N){const M=N.response;return typeof M!="string"?M:(0,l.stringToBytes)(M).buffer}class B{constructor(M,S={}){this.url=M,this.isHttp=/^https?:/i.test(M),this.httpHeaders=this.isHttp&&S.httpHeaders||Object.create(null),this.withCredentials=S.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(M,S,y){const p={begin:M,end:S};for(const m in y)p[m]=y[m];return this.request(p)}requestFull(M){return this.request(M)}request(M){const S=new XMLHttpRequest,y=this.currXhrId++,p=this.pendingRequests[y]={xhr:S};S.open("GET",this.url),S.withCredentials=this.withCredentials;for(const m in this.httpHeaders){const E=this.httpHeaders[m];E!==void 0&&S.setRequestHeader(m,E)}return this.isHttp&&"begin"in M&&"end"in M?(S.setRequestHeader("Range",`bytes=${M.begin}-${M.end-1}`),p.expectedStatus=z):p.expectedStatus=rt,S.responseType="arraybuffer",M.onError&&(S.onerror=function(m){M.onError(S.status)}),S.onreadystatechange=this.onStateChange.bind(this,y),S.onprogress=this.onProgress.bind(this,y),p.onHeadersReceived=M.onHeadersReceived,p.onDone=M.onDone,p.onError=M.onError,p.onProgress=M.onProgress,S.send(null),y}onProgress(M,S){const y=this.pendingRequests[M];y&&y.onProgress?.(S)}onStateChange(M,S){const y=this.pendingRequests[M];if(!y)return;const p=y.xhr;if(p.readyState>=2&&y.onHeadersReceived&&(y.onHeadersReceived(),delete y.onHeadersReceived),p.readyState!==4||!(M in this.pendingRequests))return;if(delete this.pendingRequests[M],p.status===0&&this.isHttp){y.onError?.(p.status);return}const m=p.status||rt;if(!(m===rt&&y.expectedStatus===z)&&m!==y.expectedStatus){y.onError?.(p.status);return}const w=gt(p);if(m===z){const _=p.getResponseHeader("Content-Range"),a=/bytes (\d+)-(\d+)\/(\d+)/.exec(_);y.onDone({begin:parseInt(a[1],10),chunk:w})}else w?y.onDone({begin:0,chunk:w}):y.onError?.(p.status)}getRequestXhr(M){return this.pendingRequests[M].xhr}isPendingRequest(M){return M in this.pendingRequests}abortRequest(M){const S=this.pendingRequests[M].xhr;delete this.pendingRequests[M],S.abort()}}class k{constructor(M){this._source=M,this._manager=new B(M.url,{httpHeaders:M.httpHeaders,withCredentials:M.withCredentials}),this._rangeChunkSize=M.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(M){const S=this._rangeRequestReaders.indexOf(M);S>=0&&this._rangeRequestReaders.splice(S,1)}getFullReader(){return(0,l.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new g(this._manager,this._source),this._fullRequestReader}getRangeReader(M,S){const y=new L(this._manager,M,S);return y.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(y),y}cancelAllRequests(M){this._fullRequestReader?.cancel(M);for(const S of this._rangeRequestReaders.slice(0))S.cancel(M)}}u.PDFNetworkStream=k;class g{constructor(M,S){this._manager=M;const y={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=S.url,this._fullRequestId=M.requestFull(y),this._headersReceivedCapability=new l.PromiseCapability,this._disableRange=S.disableRange||!1,this._contentLength=S.length,this._rangeChunkSize=S.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const M=this._fullRequestId,S=this._manager.getRequestXhr(M),y=E=>S.getResponseHeader(E),{allowRangeRequests:p,suggestedLength:m}=(0,T.validateRangeRequestCapabilities)({getResponseHeader:y,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});p&&(this._isRangeSupported=!0),this._contentLength=m||this._contentLength,this._filename=(0,T.extractFilenameFromHeader)(y),this._isRangeSupported&&this._manager.abortRequest(M),this._headersReceivedCapability.resolve()}_onDone(M){if(M&&(this._requests.length>0?this._requests.shift().resolve({value:M.chunk,done:!1}):this._cachedChunks.push(M.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const S of this._requests)S.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(M){this._storedError=(0,T.createResponseStatusError)(M,this._url),this._headersReceivedCapability.reject(this._storedError);for(const S of this._requests)S.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(M){this.onProgress?.({loaded:M.loaded,total:M.lengthComputable?M.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const M=new l.PromiseCapability;return this._requests.push(M),M.promise}cancel(M){this._done=!0,this._headersReceivedCapability.reject(M);for(const S of this._requests)S.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class L{constructor(M,S,y){this._manager=M;const p={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=M.url,this._requestId=M.requestRange(S,y,p),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(M){const S=M.chunk;this._requests.length>0?this._requests.shift().resolve({value:S,done:!1}):this._queuedChunk=S,this._done=!0;for(const y of this._requests)y.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(M){this._storedError=(0,T.createResponseStatusError)(M,this._url);for(const S of this._requests)S.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(M){this.isStreamingSupported||this.onProgress?.({loaded:M.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const S=this._queuedChunk;return this._queuedChunk=null,{value:S,done:!1}}if(this._done)return{value:void 0,done:!0};const M=new l.PromiseCapability;return this._requests.push(M),M.promise}cancel(M){this._done=!0;for(const S of this._requests)S.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(pt,u,et)=>{Object.defineProperty(u,"__esModule",{value:!0}),u.PDFNodeStream=void 0;var l=et(1),T=et(20);const rt=/^file:\/\/\/[a-zA-Z]:\//;function z(y){const p=require$$5,m=p.parse(y);return m.protocol==="file:"||m.host?m:/^[a-z]:[/\\]/i.test(y)?p.parse(`file:///${y}`):(m.host||(m.protocol="file:"),m)}class gt{constructor(p){this.source=p,this.url=z(p.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&p.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,l.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new M(this):new L(this),this._fullRequestReader}getRangeReader(p,m){if(m<=this._progressiveDataLength)return null;const E=this.isFsUrl?new S(this,p,m):new N(this,p,m);return this._rangeRequestReaders.push(E),E}cancelAllRequests(p){this._fullRequestReader?.cancel(p);for(const m of this._rangeRequestReaders.slice(0))m.cancel(p)}}u.PDFNodeStream=gt;class B{constructor(p){this._url=p.url,this._done=!1,this._storedError=null,this.onProgress=null;const m=p.source;this._contentLength=m.length,this._loaded=0,this._filename=null,this._disableRange=m.disableRange||!1,this._rangeChunkSize=m.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!m.disableStream,this._isRangeSupported=!m.disableRange,this._readableStream=null,this._readCapability=new l.PromiseCapability,this._headersCapability=new l.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const p=this._readableStream.read();return p===null?(this._readCapability=new l.PromiseCapability,this.read()):(this._loaded+=p.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(p).buffer,done:!1})}cancel(p){if(!this._readableStream){this._error(p);return}this._readableStream.destroy(p)}_error(p){this._storedError=p,this._readCapability.resolve()}_setReadableStream(p){this._readableStream=p,p.on("readable",()=>{this._readCapability.resolve()}),p.on("end",()=>{p.destroy(),this._done=!0,this._readCapability.resolve()}),p.on("error",m=>{this._error(m)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new l.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class k{constructor(p){this._url=p.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new l.PromiseCapability;const m=p.source;this._isStreamingSupported=!m.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const p=this._readableStream.read();return p===null?(this._readCapability=new l.PromiseCapability,this.read()):(this._loaded+=p.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(p).buffer,done:!1})}cancel(p){if(!this._readableStream){this._error(p);return}this._readableStream.destroy(p)}_error(p){this._storedError=p,this._readCapability.resolve()}_setReadableStream(p){this._readableStream=p,p.on("readable",()=>{this._readCapability.resolve()}),p.on("end",()=>{p.destroy(),this._done=!0,this._readCapability.resolve()}),p.on("error",m=>{this._error(m)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function g(y,p){return{protocol:y.protocol,auth:y.auth,host:y.hostname,port:y.port,path:y.path,method:"GET",headers:p}}class L extends B{constructor(p){super(p);const m=E=>{if(E.statusCode===404){const c=new l.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=c,this._headersCapability.reject(c);return}this._headersCapability.resolve(),this._setReadableStream(E);const w=c=>this._readableStream.headers[c.toLowerCase()],{allowRangeRequests:_,suggestedLength:a}=(0,T.validateRangeRequestCapabilities)({getResponseHeader:w,isHttp:p.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=_,this._contentLength=a||this._contentLength,this._filename=(0,T.extractFilenameFromHeader)(w)};if(this._request=null,this._url.protocol==="http:"){const E=require$$5;this._request=E.request(g(this._url,p.httpHeaders),m)}else{const E=require$$5;this._request=E.request(g(this._url,p.httpHeaders),m)}this._request.on("error",E=>{this._storedError=E,this._headersCapability.reject(E)}),this._request.end()}}class N extends k{constructor(p,m,E){super(p),this._httpHeaders={};for(const _ in p.httpHeaders){const a=p.httpHeaders[_];a!==void 0&&(this._httpHeaders[_]=a)}this._httpHeaders.Range=`bytes=${m}-${E-1}`;const w=_=>{if(_.statusCode===404){const a=new l.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=a;return}this._setReadableStream(_)};if(this._request=null,this._url.protocol==="http:"){const _=require$$5;this._request=_.request(g(this._url,this._httpHeaders),w)}else{const _=require$$5;this._request=_.request(g(this._url,this._httpHeaders),w)}this._request.on("error",_=>{this._storedError=_}),this._request.end()}}class M extends B{constructor(p){super(p);let m=decodeURIComponent(this._url.path);rt.test(this._url.href)&&(m=m.replace(/^\//,""));const E=require$$5;E.lstat(m,(w,_)=>{if(w){w.code==="ENOENT"&&(w=new l.MissingPDFException(`Missing PDF "${m}".`)),this._storedError=w,this._headersCapability.reject(w);return}this._contentLength=_.size,this._setReadableStream(E.createReadStream(m)),this._headersCapability.resolve()})}}class S extends k{constructor(p,m,E){super(p);let w=decodeURIComponent(this._url.path);rt.test(this._url.href)&&(w=w.replace(/^\//,""));const _=require$$5;this._setReadableStream(_.createReadStream(w,{start:m,end:E-1}))}}},(pt,u,et)=>{Object.defineProperty(u,"__esModule",{value:!0}),u.SVGGraphics=void 0;var l=et(6),T=et(1);const rt={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},z="http://www.w3.org/XML/1998/namespace",gt="http://www.w3.org/1999/xlink",B=["butt","round","square"],k=["miter","round","bevel"],g=function(_,a="",c=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!c)return URL.createObjectURL(new Blob([_],{type:a}));const d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let r=`data:${a};base64,`;for(let f=0,F=_.length;f<F;f+=3){const C=_[f]&255,X=_[f+1]&255,Y=_[f+2]&255,P=C>>2,V=(C&3)<<4|X>>4,ut=f+1<F?(X&15)<<2|Y>>6:64,nt=f+2<F?Y&63:64;r+=d[P]+d[V]+d[ut]+d[nt]}return r},L=function(){const _=new Uint8Array([137,80,78,71,13,10,26,10]),a=12,c=new Int32Array(256);for(let Y=0;Y<256;Y++){let P=Y;for(let V=0;V<8;V++)P=P&1?3988292384^P>>1&2147483647:P>>1&2147483647;c[Y]=P}function d(Y,P,V){let ut=-1;for(let nt=P;nt<V;nt++){const G=(ut^Y[nt])&255,at=c[G];ut=ut>>>8^at}return ut^-1}function r(Y,P,V,ut){let nt=ut;const G=P.length;V[nt]=G>>24&255,V[nt+1]=G>>16&255,V[nt+2]=G>>8&255,V[nt+3]=G&255,nt+=4,V[nt]=Y.charCodeAt(0)&255,V[nt+1]=Y.charCodeAt(1)&255,V[nt+2]=Y.charCodeAt(2)&255,V[nt+3]=Y.charCodeAt(3)&255,nt+=4,V.set(P,nt),nt+=P.length;const at=d(V,ut+4,nt);V[nt]=at>>24&255,V[nt+1]=at>>16&255,V[nt+2]=at>>8&255,V[nt+3]=at&255}function f(Y,P,V){let ut=1,nt=0;for(let G=P;G<V;++G)ut=(ut+(Y[G]&255))%65521,nt=(nt+ut)%65521;return nt<<16|ut}function F(Y){if(!T.isNodeJS)return C(Y);try{const P=parseInt(process.versions.node)>=8?Y:Buffer.from(Y),V=require$$5.deflateSync(P,{level:9});return V instanceof Uint8Array?V:new Uint8Array(V)}catch(P){(0,T.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+P)}return C(Y)}function C(Y){let P=Y.length;const V=65535,ut=Math.ceil(P/V),nt=new Uint8Array(2+P+ut*5+4);let G=0;nt[G++]=120,nt[G++]=156;let at=0;for(;P>V;)nt[G++]=0,nt[G++]=255,nt[G++]=255,nt[G++]=0,nt[G++]=0,nt.set(Y.subarray(at,at+V),G),G+=V,at+=V,P-=V;nt[G++]=1,nt[G++]=P&255,nt[G++]=P>>8&255,nt[G++]=~P&65535&255,nt[G++]=(~P&65535)>>8&255,nt.set(Y.subarray(at),G),G+=Y.length-at;const At=f(Y,0,Y.length);return nt[G++]=At>>24&255,nt[G++]=At>>16&255,nt[G++]=At>>8&255,nt[G++]=At&255,nt}function X(Y,P,V,ut){const nt=Y.width,G=Y.height;let at,At,Tt;const xt=Y.data;switch(P){case T.ImageKind.GRAYSCALE_1BPP:At=0,at=1,Tt=nt+7>>3;break;case T.ImageKind.RGB_24BPP:At=2,at=8,Tt=nt*3;break;case T.ImageKind.RGBA_32BPP:At=6,at=8,Tt=nt*4;break;default:throw new Error("invalid format")}const v=new Uint8Array((1+Tt)*G);let i=0,n=0;for(let O=0;O<G;++O)v[i++]=0,v.set(xt.subarray(n,n+Tt),i),n+=Tt,i+=Tt;if(P===T.ImageKind.GRAYSCALE_1BPP&&ut){i=0;for(let O=0;O<G;O++){i++;for(let Q=0;Q<Tt;Q++)v[i++]^=255}}const s=new Uint8Array([nt>>24&255,nt>>16&255,nt>>8&255,nt&255,G>>24&255,G>>16&255,G>>8&255,G&255,at,At,0,0,0]),o=F(v),h=_.length+a*3+s.length+o.length,A=new Uint8Array(h);let x=0;return A.set(_,x),x+=_.length,r("IHDR",s,A,x),x+=a+s.length,r("IDATA",o,A,x),x+=a+o.length,r("IEND",new Uint8Array(0),A,x),g(A,"image/png",V)}return function(P,V,ut){const nt=P.kind===void 0?T.ImageKind.GRAYSCALE_1BPP:P.kind;return X(P,nt,V,ut)}}();class N{constructor(){this.fontSizeScale=1,this.fontWeight=rt.fontWeight,this.fontSize=0,this.textMatrix=T.IDENTITY_MATRIX,this.fontMatrix=T.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=T.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=rt.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(a,c){this.x=a,this.y=c}}function M(_){let a=[];const c=[];for(const d of _){if(d.fn==="save"){a.push({fnId:92,fn:"group",items:[]}),c.push(a),a=a.at(-1).items;continue}d.fn==="restore"?a=c.pop():a.push(d)}return a}function S(_){if(Number.isInteger(_))return _.toString();const a=_.toFixed(10);let c=a.length-1;if(a[c]!=="0")return a;do c--;while(a[c]==="0");return a.substring(0,a[c]==="."?c:c+1)}function y(_){if(_[4]===0&&_[5]===0){if(_[1]===0&&_[2]===0)return _[0]===1&&_[3]===1?"":`scale(${S(_[0])} ${S(_[3])})`;if(_[0]===_[3]&&_[1]===-_[2]){const a=Math.acos(_[0])*180/Math.PI;return`rotate(${S(a)})`}}else if(_[0]===1&&_[1]===0&&_[2]===0&&_[3]===1)return`translate(${S(_[4])} ${S(_[5])})`;return`matrix(${S(_[0])} ${S(_[1])} ${S(_[2])} ${S(_[3])} ${S(_[4])} ${S(_[5])})`}let p=0,m=0,E=0;class w{constructor(a,c,d=!1){(0,l.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new l.DOMSVGFactory,this.current=new N,this.transformMatrix=T.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=a,this.objs=c,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!d,this._operatorIdMapping=[];for(const r in T.OPS)this._operatorIdMapping[T.OPS[r]]=r}getObject(a,c=null){return typeof a=="string"?a.startsWith("g_")?this.commonObjs.get(a):this.objs.get(a):c}save(){this.transformStack.push(this.transformMatrix);const a=this.current;this.extraStack.push(a),this.current=a.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(a){this.save(),this.executeOpTree(a),this.restore()}loadDependencies(a){const c=a.fnArray,d=a.argsArray;for(let r=0,f=c.length;r<f;r++)if(c[r]===T.OPS.dependency)for(const F of d[r]){const C=F.startsWith("g_")?this.commonObjs:this.objs,X=new Promise(Y=>{C.get(F,Y)});this.current.dependencies.push(X)}return Promise.all(this.current.dependencies)}transform(a,c,d,r,f,F){const C=[a,c,d,r,f,F];this.transformMatrix=T.Util.transform(this.transformMatrix,C),this.tgrp=null}getSVG(a,c){this.viewport=c;const d=this._initialize(c);return this.loadDependencies(a).then(()=>(this.transformMatrix=T.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(a)),d))}convertOpList(a){const c=this._operatorIdMapping,d=a.argsArray,r=a.fnArray,f=[];for(let F=0,C=r.length;F<C;F++){const X=r[F];f.push({fnId:X,fn:c[X],args:d[F]})}return M(f)}executeOpTree(a){for(const c of a){const d=c.fn,r=c.fnId,f=c.args;switch(r|0){case T.OPS.beginText:this.beginText();break;case T.OPS.dependency:break;case T.OPS.setLeading:this.setLeading(f);break;case T.OPS.setLeadingMoveText:this.setLeadingMoveText(f[0],f[1]);break;case T.OPS.setFont:this.setFont(f);break;case T.OPS.showText:this.showText(f[0]);break;case T.OPS.showSpacedText:this.showText(f[0]);break;case T.OPS.endText:this.endText();break;case T.OPS.moveText:this.moveText(f[0],f[1]);break;case T.OPS.setCharSpacing:this.setCharSpacing(f[0]);break;case T.OPS.setWordSpacing:this.setWordSpacing(f[0]);break;case T.OPS.setHScale:this.setHScale(f[0]);break;case T.OPS.setTextMatrix:this.setTextMatrix(f[0],f[1],f[2],f[3],f[4],f[5]);break;case T.OPS.setTextRise:this.setTextRise(f[0]);break;case T.OPS.setTextRenderingMode:this.setTextRenderingMode(f[0]);break;case T.OPS.setLineWidth:this.setLineWidth(f[0]);break;case T.OPS.setLineJoin:this.setLineJoin(f[0]);break;case T.OPS.setLineCap:this.setLineCap(f[0]);break;case T.OPS.setMiterLimit:this.setMiterLimit(f[0]);break;case T.OPS.setFillRGBColor:this.setFillRGBColor(f[0],f[1],f[2]);break;case T.OPS.setStrokeRGBColor:this.setStrokeRGBColor(f[0],f[1],f[2]);break;case T.OPS.setStrokeColorN:this.setStrokeColorN(f);break;case T.OPS.setFillColorN:this.setFillColorN(f);break;case T.OPS.shadingFill:this.shadingFill(f[0]);break;case T.OPS.setDash:this.setDash(f[0],f[1]);break;case T.OPS.setRenderingIntent:this.setRenderingIntent(f[0]);break;case T.OPS.setFlatness:this.setFlatness(f[0]);break;case T.OPS.setGState:this.setGState(f[0]);break;case T.OPS.fill:this.fill();break;case T.OPS.eoFill:this.eoFill();break;case T.OPS.stroke:this.stroke();break;case T.OPS.fillStroke:this.fillStroke();break;case T.OPS.eoFillStroke:this.eoFillStroke();break;case T.OPS.clip:this.clip("nonzero");break;case T.OPS.eoClip:this.clip("evenodd");break;case T.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case T.OPS.paintImageXObject:this.paintImageXObject(f[0]);break;case T.OPS.paintInlineImageXObject:this.paintInlineImageXObject(f[0]);break;case T.OPS.paintImageMaskXObject:this.paintImageMaskXObject(f[0]);break;case T.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(f[0],f[1]);break;case T.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case T.OPS.closePath:this.closePath();break;case T.OPS.closeStroke:this.closeStroke();break;case T.OPS.closeFillStroke:this.closeFillStroke();break;case T.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case T.OPS.nextLine:this.nextLine();break;case T.OPS.transform:this.transform(f[0],f[1],f[2],f[3],f[4],f[5]);break;case T.OPS.constructPath:this.constructPath(f[0],f[1]);break;case T.OPS.endPath:this.endPath();break;case 92:this.group(c.items);break;default:(0,T.warn)(`Unimplemented operator ${d}`);break}}}setWordSpacing(a){this.current.wordSpacing=a}setCharSpacing(a){this.current.charSpacing=a}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(a,c,d,r,f,F){const C=this.current;C.textMatrix=C.lineMatrix=[a,c,d,r,f,F],C.textMatrixScale=Math.hypot(a,c),C.x=C.lineX=0,C.y=C.lineY=0,C.xcoords=[],C.ycoords=[],C.tspan=this.svgFactory.createElement("svg:tspan"),C.tspan.setAttributeNS(null,"font-family",C.fontFamily),C.tspan.setAttributeNS(null,"font-size",`${S(C.fontSize)}px`),C.tspan.setAttributeNS(null,"y",S(-C.y)),C.txtElement=this.svgFactory.createElement("svg:text"),C.txtElement.append(C.tspan)}beginText(){const a=this.current;a.x=a.lineX=0,a.y=a.lineY=0,a.textMatrix=T.IDENTITY_MATRIX,a.lineMatrix=T.IDENTITY_MATRIX,a.textMatrixScale=1,a.tspan=this.svgFactory.createElement("svg:tspan"),a.txtElement=this.svgFactory.createElement("svg:text"),a.txtgrp=this.svgFactory.createElement("svg:g"),a.xcoords=[],a.ycoords=[]}moveText(a,c){const d=this.current;d.x=d.lineX+=a,d.y=d.lineY+=c,d.xcoords=[],d.ycoords=[],d.tspan=this.svgFactory.createElement("svg:tspan"),d.tspan.setAttributeNS(null,"font-family",d.fontFamily),d.tspan.setAttributeNS(null,"font-size",`${S(d.fontSize)}px`),d.tspan.setAttributeNS(null,"y",S(-d.y))}showText(a){const c=this.current,d=c.font,r=c.fontSize;if(r===0)return;const f=c.fontSizeScale,F=c.charSpacing,C=c.wordSpacing,X=c.fontDirection,Y=c.textHScale*X,P=d.vertical,V=P?1:-1,ut=d.defaultVMetrics,nt=r*c.fontMatrix[0];let G=0;for(const Tt of a){if(Tt===null){G+=X*C;continue}else if(typeof Tt=="number"){G+=V*Tt*r/1e3;continue}const xt=(Tt.isSpace?C:0)+F,v=Tt.fontChar;let i,n,s=Tt.width;if(P){let h;const A=Tt.vmetric||ut;h=Tt.vmetric?A[1]:s*.5,h=-h*nt;const x=A[2]*nt;s=A?-A[0]:s,i=h/f,n=(G+x)/f}else i=G/f,n=0;(Tt.isInFont||d.missingFile)&&(c.xcoords.push(c.x+i),P&&c.ycoords.push(-c.y+n),c.tspan.textContent+=v);const o=P?s*nt-xt*X:s*nt+xt*X;G+=o}c.tspan.setAttributeNS(null,"x",c.xcoords.map(S).join(" ")),P?c.tspan.setAttributeNS(null,"y",c.ycoords.map(S).join(" ")):c.tspan.setAttributeNS(null,"y",S(-c.y)),P?c.y-=G:c.x+=G*Y,c.tspan.setAttributeNS(null,"font-family",c.fontFamily),c.tspan.setAttributeNS(null,"font-size",`${S(c.fontSize)}px`),c.fontStyle!==rt.fontStyle&&c.tspan.setAttributeNS(null,"font-style",c.fontStyle),c.fontWeight!==rt.fontWeight&&c.tspan.setAttributeNS(null,"font-weight",c.fontWeight);const at=c.textRenderingMode&T.TextRenderingMode.FILL_STROKE_MASK;if(at===T.TextRenderingMode.FILL||at===T.TextRenderingMode.FILL_STROKE?(c.fillColor!==rt.fillColor&&c.tspan.setAttributeNS(null,"fill",c.fillColor),c.fillAlpha<1&&c.tspan.setAttributeNS(null,"fill-opacity",c.fillAlpha)):c.textRenderingMode===T.TextRenderingMode.ADD_TO_PATH?c.tspan.setAttributeNS(null,"fill","transparent"):c.tspan.setAttributeNS(null,"fill","none"),at===T.TextRenderingMode.STROKE||at===T.TextRenderingMode.FILL_STROKE){const Tt=1/(c.textMatrixScale||1);this._setStrokeAttributes(c.tspan,Tt)}let At=c.textMatrix;c.textRise!==0&&(At=At.slice(),At[5]+=c.textRise),c.txtElement.setAttributeNS(null,"transform",`${y(At)} scale(${S(Y)}, -1)`),c.txtElement.setAttributeNS(z,"xml:space","preserve"),c.txtElement.append(c.tspan),c.txtgrp.append(c.txtElement),this._ensureTransformGroup().append(c.txtElement)}setLeadingMoveText(a,c){this.setLeading(-c),this.moveText(a,c)}addFontStyle(a){if(!a.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const c=g(a.data,a.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${a.loadedName}"; src: url(${c}); }
`}setFont(a){const c=this.current,d=this.commonObjs.get(a[0]);let r=a[1];c.font=d,this.embedFonts&&!d.missingFile&&!this.embeddedFonts[d.loadedName]&&(this.addFontStyle(d),this.embeddedFonts[d.loadedName]=d),c.fontMatrix=d.fontMatrix||T.FONT_IDENTITY_MATRIX;let f="normal";d.black?f="900":d.bold&&(f="bold");const F=d.italic?"italic":"normal";r<0?(r=-r,c.fontDirection=-1):c.fontDirection=1,c.fontSize=r,c.fontFamily=d.loadedName,c.fontWeight=f,c.fontStyle=F,c.tspan=this.svgFactory.createElement("svg:tspan"),c.tspan.setAttributeNS(null,"y",S(-c.y)),c.xcoords=[],c.ycoords=[]}endText(){const a=this.current;a.textRenderingMode&T.TextRenderingMode.ADD_TO_PATH_FLAG&&a.txtElement?.hasChildNodes()&&(a.element=a.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(a){a>0&&(this.current.lineWidth=a)}setLineCap(a){this.current.lineCap=B[a]}setLineJoin(a){this.current.lineJoin=k[a]}setMiterLimit(a){this.current.miterLimit=a}setStrokeAlpha(a){this.current.strokeAlpha=a}setStrokeRGBColor(a,c,d){this.current.strokeColor=T.Util.makeHexColor(a,c,d)}setFillAlpha(a){this.current.fillAlpha=a}setFillRGBColor(a,c,d){this.current.fillColor=T.Util.makeHexColor(a,c,d),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(a){this.current.strokeColor=this._makeColorN_Pattern(a)}setFillColorN(a){this.current.fillColor=this._makeColorN_Pattern(a)}shadingFill(a){const{width:c,height:d}=this.viewport,r=T.Util.inverseTransform(this.transformMatrix),[f,F,C,X]=T.Util.getAxialAlignedBoundingBox([0,0,c,d],r),Y=this.svgFactory.createElement("svg:rect");Y.setAttributeNS(null,"x",f),Y.setAttributeNS(null,"y",F),Y.setAttributeNS(null,"width",C-f),Y.setAttributeNS(null,"height",X-F),Y.setAttributeNS(null,"fill",this._makeShadingPattern(a)),this.current.fillAlpha<1&&Y.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(Y)}_makeColorN_Pattern(a){return a[0]==="TilingPattern"?this._makeTilingPattern(a):this._makeShadingPattern(a)}_makeTilingPattern(a){const c=a[1],d=a[2],r=a[3]||T.IDENTITY_MATRIX,[f,F,C,X]=a[4],Y=a[5],P=a[6],V=a[7],ut=`shading${E++}`,[nt,G,at,At]=T.Util.normalizeRect([...T.Util.applyTransform([f,F],r),...T.Util.applyTransform([C,X],r)]),[Tt,xt]=T.Util.singularValueDecompose2dScale(r),v=Y*Tt,i=P*xt,n=this.svgFactory.createElement("svg:pattern");n.setAttributeNS(null,"id",ut),n.setAttributeNS(null,"patternUnits","userSpaceOnUse"),n.setAttributeNS(null,"width",v),n.setAttributeNS(null,"height",i),n.setAttributeNS(null,"x",`${nt}`),n.setAttributeNS(null,"y",`${G}`);const s=this.svg,o=this.transformMatrix,h=this.current.fillColor,A=this.current.strokeColor,x=this.svgFactory.create(at-nt,At-G);if(this.svg=x,this.transformMatrix=r,V===2){const O=T.Util.makeHexColor(...c);this.current.fillColor=O,this.current.strokeColor=O}return this.executeOpTree(this.convertOpList(d)),this.svg=s,this.transformMatrix=o,this.current.fillColor=h,this.current.strokeColor=A,n.append(x.childNodes[0]),this.defs.append(n),`url(#${ut})`}_makeShadingPattern(a){switch(typeof a=="string"&&(a=this.objs.get(a)),a[0]){case"RadialAxial":const c=`shading${E++}`,d=a[3];let r;switch(a[1]){case"axial":const f=a[4],F=a[5];r=this.svgFactory.createElement("svg:linearGradient"),r.setAttributeNS(null,"id",c),r.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),r.setAttributeNS(null,"x1",f[0]),r.setAttributeNS(null,"y1",f[1]),r.setAttributeNS(null,"x2",F[0]),r.setAttributeNS(null,"y2",F[1]);break;case"radial":const C=a[4],X=a[5],Y=a[6],P=a[7];r=this.svgFactory.createElement("svg:radialGradient"),r.setAttributeNS(null,"id",c),r.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),r.setAttributeNS(null,"cx",X[0]),r.setAttributeNS(null,"cy",X[1]),r.setAttributeNS(null,"r",P),r.setAttributeNS(null,"fx",C[0]),r.setAttributeNS(null,"fy",C[1]),r.setAttributeNS(null,"fr",Y);break;default:throw new Error(`Unknown RadialAxial type: ${a[1]}`)}for(const f of d){const F=this.svgFactory.createElement("svg:stop");F.setAttributeNS(null,"offset",f[0]),F.setAttributeNS(null,"stop-color",f[1]),r.append(F)}return this.defs.append(r),`url(#${c})`;case"Mesh":return(0,T.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${a[0]}`)}}setDash(a,c){this.current.dashArray=a,this.current.dashPhase=c}constructPath(a,c){const d=this.current;let r=d.x,f=d.y,F=[],C=0;for(const X of a)switch(X|0){case T.OPS.rectangle:r=c[C++],f=c[C++];const Y=c[C++],P=c[C++],V=r+Y,ut=f+P;F.push("M",S(r),S(f),"L",S(V),S(f),"L",S(V),S(ut),"L",S(r),S(ut),"Z");break;case T.OPS.moveTo:r=c[C++],f=c[C++],F.push("M",S(r),S(f));break;case T.OPS.lineTo:r=c[C++],f=c[C++],F.push("L",S(r),S(f));break;case T.OPS.curveTo:r=c[C+4],f=c[C+5],F.push("C",S(c[C]),S(c[C+1]),S(c[C+2]),S(c[C+3]),S(r),S(f)),C+=6;break;case T.OPS.curveTo2:F.push("C",S(r),S(f),S(c[C]),S(c[C+1]),S(c[C+2]),S(c[C+3])),r=c[C+2],f=c[C+3],C+=4;break;case T.OPS.curveTo3:r=c[C+2],f=c[C+3],F.push("C",S(c[C]),S(c[C+1]),S(r),S(f),S(r),S(f)),C+=4;break;case T.OPS.closePath:F.push("Z");break}F=F.join(" "),d.path&&a.length>0&&a[0]!==T.OPS.rectangle&&a[0]!==T.OPS.moveTo?F=d.path.getAttributeNS(null,"d")+F:(d.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(d.path)),d.path.setAttributeNS(null,"d",F),d.path.setAttributeNS(null,"fill","none"),d.element=d.path,d.setCurrentPoint(r,f)}endPath(){const a=this.current;if(a.path=null,!this.pendingClip)return;if(!a.element){this.pendingClip=null;return}const c=`clippath${p++}`,d=this.svgFactory.createElement("svg:clipPath");d.setAttributeNS(null,"id",c),d.setAttributeNS(null,"transform",y(this.transformMatrix));const r=a.element.cloneNode(!0);if(this.pendingClip==="evenodd"?r.setAttributeNS(null,"clip-rule","evenodd"):r.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,d.append(r),this.defs.append(d),a.activeClipUrl){a.clipGroup=null;for(const f of this.extraStack)f.clipGroup=null;d.setAttributeNS(null,"clip-path",a.activeClipUrl)}a.activeClipUrl=`url(#${c})`,this.tgrp=null}clip(a){this.pendingClip=a}closePath(){const a=this.current;if(a.path){const c=`${a.path.getAttributeNS(null,"d")}Z`;a.path.setAttributeNS(null,"d",c)}}setLeading(a){this.current.leading=-a}setTextRise(a){this.current.textRise=a}setTextRenderingMode(a){this.current.textRenderingMode=a}setHScale(a){this.current.textHScale=a/100}setRenderingIntent(a){}setFlatness(a){}setGState(a){for(const[c,d]of a)switch(c){case"LW":this.setLineWidth(d);break;case"LC":this.setLineCap(d);break;case"LJ":this.setLineJoin(d);break;case"ML":this.setMiterLimit(d);break;case"D":this.setDash(d[0],d[1]);break;case"RI":this.setRenderingIntent(d);break;case"FL":this.setFlatness(d);break;case"Font":this.setFont(d);break;case"CA":this.setStrokeAlpha(d);break;case"ca":this.setFillAlpha(d);break;default:(0,T.warn)(`Unimplemented graphic state operator ${c}`);break}}fill(){const a=this.current;a.element&&(a.element.setAttributeNS(null,"fill",a.fillColor),a.element.setAttributeNS(null,"fill-opacity",a.fillAlpha),this.endPath())}stroke(){const a=this.current;a.element&&(this._setStrokeAttributes(a.element),a.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(a,c=1){const d=this.current;let r=d.dashArray;c!==1&&r.length>0&&(r=r.map(function(f){return c*f})),a.setAttributeNS(null,"stroke",d.strokeColor),a.setAttributeNS(null,"stroke-opacity",d.strokeAlpha),a.setAttributeNS(null,"stroke-miterlimit",S(d.miterLimit)),a.setAttributeNS(null,"stroke-linecap",d.lineCap),a.setAttributeNS(null,"stroke-linejoin",d.lineJoin),a.setAttributeNS(null,"stroke-width",S(c*d.lineWidth)+"px"),a.setAttributeNS(null,"stroke-dasharray",r.map(S).join(" ")),a.setAttributeNS(null,"stroke-dashoffset",S(c*d.dashPhase)+"px")}eoFill(){this.current.element?.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){this.current.element?.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const a=this.svgFactory.createElement("svg:rect");a.setAttributeNS(null,"x","0"),a.setAttributeNS(null,"y","0"),a.setAttributeNS(null,"width","1px"),a.setAttributeNS(null,"height","1px"),a.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(a)}paintImageXObject(a){const c=this.getObject(a);if(!c){(0,T.warn)(`Dependent image with object ID ${a} is not ready yet`);return}this.paintInlineImageXObject(c)}paintInlineImageXObject(a,c){const d=a.width,r=a.height,f=L(a,this.forceDataSchema,!!c),F=this.svgFactory.createElement("svg:rect");F.setAttributeNS(null,"x","0"),F.setAttributeNS(null,"y","0"),F.setAttributeNS(null,"width",S(d)),F.setAttributeNS(null,"height",S(r)),this.current.element=F,this.clip("nonzero");const C=this.svgFactory.createElement("svg:image");C.setAttributeNS(gt,"xlink:href",f),C.setAttributeNS(null,"x","0"),C.setAttributeNS(null,"y",S(-r)),C.setAttributeNS(null,"width",S(d)+"px"),C.setAttributeNS(null,"height",S(r)+"px"),C.setAttributeNS(null,"transform",`scale(${S(1/d)} ${S(-1/r)})`),c?c.append(C):this._ensureTransformGroup().append(C)}paintImageMaskXObject(a){const c=this.getObject(a.data,a);if(c.bitmap){(0,T.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const d=this.current,r=c.width,f=c.height,F=d.fillColor;d.maskId=`mask${m++}`;const C=this.svgFactory.createElement("svg:mask");C.setAttributeNS(null,"id",d.maskId);const X=this.svgFactory.createElement("svg:rect");X.setAttributeNS(null,"x","0"),X.setAttributeNS(null,"y","0"),X.setAttributeNS(null,"width",S(r)),X.setAttributeNS(null,"height",S(f)),X.setAttributeNS(null,"fill",F),X.setAttributeNS(null,"mask",`url(#${d.maskId})`),this.defs.append(C),this._ensureTransformGroup().append(X),this.paintInlineImageXObject(c,C)}paintFormXObjectBegin(a,c){if(Array.isArray(a)&&a.length===6&&this.transform(a[0],a[1],a[2],a[3],a[4],a[5]),c){const d=c[2]-c[0],r=c[3]-c[1],f=this.svgFactory.createElement("svg:rect");f.setAttributeNS(null,"x",c[0]),f.setAttributeNS(null,"y",c[1]),f.setAttributeNS(null,"width",S(d)),f.setAttributeNS(null,"height",S(r)),this.current.element=f,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(a){const c=this.svgFactory.create(a.width,a.height),d=this.svgFactory.createElement("svg:defs");c.append(d),this.defs=d;const r=this.svgFactory.createElement("svg:g");return r.setAttributeNS(null,"transform",y(a.transform)),c.append(r),this.svg=r,c}_ensureClipGroup(){if(!this.current.clipGroup){const a=this.svgFactory.createElement("svg:g");a.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(a),this.current.clipGroup=a}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",y(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}u.SVGGraphics=w},(pt,u)=>{Object.defineProperty(u,"__esModule",{value:!0}),u.XfaText=void 0;class et{static textContent(T){const rt=[],z={items:rt,styles:Object.create(null)};function gt(B){if(!B)return;let k=null;const g=B.name;if(g==="#text")k=B.value;else if(et.shouldBuildText(g))B?.attributes?.textContent?k=B.attributes.textContent:B.value&&(k=B.value);else return;if(k!==null&&rt.push({str:k}),!!B.children)for(const L of B.children)gt(L)}return gt(T),z}static shouldBuildText(T){return!(T==="textarea"||T==="input"||T==="option"||T==="select")}}u.XfaText=et},(pt,u,et)=>{Object.defineProperty(u,"__esModule",{value:!0}),u.TextLayerRenderTask=void 0,u.renderTextLayer=y,u.updateTextLayer=p;var l=et(1),T=et(6);const rt=1e5,z=30,gt=.8,B=new Map;function k(m,E){let w;if(E&&l.FeatureTest.isOffscreenCanvasSupported)w=new OffscreenCanvas(m,m).getContext("2d",{alpha:!1});else{const _=document.createElement("canvas");_.width=_.height=m,w=_.getContext("2d",{alpha:!1})}return w}function g(m,E){const w=B.get(m);if(w)return w;const _=k(z,E);_.font=`${z}px ${m}`;const a=_.measureText("");let c=a.fontBoundingBoxAscent,d=Math.abs(a.fontBoundingBoxDescent);if(c){const f=c/(c+d);return B.set(m,f),_.canvas.width=_.canvas.height=0,f}_.strokeStyle="red",_.clearRect(0,0,z,z),_.strokeText("g",0,0);let r=_.getImageData(0,0,z,z).data;d=0;for(let f=r.length-1-3;f>=0;f-=4)if(r[f]>0){d=Math.ceil(f/4/z);break}_.clearRect(0,0,z,z),_.strokeText("A",0,z),r=_.getImageData(0,0,z,z).data,c=0;for(let f=0,F=r.length;f<F;f+=4)if(r[f]>0){c=z-Math.floor(f/4/z);break}if(_.canvas.width=_.canvas.height=0,c){const f=c/(c+d);return B.set(m,f),f}return B.set(m,gt),gt}function L(m,E,w){const _=document.createElement("span"),a={angle:0,canvasWidth:0,hasText:E.str!=="",hasEOL:E.hasEOL,fontSize:0};m._textDivs.push(_);const c=l.Util.transform(m._transform,E.transform);let d=Math.atan2(c[1],c[0]);const r=w[E.fontName];r.vertical&&(d+=Math.PI/2);const f=Math.hypot(c[2],c[3]),F=f*g(r.fontFamily,m._isOffscreenCanvasSupported);let C,X;d===0?(C=c[4],X=c[5]-F):(C=c[4]+F*Math.sin(d),X=c[5]-F*Math.cos(d));const Y="calc(var(--scale-factor)*",P=_.style;m._container===m._rootContainer?(P.left=`${(100*C/m._pageWidth).toFixed(2)}%`,P.top=`${(100*X/m._pageHeight).toFixed(2)}%`):(P.left=`${Y}${C.toFixed(2)}px)`,P.top=`${Y}${X.toFixed(2)}px)`),P.fontSize=`${Y}${f.toFixed(2)}px)`,P.fontFamily=r.fontFamily,a.fontSize=f,_.setAttribute("role","presentation"),_.textContent=E.str,_.dir=E.dir,m._fontInspectorEnabled&&(_.dataset.fontName=E.fontName),d!==0&&(a.angle=d*(180/Math.PI));let V=!1;if(E.str.length>1)V=!0;else if(E.str!==" "&&E.transform[0]!==E.transform[3]){const ut=Math.abs(E.transform[0]),nt=Math.abs(E.transform[3]);ut!==nt&&Math.max(ut,nt)/Math.min(ut,nt)>1.5&&(V=!0)}V&&(a.canvasWidth=r.vertical?E.height:E.width),m._textDivProperties.set(_,a),m._isReadableStream&&m._layoutText(_)}function N(m){const{div:E,scale:w,properties:_,ctx:a,prevFontSize:c,prevFontFamily:d}=m,{style:r}=E;let f="";if(_.canvasWidth!==0&&_.hasText){const{fontFamily:F}=r,{canvasWidth:C,fontSize:X}=_;(c!==X||d!==F)&&(a.font=`${X*w}px ${F}`,m.prevFontSize=X,m.prevFontFamily=F);const{width:Y}=a.measureText(E.textContent);Y>0&&(f=`scaleX(${C*w/Y})`)}_.angle!==0&&(f=`rotate(${_.angle}deg) ${f}`),f.length>0&&(r.transform=f)}function M(m){if(m._canceled)return;const E=m._textDivs,w=m._capability;if(E.length>rt){w.resolve();return}if(!m._isReadableStream)for(const a of E)m._layoutText(a);w.resolve()}class S{constructor({textContentSource:E,container:w,viewport:_,textDivs:a,textDivProperties:c,textContentItemsStr:d,isOffscreenCanvasSupported:r}){this._textContentSource=E,this._isReadableStream=E instanceof ReadableStream,this._container=this._rootContainer=w,this._textDivs=a||[],this._textContentItemsStr=d||[],this._isOffscreenCanvasSupported=r,this._fontInspectorEnabled=!!globalThis.FontInspector?.enabled,this._reader=null,this._textDivProperties=c||new WeakMap,this._canceled=!1,this._capability=new l.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:_.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:k(0,r)};const{pageWidth:f,pageHeight:F,pageX:C,pageY:X}=_.rawDims;this._transform=[1,0,0,-1,-C,X+F],this._pageWidth=f,this._pageHeight=F,(0,T.setLayerDimensions)(w,_),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new l.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new l.AbortException("TextLayer task cancelled."))}_processItems(E,w){for(const _ of E){if(_.str===void 0){if(_.type==="beginMarkedContentProps"||_.type==="beginMarkedContent"){const a=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),_.id!==null&&this._container.setAttribute("id",`${_.id}`),a.append(this._container)}else _.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(_.str),L(this,_,w)}}_layoutText(E){const w=this._layoutTextParams.properties=this._textDivProperties.get(E);if(this._layoutTextParams.div=E,N(this._layoutTextParams),w.hasText&&this._container.append(E),w.hasEOL){const _=document.createElement("br");_.setAttribute("role","presentation"),this._container.append(_)}}_render(){const E=new l.PromiseCapability;let w=Object.create(null);if(this._isReadableStream){const _=()=>{this._reader.read().then(({value:a,done:c})=>{if(c){E.resolve();return}Object.assign(w,a.styles),this._processItems(a.items,w),_()},E.reject)};this._reader=this._textContentSource.getReader(),_()}else if(this._textContentSource){const{items:_,styles:a}=this._textContentSource;this._processItems(_,a),E.resolve()}else throw new Error('No "textContentSource" parameter specified.');E.promise.then(()=>{w=null,M(this)},this._capability.reject)}}u.TextLayerRenderTask=S;function y(m){!m.textContentSource&&(m.textContent||m.textContentStream)&&((0,T.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),m.textContentSource=m.textContent||m.textContentStream);const{container:E,viewport:w}=m,_=getComputedStyle(E),a=_.getPropertyValue("visibility"),c=parseFloat(_.getPropertyValue("--scale-factor"));a==="visible"&&(!c||Math.abs(c-w.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const d=new S(m);return d._render(),d}function p({container:m,viewport:E,textDivs:w,textDivProperties:_,isOffscreenCanvasSupported:a,mustRotate:c=!0,mustRescale:d=!0}){if(c&&(0,T.setLayerDimensions)(m,{rotation:E.rotation}),d){const r=k(0,a),F={prevFontSize:null,prevFontFamily:null,div:null,scale:E.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:r};for(const C of w)F.properties=_.get(C),F.div=C,N(F)}}},(pt,u,et)=>{var g,L,N,M,S,y,p,m,E,w,_,ti,c,Pe,r,ei,F,ii;Object.defineProperty(u,"__esModule",{value:!0}),u.AnnotationEditorLayer=void 0;var l=et(1),T=et(4),rt=et(28),z=et(33),gt=et(6),B=et(34);const X=class X{constructor({uiManager:P,pageIndex:V,div:ut,accessibilityManager:nt,annotationLayer:G,viewport:at,l10n:At}){D(this,_);D(this,c);D(this,r);D(this,F);D(this,g,void 0);D(this,L,!1);D(this,N,null);D(this,M,this.pointerup.bind(this));D(this,S,this.pointerdown.bind(this));D(this,y,new Map);D(this,p,!1);D(this,m,!1);D(this,E,!1);D(this,w,void 0);const Tt=[rt.FreeTextEditor,z.InkEditor,B.StampEditor];if(!X._initialized){X._initialized=!0;for(const xt of Tt)xt.initialize(At)}P.registerEditorTypes(Tt),J(this,w,P),this.pageIndex=V,this.div=ut,J(this,g,nt),J(this,N,G),this.viewport=at,t(this,w).addLayer(this)}get isEmpty(){return t(this,y).size===0}updateToolbar(P){t(this,w).updateToolbar(P)}updateMode(P=t(this,w).getMode()){j(this,F,ii).call(this),P===l.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),P!==l.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",P===l.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",P===l.AnnotationEditorType.INK),this.div.classList.toggle("stampEditing",P===l.AnnotationEditorType.STAMP),this.div.hidden=!1)}addInkEditorIfNeeded(P){if(!P&&t(this,w).getMode()!==l.AnnotationEditorType.INK)return;if(!P){for(const ut of t(this,y).values())if(ut.isEmpty()){ut.setInBackground();return}}j(this,c,Pe).call(this,{offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(P){t(this,w).setEditingState(P)}addCommands(P){t(this,w).addCommands(P)}enable(){this.div.style.pointerEvents="auto";const P=new Set;for(const ut of t(this,y).values())ut.enableEditing(),ut.annotationElementId&&P.add(ut.annotationElementId);if(!t(this,N))return;const V=t(this,N).getEditableAnnotations();for(const ut of V){if(ut.hide(),t(this,w).isDeletedAnnotationElement(ut.data.id)||P.has(ut.data.id))continue;const nt=this.deserialize(ut);nt&&(this.addOrRebuild(nt),nt.enableEditing())}}disable(){J(this,E,!0),this.div.style.pointerEvents="none";const P=new Set;for(const V of t(this,y).values()){if(V.disableEditing(),!V.annotationElementId||V.serialize()!==null){P.add(V.annotationElementId);continue}this.getEditableAnnotation(V.annotationElementId)?.show(),V.remove()}if(t(this,N)){const V=t(this,N).getEditableAnnotations();for(const ut of V){const{id:nt}=ut.data;P.has(nt)||t(this,w).isDeletedAnnotationElement(nt)||ut.show()}}j(this,F,ii).call(this),this.isEmpty&&(this.div.hidden=!0),J(this,E,!1)}getEditableAnnotation(P){return t(this,N)?.getEditableAnnotation(P)||null}setActiveEditor(P){t(this,w).getActive()!==P&&t(this,w).setActiveEditor(P)}enableClick(){this.div.addEventListener("pointerdown",t(this,S)),this.div.addEventListener("pointerup",t(this,M))}disableClick(){this.div.removeEventListener("pointerdown",t(this,S)),this.div.removeEventListener("pointerup",t(this,M))}attach(P){t(this,y).set(P.id,P);const{annotationElementId:V}=P;V&&t(this,w).isDeletedAnnotationElement(V)&&t(this,w).removeDeletedAnnotationElement(P)}detach(P){t(this,y).delete(P.id),t(this,g)?.removePointerInTextLayer(P.contentDiv),!t(this,E)&&P.annotationElementId&&t(this,w).addDeletedAnnotationElement(P)}remove(P){this.detach(P),t(this,w).removeEditor(P),P.div.contains(document.activeElement)&&setTimeout(()=>{t(this,w).focusMainContainer()},0),P.div.remove(),P.isAttachedToDOM=!1,t(this,m)||this.addInkEditorIfNeeded(!1)}changeParent(P){P.parent!==this&&(P.annotationElementId&&(t(this,w).addDeletedAnnotationElement(P.annotationElementId),T.AnnotationEditor.deleteAnnotationElement(P),P.annotationElementId=null),this.attach(P),P.parent?.detach(P),P.setParent(this),P.div&&P.isAttachedToDOM&&(P.div.remove(),this.div.append(P.div)))}add(P){if(this.changeParent(P),t(this,w).addEditor(P),this.attach(P),!P.isAttachedToDOM){const V=P.render();this.div.append(V),P.isAttachedToDOM=!0}P.fixAndSetPosition(),P.onceAdded(),t(this,w).addToAnnotationStorage(P)}moveEditorInDOM(P){if(!P.isAttachedToDOM)return;const{activeElement:V}=document;P.div.contains(V)&&(P._focusEventsAllowed=!1,setTimeout(()=>{P.div.contains(document.activeElement)?P._focusEventsAllowed=!0:(P.div.addEventListener("focusin",()=>{P._focusEventsAllowed=!0},{once:!0}),V.focus())},0)),P._structTreeParentId=t(this,g)?.moveElementInDOM(this.div,P.div,P.contentDiv,!0)}addOrRebuild(P){P.needsToBeRebuilt()?P.rebuild():this.add(P)}addUndoableEditor(P){const V=()=>P._uiManager.rebuild(P),ut=()=>{P.remove()};this.addCommands({cmd:V,undo:ut,mustExec:!1})}getNextId(){return t(this,w).getId()}pasteEditor(P,V){t(this,w).updateToolbar(P),t(this,w).updateMode(P);const{offsetX:ut,offsetY:nt}=j(this,r,ei).call(this),G=this.getNextId(),at=j(this,_,ti).call(this,{parent:this,id:G,x:ut,y:nt,uiManager:t(this,w),isCentered:!0,...V});at&&this.add(at)}deserialize(P){switch(P.annotationType??P.annotationEditorType){case l.AnnotationEditorType.FREETEXT:return rt.FreeTextEditor.deserialize(P,this,t(this,w));case l.AnnotationEditorType.INK:return z.InkEditor.deserialize(P,this,t(this,w));case l.AnnotationEditorType.STAMP:return B.StampEditor.deserialize(P,this,t(this,w))}return null}addNewEditor(){j(this,c,Pe).call(this,j(this,r,ei).call(this),!0)}setSelected(P){t(this,w).setSelected(P)}toggleSelected(P){t(this,w).toggleSelected(P)}isSelected(P){return t(this,w).isSelected(P)}unselect(P){t(this,w).unselect(P)}pointerup(P){const{isMac:V}=l.FeatureTest.platform;if(!(P.button!==0||P.ctrlKey&&V)&&P.target===this.div&&t(this,p)){if(J(this,p,!1),!t(this,L)){J(this,L,!0);return}if(t(this,w).getMode()===l.AnnotationEditorType.STAMP){t(this,w).unselectAll();return}j(this,c,Pe).call(this,P,!1)}}pointerdown(P){if(t(this,p)){J(this,p,!1);return}const{isMac:V}=l.FeatureTest.platform;if(P.button!==0||P.ctrlKey&&V||P.target!==this.div)return;J(this,p,!0);const ut=t(this,w).getActive();J(this,L,!ut||ut.isEmpty())}findNewParent(P,V,ut){const nt=t(this,w).findParent(V,ut);return nt===null||nt===this?!1:(nt.changeParent(P),!0)}destroy(){t(this,w).getActive()?.parent===this&&(t(this,w).commitOrRemove(),t(this,w).setActiveEditor(null));for(const P of t(this,y).values())t(this,g)?.removePointerInTextLayer(P.contentDiv),P.setParent(null),P.isAttachedToDOM=!1,P.div.remove();this.div=null,t(this,y).clear(),t(this,w).removeLayer(this)}render({viewport:P}){this.viewport=P,(0,gt.setLayerDimensions)(this.div,P);for(const V of t(this,w).getEditors(this.pageIndex))this.add(V);this.updateMode()}update({viewport:P}){t(this,w).commitOrRemove(),this.viewport=P,(0,gt.setLayerDimensions)(this.div,{rotation:P.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:P,pageHeight:V}=this.viewport.rawDims;return[P,V]}};g=new WeakMap,L=new WeakMap,N=new WeakMap,M=new WeakMap,S=new WeakMap,y=new WeakMap,p=new WeakMap,m=new WeakMap,E=new WeakMap,w=new WeakMap,_=new WeakSet,ti=function(P){switch(t(this,w).getMode()){case l.AnnotationEditorType.FREETEXT:return new rt.FreeTextEditor(P);case l.AnnotationEditorType.INK:return new z.InkEditor(P);case l.AnnotationEditorType.STAMP:return new B.StampEditor(P)}return null},c=new WeakSet,Pe=function(P,V){const ut=this.getNextId(),nt=j(this,_,ti).call(this,{parent:this,id:ut,x:P.offsetX,y:P.offsetY,uiManager:t(this,w),isCentered:V});return nt&&this.add(nt),nt},r=new WeakSet,ei=function(){const{x:P,y:V,width:ut,height:nt}=this.div.getBoundingClientRect(),G=Math.max(0,P),at=Math.max(0,V),At=Math.min(window.innerWidth,P+ut),Tt=Math.min(window.innerHeight,V+nt),xt=(G+At)/2-P,v=(at+Tt)/2-V,[i,n]=this.viewport.rotation%180===0?[xt,v]:[v,xt];return{offsetX:i,offsetY:n}},F=new WeakSet,ii=function(){J(this,m,!0);for(const P of t(this,y).values())P.isEmpty()&&P.remove();J(this,m,!1)},Zt(X,"_initialized",!1);let k=X;u.AnnotationEditorLayer=k},(pt,u,et)=>{var B,k,g,L,N,M,S,y,p,m,Fi,w,Mi,a,Ri,d,Ae,f,si,C,Di,Y,ni;Object.defineProperty(u,"__esModule",{value:!0}),u.FreeTextEditor=void 0;var l=et(1),T=et(5),rt=et(4),z=et(29);const V=class V extends rt.AnnotationEditor{constructor(G){super({...G,name:"freeTextEditor"});D(this,m);D(this,w);D(this,a);D(this,d);D(this,f);D(this,C);D(this,Y);D(this,B,this.editorDivBlur.bind(this));D(this,k,this.editorDivFocus.bind(this));D(this,g,this.editorDivInput.bind(this));D(this,L,this.editorDivKeydown.bind(this));D(this,N,void 0);D(this,M,"");D(this,S,`${this.id}-editor`);D(this,y,void 0);D(this,p,null);J(this,N,G.color||V._defaultColor||rt.AnnotationEditor._defaultLineColor),J(this,y,G.fontSize||V._defaultFontSize)}static get _keyboardManager(){const G=V.prototype,at=xt=>xt.isEmpty(),At=T.AnnotationEditorUIManager.TRANSLATE_SMALL,Tt=T.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,l.shadow)(this,"_keyboardManager",new T.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],G.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],G.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],G._translateEmpty,{args:[-At,0],checker:at}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],G._translateEmpty,{args:[-Tt,0],checker:at}],[["ArrowRight","mac+ArrowRight"],G._translateEmpty,{args:[At,0],checker:at}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],G._translateEmpty,{args:[Tt,0],checker:at}],[["ArrowUp","mac+ArrowUp"],G._translateEmpty,{args:[0,-At],checker:at}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],G._translateEmpty,{args:[0,-Tt],checker:at}],[["ArrowDown","mac+ArrowDown"],G._translateEmpty,{args:[0,At],checker:at}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],G._translateEmpty,{args:[0,Tt],checker:at}]]))}static initialize(G){rt.AnnotationEditor.initialize(G,{strings:["free_text2_default_content","editor_free_text2_aria_label"]});const at=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(at.getPropertyValue("--freetext-padding"))}static updateDefaultParams(G,at){switch(G){case l.AnnotationEditorParamsType.FREETEXT_SIZE:V._defaultFontSize=at;break;case l.AnnotationEditorParamsType.FREETEXT_COLOR:V._defaultColor=at;break}}updateParams(G,at){switch(G){case l.AnnotationEditorParamsType.FREETEXT_SIZE:j(this,m,Fi).call(this,at);break;case l.AnnotationEditorParamsType.FREETEXT_COLOR:j(this,w,Mi).call(this,at);break}}static get defaultPropertiesToUpdate(){return[[l.AnnotationEditorParamsType.FREETEXT_SIZE,V._defaultFontSize],[l.AnnotationEditorParamsType.FREETEXT_COLOR,V._defaultColor||rt.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[l.AnnotationEditorParamsType.FREETEXT_SIZE,t(this,y)],[l.AnnotationEditorParamsType.FREETEXT_COLOR,t(this,N)]]}_translateEmpty(G,at){this._uiManager.translateSelectedEditors(G,at,!0)}getInitialTranslation(){const G=this.parentScale;return[-V._internalPadding*G,-(V._internalPadding+t(this,y))*G]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(l.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",t(this,L)),this.editorDiv.addEventListener("focus",t(this,k)),this.editorDiv.addEventListener("blur",t(this,B)),this.editorDiv.addEventListener("input",t(this,g)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",t(this,S)),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",t(this,L)),this.editorDiv.removeEventListener("focus",t(this,k)),this.editorDiv.removeEventListener("blur",t(this,B)),this.editorDiv.removeEventListener("input",t(this,g)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(G){this._focusEventsAllowed&&(super.focusin(G),G.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){if(this.width){j(this,Y,ni).call(this);return}this.enableEditMode(),this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const G=t(this,M),at=J(this,M,j(this,a,Ri).call(this).trimEnd());if(G===at)return;const At=Tt=>{if(J(this,M,Tt),!Tt){this.remove();return}j(this,f,si).call(this),this._uiManager.rebuild(this),j(this,d,Ae).call(this)};this.addCommands({cmd:()=>{At(at)},undo:()=>{At(G)},mustExec:!1}),j(this,d,Ae).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(G){this.enterInEditMode()}keydown(G){G.target===this.div&&G.key==="Enter"&&(this.enterInEditMode(),G.preventDefault())}editorDivKeydown(G){V._keyboardManager.exec(this,G)}editorDivFocus(G){this.isEditing=!0}editorDivBlur(G){this.isEditing=!1}editorDivInput(G){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let G,at;this.width&&(G=this.x,at=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",t(this,S)),this.enableEditing(),rt.AnnotationEditor._l10nPromise.get("editor_free_text2_aria_label").then(Tt=>this.editorDiv?.setAttribute("aria-label",Tt)),rt.AnnotationEditor._l10nPromise.get("free_text2_default_content").then(Tt=>this.editorDiv?.setAttribute("default-content",Tt)),this.editorDiv.contentEditable=!0;const{style:At}=this.editorDiv;if(At.fontSize=`calc(${t(this,y)}px * var(--scale-factor))`,At.color=t(this,N),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,T.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[Tt,xt]=this.parentDimensions;if(this.annotationElementId){const{position:v}=t(this,p);let[i,n]=this.getInitialTranslation();[i,n]=this.pageTranslationToScreen(i,n);const[s,o]=this.pageDimensions,[h,A]=this.pageTranslation;let x,O;switch(this.rotation){case 0:x=G+(v[0]-h)/s,O=at+this.height-(v[1]-A)/o;break;case 90:x=G+(v[0]-h)/s,O=at-(v[1]-A)/o,[i,n]=[n,-i];break;case 180:x=G-this.width+(v[0]-h)/s,O=at-(v[1]-A)/o,[i,n]=[-i,-n];break;case 270:x=G+(v[0]-h-this.height*o)/s,O=at+(v[1]-A-this.width*s)/o,[i,n]=[-n,i];break}this.setAt(x*Tt,O*xt,i,n)}else this.setAt(G*Tt,at*xt,this.width*Tt,this.height*xt);j(this,f,si).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(G,at,At){let Tt=null;if(G instanceof z.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:v,fontColor:i},rect:n,rotation:s,id:o},textContent:h,textPosition:A,parent:{page:{pageNumber:x}}}=G;if(!h||h.length===0)return null;Tt=G={annotationType:l.AnnotationEditorType.FREETEXT,color:Array.from(i),fontSize:v,value:h.join(`
`),position:A,pageIndex:x-1,rect:n,rotation:s,id:o,deleted:!1}}const xt=super.deserialize(G,at,At);return J(xt,y,G.fontSize),J(xt,N,l.Util.makeHexColor(...G.color)),J(xt,M,G.value),xt.annotationElementId=G.id||null,J(xt,p,Tt),xt}serialize(G=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const at=V._internalPadding*this.parentScale,At=this.getRect(at,at),Tt=rt.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:t(this,N)),xt={annotationType:l.AnnotationEditorType.FREETEXT,color:Tt,fontSize:t(this,y),value:t(this,M),pageIndex:this.pageIndex,rect:At,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return G?xt:this.annotationElementId&&!j(this,C,Di).call(this,xt)?null:(xt.id=this.annotationElementId,xt)}};B=new WeakMap,k=new WeakMap,g=new WeakMap,L=new WeakMap,N=new WeakMap,M=new WeakMap,S=new WeakMap,y=new WeakMap,p=new WeakMap,m=new WeakSet,Fi=function(G){const at=Tt=>{this.editorDiv.style.fontSize=`calc(${Tt}px * var(--scale-factor))`,this.translate(0,-(Tt-t(this,y))*this.parentScale),J(this,y,Tt),j(this,d,Ae).call(this)},At=t(this,y);this.addCommands({cmd:()=>{at(G)},undo:()=>{at(At)},mustExec:!0,type:l.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},w=new WeakSet,Mi=function(G){const at=t(this,N);this.addCommands({cmd:()=>{J(this,N,this.editorDiv.style.color=G)},undo:()=>{J(this,N,this.editorDiv.style.color=at)},mustExec:!0,type:l.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},a=new WeakSet,Ri=function(){const G=this.editorDiv.getElementsByTagName("div");if(G.length===0)return this.editorDiv.innerText;const at=[];for(const At of G)at.push(At.innerText.replace(/\r\n?|\n/,""));return at.join(`
`)},d=new WeakSet,Ae=function(){const[G,at]=this.parentDimensions;let At;if(this.isAttachedToDOM)At=this.div.getBoundingClientRect();else{const{currentLayer:Tt,div:xt}=this,v=xt.style.display;xt.style.display="hidden",Tt.div.append(this.div),At=xt.getBoundingClientRect(),xt.remove(),xt.style.display=v}this.rotation%180===this.parentRotation%180?(this.width=At.width/G,this.height=At.height/at):(this.width=At.height/G,this.height=At.width/at),this.fixAndSetPosition()},f=new WeakSet,si=function(){if(this.editorDiv.replaceChildren(),!!t(this,M))for(const G of t(this,M).split(`
`)){const at=document.createElement("div");at.append(G?document.createTextNode(G):document.createElement("br")),this.editorDiv.append(at)}},C=new WeakSet,Di=function(G){const{value:at,fontSize:At,color:Tt,rect:xt,pageIndex:v}=t(this,p);return G.value!==at||G.fontSize!==At||G.rect.some((i,n)=>Math.abs(i-xt[n])>=1)||G.color.some((i,n)=>i!==Tt[n])||G.pageIndex!==v},Y=new WeakSet,ni=function(G=!1){if(!this.annotationElementId)return;if(j(this,d,Ae).call(this),!G&&(this.width===0||this.height===0)){setTimeout(()=>j(this,Y,ni).call(this,!0),0);return}const at=V._internalPadding*this.parentScale;t(this,p).rect=this.getRect(at,at)},Zt(V,"_freeTextDefaultContent",""),Zt(V,"_internalPadding",0),Zt(V,"_defaultColor",null),Zt(V,"_defaultFontSize",10),Zt(V,"_type","freetext");let gt=V;u.FreeTextEditor=gt},(pt,u,et)=>{var n,o,oe,A,Ii,O,Q,Z,it,lt,yt,dt,kt,Ut,vt,Rt,ft,K,$,ht,Ct,St,Wt,Li,jt,ke,Gt,ri,zt,ai,tt,H,mt,_t,ee,Jt,q,oi,Nt,wt,Dt,Bt,Oi,bt,li;Object.defineProperty(u,"__esModule",{value:!0}),u.StampAnnotationElement=u.InkAnnotationElement=u.FreeTextAnnotationElement=u.AnnotationLayer=void 0;var l=et(1),T=et(6),rt=et(3),z=et(30),gt=et(31),B=et(32);const k=1e3,g=9,L=new WeakSet;function N(Lt){return{width:Lt[2]-Lt[0],height:Lt[3]-Lt[1]}}class M{static create(R){switch(R.data.annotationType){case l.AnnotationType.LINK:return new y(R);case l.AnnotationType.TEXT:return new p(R);case l.AnnotationType.WIDGET:switch(R.data.fieldType){case"Tx":return new E(R);case"Btn":return R.data.radioButton?new a(R):R.data.checkBox?new _(R):new c(R);case"Ch":return new d(R);case"Sig":return new w(R)}return new m(R);case l.AnnotationType.POPUP:return new r(R);case l.AnnotationType.FREETEXT:return new F(R);case l.AnnotationType.LINE:return new C(R);case l.AnnotationType.SQUARE:return new X(R);case l.AnnotationType.CIRCLE:return new Y(R);case l.AnnotationType.POLYLINE:return new P(R);case l.AnnotationType.CARET:return new ut(R);case l.AnnotationType.INK:return new nt(R);case l.AnnotationType.POLYGON:return new V(R);case l.AnnotationType.HIGHLIGHT:return new G(R);case l.AnnotationType.UNDERLINE:return new at(R);case l.AnnotationType.SQUIGGLY:return new At(R);case l.AnnotationType.STRIKEOUT:return new Tt(R);case l.AnnotationType.STAMP:return new xt(R);case l.AnnotationType.FILEATTACHMENT:return new v(R);default:return new S(R)}}}const s=class s{constructor(R,{isRenderable:e=!1,ignoreBorder:b=!1,createQuadrilaterals:I=!1}={}){D(this,n,!1);this.isRenderable=e,this.data=R.data,this.layer=R.layer,this.linkService=R.linkService,this.downloadManager=R.downloadManager,this.imageResourcesPath=R.imageResourcesPath,this.renderForms=R.renderForms,this.svgFactory=R.svgFactory,this.annotationStorage=R.annotationStorage,this.enableScripting=R.enableScripting,this.hasJSActions=R.hasJSActions,this._fieldObjects=R.fieldObjects,this.parent=R.parent,e&&(this.container=this._createContainer(b)),I&&this._createQuadrilaterals()}static _hasPopupData({titleObj:R,contentsObj:e,richText:b}){return!!(R?.str||e?.str||b?.str)}get hasPopupData(){return s._hasPopupData(this.data)}_createContainer(R){const{data:e,parent:{page:b,viewport:I}}=this,U=document.createElement("section");U.setAttribute("data-annotation-id",e.id),this instanceof m||(U.tabIndex=k),U.style.zIndex=this.parent.zIndex++,this.data.popupRef&&U.setAttribute("aria-haspopup","dialog"),e.noRotate&&U.classList.add("norotate");const{pageWidth:W,pageHeight:st,pageX:ct,pageY:Mt}=I.rawDims;if(!e.rect||this instanceof r){const{rotation:Vt}=e;return!e.hasOwnCanvas&&Vt!==0&&this.setRotation(Vt,U),U}const{width:It,height:Pt}=N(e.rect),Ft=l.Util.normalizeRect([e.rect[0],b.view[3]-e.rect[1]+b.view[1],e.rect[2],b.view[3]-e.rect[3]+b.view[1]]);if(!R&&e.borderStyle.width>0){U.style.borderWidth=`${e.borderStyle.width}px`;const Vt=e.borderStyle.horizontalCornerRadius,Qt=e.borderStyle.verticalCornerRadius;if(Vt>0||Qt>0){const te=`calc(${Vt}px * var(--scale-factor)) / calc(${Qt}px * var(--scale-factor))`;U.style.borderRadius=te}else if(this instanceof a){const te=`calc(${It}px * var(--scale-factor)) / calc(${Pt}px * var(--scale-factor))`;U.style.borderRadius=te}switch(e.borderStyle.style){case l.AnnotationBorderStyleType.SOLID:U.style.borderStyle="solid";break;case l.AnnotationBorderStyleType.DASHED:U.style.borderStyle="dashed";break;case l.AnnotationBorderStyleType.BEVELED:(0,l.warn)("Unimplemented border style: beveled");break;case l.AnnotationBorderStyleType.INSET:(0,l.warn)("Unimplemented border style: inset");break;case l.AnnotationBorderStyleType.UNDERLINE:U.style.borderBottomStyle="solid";break}const Kt=e.borderColor||null;Kt?(J(this,n,!0),U.style.borderColor=l.Util.makeHexColor(Kt[0]|0,Kt[1]|0,Kt[2]|0)):U.style.borderWidth=0}U.style.left=`${100*(Ft[0]-ct)/W}%`,U.style.top=`${100*(Ft[1]-Mt)/st}%`;const{rotation:Ot}=e;return e.hasOwnCanvas||Ot===0?(U.style.width=`${100*It/W}%`,U.style.height=`${100*Pt/st}%`):this.setRotation(Ot,U),U}setRotation(R,e=this.container){if(!this.data.rect)return;const{pageWidth:b,pageHeight:I}=this.parent.viewport.rawDims,{width:U,height:W}=N(this.data.rect);let st,ct;R%180===0?(st=100*U/b,ct=100*W/I):(st=100*W/b,ct=100*U/I),e.style.width=`${st}%`,e.style.height=`${ct}%`,e.setAttribute("data-main-rotation",(360-R)%360)}get _commonActions(){const R=(e,b,I)=>{const U=I.detail[e],W=U[0],st=U.slice(1);I.target.style[b]=z.ColorConverters[`${W}_HTML`](st),this.annotationStorage.setValue(this.data.id,{[b]:z.ColorConverters[`${W}_rgb`](st)})};return(0,l.shadow)(this,"_commonActions",{display:e=>{const{display:b}=e.detail,I=b%2===1;this.container.style.visibility=I?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:I,noPrint:b===1||b===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:b}=e.detail;this.container.style.visibility=b?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:b,noView:b})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{R("bgColor","backgroundColor",e)},fillColor:e=>{R("fillColor","backgroundColor",e)},fgColor:e=>{R("fgColor","color",e)},textColor:e=>{R("textColor","color",e)},borderColor:e=>{R("borderColor","borderColor",e)},strokeColor:e=>{R("strokeColor","borderColor",e)},rotation:e=>{const b=e.detail.rotation;this.setRotation(b),this.annotationStorage.setValue(this.data.id,{rotation:b})}})}_dispatchEventFromSandbox(R,e){const b=this._commonActions;for(const I of Object.keys(e.detail))(R[I]||b[I])?.(e)}_setDefaultPropertiesFromJS(R){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const b=this._commonActions;for(const[I,U]of Object.entries(e)){const W=b[I];if(W){const st={detail:{[I]:U},target:R};W(st),delete e[I]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:R}=this.data;if(!R)return;const[e,b,I,U]=this.data.rect;if(R.length===1){const[,{x:Qt,y:Kt},{x:te,y:se}]=R[0];if(I===Qt&&U===Kt&&e===te&&b===se)return}const{style:W}=this.container;let st;if(t(this,n)){const{borderColor:Qt,borderWidth:Kt}=W;W.borderWidth=0,st=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${Qt}" stroke-width="${Kt}">`],this.container.classList.add("hasBorder")}const ct=I-e,Mt=U-b,{svgFactory:It}=this,Pt=It.createElement("svg");Pt.classList.add("quadrilateralsContainer"),Pt.setAttribute("width",0),Pt.setAttribute("height",0);const Ft=It.createElement("defs");Pt.append(Ft);const Ot=It.createElement("clipPath"),Vt=`clippath_${this.data.id}`;Ot.setAttribute("id",Vt),Ot.setAttribute("clipPathUnits","objectBoundingBox"),Ft.append(Ot);for(const[,{x:Qt,y:Kt},{x:te,y:se}]of R){const ie=It.createElement("rect"),ae=(te-e)/ct,fe=(U-Kt)/Mt,bi=(Qt-te)/ct,_i=(Kt-se)/Mt;ie.setAttribute("x",ae),ie.setAttribute("y",fe),ie.setAttribute("width",bi),ie.setAttribute("height",_i),Ot.append(ie),st?.push(`<rect vector-effect="non-scaling-stroke" x="${ae}" y="${fe}" width="${bi}" height="${_i}"/>`)}t(this,n)&&(st.push("</g></svg>')"),W.backgroundImage=st.join("")),this.container.append(Pt),this.container.style.clipPath=`url(#${Vt})`}_createPopup(){const{container:R,data:e}=this;R.setAttribute("aria-haspopup","dialog");const b=new r({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]});this.parent.div.append(b.render())}render(){(0,l.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(R,e=null){const b=[];if(this._fieldObjects){const I=this._fieldObjects[R];if(I)for(const{page:U,id:W,exportValues:st}of I){if(U===-1||W===e)continue;const ct=typeof st=="string"?st:null,Mt=document.querySelector(`[data-element-id="${W}"]`);if(Mt&&!L.has(Mt)){(0,l.warn)(`_getElementsByName - element not allowed: ${W}`);continue}b.push({id:W,exportValue:ct,domElement:Mt})}return b}for(const I of document.getElementsByName(R)){const{exportValue:U}=I,W=I.getAttribute("data-element-id");W!==e&&L.has(I)&&b.push({id:W,exportValue:U,domElement:I})}return b}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const R=this.getElementsToTriggerPopup();if(Array.isArray(R))for(const e of R)e.classList.add("highlightArea");else R.classList.add("highlightArea")}_editOnDoubleClick(){const{annotationEditorType:R,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:R,editId:e})})}};n=new WeakMap;let S=s;class y extends S{constructor(e,b=null){super(e,{isRenderable:!0,ignoreBorder:!!b?.ignoreBorder,createQuadrilaterals:!0});D(this,o);D(this,A);this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:b}=this,I=document.createElement("a");I.setAttribute("data-element-id",e.id);let U=!1;return e.url?(b.addLinkAttributes(I,e.url,e.newWindow),U=!0):e.action?(this._bindNamedAction(I,e.action),U=!0):e.attachment?(this._bindAttachment(I,e.attachment),U=!0):e.setOCGState?(j(this,A,Ii).call(this,I,e.setOCGState),U=!0):e.dest?(this._bindLink(I,e.dest),U=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(I,e),U=!0),e.resetForm?(this._bindResetFormAction(I,e.resetForm),U=!0):this.isTooltipOnly&&!U&&(this._bindLink(I,""),U=!0)),this.container.classList.add("linkAnnotation"),U&&this.container.append(I),this.container}_bindLink(e,b){e.href=this.linkService.getDestinationHash(b),e.onclick=()=>(b&&this.linkService.goToDestination(b),!1),(b||b==="")&&j(this,o,oe).call(this)}_bindNamedAction(e,b){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(b),!1),j(this,o,oe).call(this)}_bindAttachment(e,b){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.downloadManager?.openOrDownloadData(this.container,b.content,b.filename),!1),j(this,o,oe).call(this)}_bindJSAction(e,b){e.href=this.linkService.getAnchorUrl("");const I=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const U of Object.keys(b.actions)){const W=I.get(U);W&&(e[W]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:b.id,name:U}}),!1))}e.onclick||(e.onclick=()=>!1),j(this,o,oe).call(this)}_bindResetFormAction(e,b){const I=e.onclick;if(I||(e.href=this.linkService.getAnchorUrl("")),j(this,o,oe).call(this),!this._fieldObjects){(0,l.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),I||(e.onclick=()=>!1);return}e.onclick=()=>{I?.();const{fields:U,refs:W,include:st}=b,ct=[];if(U.length!==0||W.length!==0){const Pt=new Set(W);for(const Ft of U){const Ot=this._fieldObjects[Ft]||[];for(const{id:Vt}of Ot)Pt.add(Vt)}for(const Ft of Object.values(this._fieldObjects))for(const Ot of Ft)Pt.has(Ot.id)===st&&ct.push(Ot)}else for(const Pt of Object.values(this._fieldObjects))ct.push(...Pt);const Mt=this.annotationStorage,It=[];for(const Pt of ct){const{id:Ft}=Pt;switch(It.push(Ft),Pt.type){case"text":{const Vt=Pt.defaultValue||"";Mt.setValue(Ft,{value:Vt});break}case"checkbox":case"radiobutton":{const Vt=Pt.defaultValue===Pt.exportValues;Mt.setValue(Ft,{value:Vt});break}case"combobox":case"listbox":{const Vt=Pt.defaultValue||"";Mt.setValue(Ft,{value:Vt});break}default:continue}const Ot=document.querySelector(`[data-element-id="${Ft}"]`);if(Ot){if(!L.has(Ot)){(0,l.warn)(`_bindResetFormAction - element not allowed: ${Ft}`);continue}}else continue;Ot.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:It,name:"ResetForm"}}),!1}}}o=new WeakSet,oe=function(){this.container.setAttribute("data-internal-link","")},A=new WeakSet,Ii=function(e,b){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(b),!1),j(this,o,oe).call(this)};class p extends S{constructor(R){super(R,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const R=document.createElement("img");return R.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",R.alt="[{{type}} Annotation]",R.dataset.l10nId="text_annotation_type",R.dataset.l10nArgs=JSON.stringify({type:this.data.name}),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(R),this.container}}class m extends S{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(R){this.data.hasOwnCanvas&&(R.previousSibling?.nodeName==="CANVAS"&&(R.previousSibling.hidden=!0),R.hidden=!1)}_getKeyModifier(R){const{isWin:e,isMac:b}=l.FeatureTest.platform;return e&&R.ctrlKey||b&&R.metaKey}_setEventListener(R,e,b,I,U){b.includes("mouse")?R.addEventListener(b,W=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:I,value:U(W),shift:W.shiftKey,modifier:this._getKeyModifier(W)}})}):R.addEventListener(b,W=>{if(b==="blur"){if(!e.focused||!W.relatedTarget)return;e.focused=!1}else if(b==="focus"){if(e.focused)return;e.focused=!0}U&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:I,value:U(W)}})})}_setEventListeners(R,e,b,I){for(const[U,W]of b)(W==="Action"||this.data.actions?.[W])&&((W==="Focus"||W==="Blur")&&(e||(e={focused:!1})),this._setEventListener(R,e,U,W,I),W==="Focus"&&!this.data.actions?.Blur?this._setEventListener(R,e,"blur","Blur",null):W==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(R,e,"focus","Focus",null))}_setBackgroundColor(R){const e=this.data.backgroundColor||null;R.style.backgroundColor=e===null?"transparent":l.Util.makeHexColor(e[0],e[1],e[2])}_setTextStyle(R){const e=["left","center","right"],{fontColor:b}=this.data.defaultAppearanceData,I=this.data.defaultAppearanceData.fontSize||g,U=R.style;let W;const st=2,ct=Mt=>Math.round(10*Mt)/10;if(this.data.multiLine){const Mt=Math.abs(this.data.rect[3]-this.data.rect[1]-st),It=Math.round(Mt/(l.LINE_FACTOR*I))||1,Pt=Mt/It;W=Math.min(I,ct(Pt/l.LINE_FACTOR))}else{const Mt=Math.abs(this.data.rect[3]-this.data.rect[1]-st);W=Math.min(I,ct(Mt/l.LINE_FACTOR))}U.fontSize=`calc(${W}px * var(--scale-factor))`,U.color=l.Util.makeHexColor(b[0],b[1],b[2]),this.data.textAlignment!==null&&(U.textAlign=e[this.data.textAlignment])}_setRequired(R,e){e?R.setAttribute("required",!0):R.removeAttribute("required"),R.setAttribute("aria-required",e)}}class E extends m{constructor(R){const e=R.renderForms||!R.data.hasAppearance&&!!R.data.fieldValue;super(R,{isRenderable:e})}setPropertyOnSiblings(R,e,b,I){const U=this.annotationStorage;for(const W of this._getElementsByName(R.name,R.id))W.domElement&&(W.domElement[e]=b),U.setValue(W.id,{[I]:b})}render(){const R=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let b=null;if(this.renderForms){const I=R.getValue(e,{value:this.data.fieldValue});let U=I.value||"";const W=R.getValue(e,{charLimit:this.data.maxLen}).charLimit;W&&U.length>W&&(U=U.slice(0,W));let st=I.formattedValue||this.data.textContent?.join(`
`)||null;st&&this.data.comb&&(st=st.replaceAll(/\s+/g,""));const ct={userValue:U,formattedValue:st,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(b=document.createElement("textarea"),b.textContent=st??U,this.data.doNotScroll&&(b.style.overflowY="hidden")):(b=document.createElement("input"),b.type="text",b.setAttribute("value",st??U),this.data.doNotScroll&&(b.style.overflowX="hidden")),this.data.hasOwnCanvas&&(b.hidden=!0),L.add(b),b.setAttribute("data-element-id",e),b.disabled=this.data.readOnly,b.name=this.data.fieldName,b.tabIndex=k,this._setRequired(b,this.data.required),W&&(b.maxLength=W),b.addEventListener("input",It=>{R.setValue(e,{value:It.target.value}),this.setPropertyOnSiblings(b,"value",It.target.value,"value"),ct.formattedValue=null}),b.addEventListener("resetform",It=>{const Pt=this.data.defaultFieldValue??"";b.value=ct.userValue=Pt,ct.formattedValue=null});let Mt=It=>{const{formattedValue:Pt}=ct;Pt!=null&&(It.target.value=Pt),It.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){b.addEventListener("focus",Pt=>{if(ct.focused)return;const{target:Ft}=Pt;ct.userValue&&(Ft.value=ct.userValue),ct.lastCommittedValue=Ft.value,ct.commitKey=1,ct.focused=!0}),b.addEventListener("updatefromsandbox",Pt=>{this.showElementAndHideCanvas(Pt.target);const Ft={value(Ot){ct.userValue=Ot.detail.value??"",R.setValue(e,{value:ct.userValue.toString()}),Ot.target.value=ct.userValue},formattedValue(Ot){const{formattedValue:Vt}=Ot.detail;ct.formattedValue=Vt,Vt!=null&&Ot.target!==document.activeElement&&(Ot.target.value=Vt),R.setValue(e,{formattedValue:Vt})},selRange(Ot){Ot.target.setSelectionRange(...Ot.detail.selRange)},charLimit:Ot=>{const{charLimit:Vt}=Ot.detail,{target:Qt}=Ot;if(Vt===0){Qt.removeAttribute("maxLength");return}Qt.setAttribute("maxLength",Vt);let Kt=ct.userValue;!Kt||Kt.length<=Vt||(Kt=Kt.slice(0,Vt),Qt.value=ct.userValue=Kt,R.setValue(e,{value:Kt}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:Kt,willCommit:!0,commitKey:1,selStart:Qt.selectionStart,selEnd:Qt.selectionEnd}}))}};this._dispatchEventFromSandbox(Ft,Pt)}),b.addEventListener("keydown",Pt=>{ct.commitKey=1;let Ft=-1;if(Pt.key==="Escape"?Ft=0:Pt.key==="Enter"&&!this.data.multiLine?Ft=2:Pt.key==="Tab"&&(ct.commitKey=3),Ft===-1)return;const{value:Ot}=Pt.target;ct.lastCommittedValue!==Ot&&(ct.lastCommittedValue=Ot,ct.userValue=Ot,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:Ot,willCommit:!0,commitKey:Ft,selStart:Pt.target.selectionStart,selEnd:Pt.target.selectionEnd}}))});const It=Mt;Mt=null,b.addEventListener("blur",Pt=>{if(!ct.focused||!Pt.relatedTarget)return;ct.focused=!1;const{value:Ft}=Pt.target;ct.userValue=Ft,ct.lastCommittedValue!==Ft&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:Ft,willCommit:!0,commitKey:ct.commitKey,selStart:Pt.target.selectionStart,selEnd:Pt.target.selectionEnd}}),It(Pt)}),this.data.actions?.Keystroke&&b.addEventListener("beforeinput",Pt=>{ct.lastCommittedValue=null;const{data:Ft,target:Ot}=Pt,{value:Vt,selectionStart:Qt,selectionEnd:Kt}=Ot;let te=Qt,se=Kt;switch(Pt.inputType){case"deleteWordBackward":{const ie=Vt.substring(0,Qt).match(/\w*[^\w]*$/);ie&&(te-=ie[0].length);break}case"deleteWordForward":{const ie=Vt.substring(Qt).match(/^[^\w]*\w*/);ie&&(se+=ie[0].length);break}case"deleteContentBackward":Qt===Kt&&(te-=1);break;case"deleteContentForward":Qt===Kt&&(se+=1);break}Pt.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:Vt,change:Ft||"",willCommit:!1,selStart:te,selEnd:se}})}),this._setEventListeners(b,ct,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Pt=>Pt.target.value)}if(Mt&&b.addEventListener("blur",Mt),this.data.comb){const Pt=(this.data.rect[2]-this.data.rect[0])/W;b.classList.add("comb"),b.style.letterSpacing=`calc(${Pt}px * var(--scale-factor) - 1ch)`}}else b=document.createElement("div"),b.textContent=this.data.fieldValue,b.style.verticalAlign="middle",b.style.display="table-cell";return this._setTextStyle(b),this._setBackgroundColor(b),this._setDefaultPropertiesFromJS(b),this.container.append(b),this.container}}class w extends m{constructor(R){super(R,{isRenderable:!!R.data.hasOwnCanvas})}}class _ extends m{constructor(R){super(R,{isRenderable:R.renderForms})}render(){const R=this.annotationStorage,e=this.data,b=e.id;let I=R.getValue(b,{value:e.exportValue===e.fieldValue}).value;typeof I=="string"&&(I=I!=="Off",R.setValue(b,{value:I})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const U=document.createElement("input");return L.add(U),U.setAttribute("data-element-id",b),U.disabled=e.readOnly,this._setRequired(U,this.data.required),U.type="checkbox",U.name=e.fieldName,I&&U.setAttribute("checked",!0),U.setAttribute("exportValue",e.exportValue),U.tabIndex=k,U.addEventListener("change",W=>{const{name:st,checked:ct}=W.target;for(const Mt of this._getElementsByName(st,b)){const It=ct&&Mt.exportValue===e.exportValue;Mt.domElement&&(Mt.domElement.checked=It),R.setValue(Mt.id,{value:It})}R.setValue(b,{value:ct})}),U.addEventListener("resetform",W=>{const st=e.defaultFieldValue||"Off";W.target.checked=st===e.exportValue}),this.enableScripting&&this.hasJSActions&&(U.addEventListener("updatefromsandbox",W=>{const st={value(ct){ct.target.checked=ct.detail.value!=="Off",R.setValue(b,{value:ct.target.checked})}};this._dispatchEventFromSandbox(st,W)}),this._setEventListeners(U,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],W=>W.target.checked)),this._setBackgroundColor(U),this._setDefaultPropertiesFromJS(U),this.container.append(U),this.container}}class a extends m{constructor(R){super(R,{isRenderable:R.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const R=this.annotationStorage,e=this.data,b=e.id;let I=R.getValue(b,{value:e.fieldValue===e.buttonValue}).value;typeof I=="string"&&(I=I!==e.buttonValue,R.setValue(b,{value:I}));const U=document.createElement("input");if(L.add(U),U.setAttribute("data-element-id",b),U.disabled=e.readOnly,this._setRequired(U,this.data.required),U.type="radio",U.name=e.fieldName,I&&U.setAttribute("checked",!0),U.tabIndex=k,U.addEventListener("change",W=>{const{name:st,checked:ct}=W.target;for(const Mt of this._getElementsByName(st,b))R.setValue(Mt.id,{value:!1});R.setValue(b,{value:ct})}),U.addEventListener("resetform",W=>{const st=e.defaultFieldValue;W.target.checked=st!=null&&st===e.buttonValue}),this.enableScripting&&this.hasJSActions){const W=e.buttonValue;U.addEventListener("updatefromsandbox",st=>{const ct={value:Mt=>{const It=W===Mt.detail.value;for(const Pt of this._getElementsByName(Mt.target.name)){const Ft=It&&Pt.id===b;Pt.domElement&&(Pt.domElement.checked=Ft),R.setValue(Pt.id,{value:Ft})}}};this._dispatchEventFromSandbox(ct,st)}),this._setEventListeners(U,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],st=>st.target.checked)}return this._setBackgroundColor(U),this._setDefaultPropertiesFromJS(U),this.container.append(U),this.container}}class c extends y{constructor(R){super(R,{ignoreBorder:R.data.hasAppearance})}render(){const R=super.render();R.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(R.title=this.data.alternativeText);const e=R.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",b=>{this._dispatchEventFromSandbox({},b)})),R}}class d extends m{constructor(R){super(R,{isRenderable:R.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const R=this.annotationStorage,e=this.data.id,b=R.getValue(e,{value:this.data.fieldValue}),I=document.createElement("select");L.add(I),I.setAttribute("data-element-id",e),I.disabled=this.data.readOnly,this._setRequired(I,this.data.required),I.name=this.data.fieldName,I.tabIndex=k;let U=this.data.combo&&this.data.options.length>0;this.data.combo||(I.size=this.data.options.length,this.data.multiSelect&&(I.multiple=!0)),I.addEventListener("resetform",It=>{const Pt=this.data.defaultFieldValue;for(const Ft of I.options)Ft.selected=Ft.value===Pt});for(const It of this.data.options){const Pt=document.createElement("option");Pt.textContent=It.displayValue,Pt.value=It.exportValue,b.value.includes(It.exportValue)&&(Pt.setAttribute("selected",!0),U=!1),I.append(Pt)}let W=null;if(U){const It=document.createElement("option");It.value=" ",It.setAttribute("hidden",!0),It.setAttribute("selected",!0),I.prepend(It),W=()=>{It.remove(),I.removeEventListener("input",W),W=null},I.addEventListener("input",W)}const st=It=>{const Pt=It?"value":"textContent",{options:Ft,multiple:Ot}=I;return Ot?Array.prototype.filter.call(Ft,Vt=>Vt.selected).map(Vt=>Vt[Pt]):Ft.selectedIndex===-1?null:Ft[Ft.selectedIndex][Pt]};let ct=st(!1);const Mt=It=>{const Pt=It.target.options;return Array.prototype.map.call(Pt,Ft=>({displayValue:Ft.textContent,exportValue:Ft.value}))};return this.enableScripting&&this.hasJSActions?(I.addEventListener("updatefromsandbox",It=>{const Pt={value(Ft){W?.();const Ot=Ft.detail.value,Vt=new Set(Array.isArray(Ot)?Ot:[Ot]);for(const Qt of I.options)Qt.selected=Vt.has(Qt.value);R.setValue(e,{value:st(!0)}),ct=st(!1)},multipleSelection(Ft){I.multiple=!0},remove(Ft){const Ot=I.options,Vt=Ft.detail.remove;Ot[Vt].selected=!1,I.remove(Vt),Ot.length>0&&Array.prototype.findIndex.call(Ot,Kt=>Kt.selected)===-1&&(Ot[0].selected=!0),R.setValue(e,{value:st(!0),items:Mt(Ft)}),ct=st(!1)},clear(Ft){for(;I.length!==0;)I.remove(0);R.setValue(e,{value:null,items:[]}),ct=st(!1)},insert(Ft){const{index:Ot,displayValue:Vt,exportValue:Qt}=Ft.detail.insert,Kt=I.children[Ot],te=document.createElement("option");te.textContent=Vt,te.value=Qt,Kt?Kt.before(te):I.append(te),R.setValue(e,{value:st(!0),items:Mt(Ft)}),ct=st(!1)},items(Ft){const{items:Ot}=Ft.detail;for(;I.length!==0;)I.remove(0);for(const Vt of Ot){const{displayValue:Qt,exportValue:Kt}=Vt,te=document.createElement("option");te.textContent=Qt,te.value=Kt,I.append(te)}I.options.length>0&&(I.options[0].selected=!0),R.setValue(e,{value:st(!0),items:Mt(Ft)}),ct=st(!1)},indices(Ft){const Ot=new Set(Ft.detail.indices);for(const Vt of Ft.target.options)Vt.selected=Ot.has(Vt.index);R.setValue(e,{value:st(!0)}),ct=st(!1)},editable(Ft){Ft.target.disabled=!Ft.detail.editable}};this._dispatchEventFromSandbox(Pt,It)}),I.addEventListener("input",It=>{const Pt=st(!0);R.setValue(e,{value:Pt}),It.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:ct,changeEx:Pt,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(I,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],It=>It.target.value)):I.addEventListener("input",function(It){R.setValue(e,{value:st(!0)})}),this.data.combo&&this._setTextStyle(I),this._setBackgroundColor(I),this._setDefaultPropertiesFromJS(I),this.container.append(I),this.container}}class r extends S{constructor(R){const{data:e,elements:b}=R;super(R,{isRenderable:S._hasPopupData(e)}),this.elements=b}render(){this.container.classList.add("popupAnnotation");const R=new f({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),e=[];for(const b of this.elements)b.popup=R,e.push(b.data.id),b.addHighlightArea();return this.container.setAttribute("aria-controls",e.map(b=>`${l.AnnotationPrefix}${b}`).join(",")),this.container}}class f{constructor({container:R,color:e,elements:b,titleObj:I,modificationDate:U,contentsObj:W,richText:st,parent:ct,rect:Mt,parentRect:It,open:Pt}){D(this,Wt);D(this,jt);D(this,Gt);D(this,zt);D(this,O,null);D(this,Q,j(this,Wt,Li).bind(this));D(this,Z,j(this,zt,ai).bind(this));D(this,it,j(this,Gt,ri).bind(this));D(this,lt,j(this,jt,ke).bind(this));D(this,yt,null);D(this,dt,null);D(this,kt,null);D(this,Ut,null);D(this,vt,null);D(this,Rt,null);D(this,ft,!1);D(this,K,null);D(this,$,null);D(this,ht,null);D(this,Ct,null);D(this,St,!1);J(this,dt,R),J(this,Ct,I),J(this,kt,W),J(this,ht,st),J(this,vt,ct),J(this,yt,e),J(this,$,Mt),J(this,Rt,It),J(this,Ut,b);const Ft=T.PDFDateString.toDateObject(U);Ft&&J(this,O,ct.l10n.get("annotation_date_string",{date:Ft.toLocaleDateString(),time:Ft.toLocaleTimeString()})),this.trigger=b.flatMap(Ot=>Ot.getElementsToTriggerPopup());for(const Ot of this.trigger)Ot.addEventListener("click",t(this,lt)),Ot.addEventListener("mouseenter",t(this,it)),Ot.addEventListener("mouseleave",t(this,Z)),Ot.classList.add("popupTriggerArea");for(const Ot of b)Ot.container?.addEventListener("keydown",t(this,Q));t(this,dt).hidden=!0,Pt&&j(this,jt,ke).call(this)}render(){if(t(this,K))return;const{page:{view:R},viewport:{rawDims:{pageWidth:e,pageHeight:b,pageX:I,pageY:U}}}=t(this,vt),W=J(this,K,document.createElement("div"));if(W.className="popup",t(this,yt)){const ie=W.style.outlineColor=l.Util.makeHexColor(...t(this,yt));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?W.style.backgroundColor=`color-mix(in srgb, ${ie} 30%, white)`:W.style.backgroundColor=l.Util.makeHexColor(...t(this,yt).map(fe=>Math.floor(.7*(255-fe)+fe)))}const st=document.createElement("span");st.className="header";const ct=document.createElement("h1");if(st.append(ct),{dir:ct.dir,str:ct.textContent}=t(this,Ct),W.append(st),t(this,O)){const ie=document.createElement("span");ie.classList.add("popupDate"),t(this,O).then(ae=>{ie.textContent=ae}),st.append(ie)}const Mt=t(this,kt),It=t(this,ht);if(It?.str&&(!Mt?.str||Mt.str===It.str))B.XfaLayer.render({xfaHtml:It.html,intent:"richText",div:W}),W.lastChild.classList.add("richText","popupContent");else{const ie=this._formatContents(Mt);W.append(ie)}let Pt=!!t(this,Rt),Ft=Pt?t(this,Rt):t(this,$);for(const ie of t(this,Ut))if(!Ft||l.Util.intersect(ie.data.rect,Ft)!==null){Ft=ie.data.rect,Pt=!0;break}const Ot=l.Util.normalizeRect([Ft[0],R[3]-Ft[1]+R[1],Ft[2],R[3]-Ft[3]+R[1]]),Vt=5,Qt=Pt?Ft[2]-Ft[0]+Vt:0,Kt=Ot[0]+Qt,te=Ot[1],{style:se}=t(this,dt);se.left=`${100*(Kt-I)/e}%`,se.top=`${100*(te-U)/b}%`,t(this,dt).append(W)}_formatContents({str:R,dir:e}){const b=document.createElement("p");b.classList.add("popupContent"),b.dir=e;const I=R.split(/(?:\r\n?|\n)/);for(let U=0,W=I.length;U<W;++U){const st=I[U];b.append(document.createTextNode(st)),U<W-1&&b.append(document.createElement("br"))}return b}forceHide(){J(this,St,this.isVisible),t(this,St)&&(t(this,dt).hidden=!0)}maybeShow(){t(this,St)&&(J(this,St,!1),t(this,dt).hidden=!1)}get isVisible(){return t(this,dt).hidden===!1}}O=new WeakMap,Q=new WeakMap,Z=new WeakMap,it=new WeakMap,lt=new WeakMap,yt=new WeakMap,dt=new WeakMap,kt=new WeakMap,Ut=new WeakMap,vt=new WeakMap,Rt=new WeakMap,ft=new WeakMap,K=new WeakMap,$=new WeakMap,ht=new WeakMap,Ct=new WeakMap,St=new WeakMap,Wt=new WeakSet,Li=function(R){R.altKey||R.shiftKey||R.ctrlKey||R.metaKey||(R.key==="Enter"||R.key==="Escape"&&t(this,ft))&&j(this,jt,ke).call(this)},jt=new WeakSet,ke=function(){J(this,ft,!t(this,ft)),t(this,ft)?(j(this,Gt,ri).call(this),t(this,dt).addEventListener("click",t(this,lt)),t(this,dt).addEventListener("keydown",t(this,Q))):(j(this,zt,ai).call(this),t(this,dt).removeEventListener("click",t(this,lt)),t(this,dt).removeEventListener("keydown",t(this,Q)))},Gt=new WeakSet,ri=function(){t(this,K)||this.render(),this.isVisible?t(this,ft)&&t(this,dt).classList.add("focused"):(t(this,dt).hidden=!1,t(this,dt).style.zIndex=parseInt(t(this,dt).style.zIndex)+1e3)},zt=new WeakSet,ai=function(){t(this,dt).classList.remove("focused"),!(t(this,ft)||!this.isVisible)&&(t(this,dt).hidden=!0,t(this,dt).style.zIndex=parseInt(t(this,dt).style.zIndex)-1e3)};class F extends S{constructor(R){super(R,{isRenderable:!0,ignoreBorder:!0}),this.textContent=R.data.textContent,this.textPosition=R.data.textPosition,this.annotationEditorType=l.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const R=document.createElement("div");R.classList.add("annotationTextContent"),R.setAttribute("role","comment");for(const e of this.textContent){const b=document.createElement("span");b.textContent=e,R.append(b)}this.container.append(R)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}u.FreeTextAnnotationElement=F;class C extends S{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});D(this,tt,null)}render(){this.container.classList.add("lineAnnotation");const e=this.data,{width:b,height:I}=N(e.rect),U=this.svgFactory.create(b,I,!0),W=J(this,tt,this.svgFactory.createElement("svg:line"));return W.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),W.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),W.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),W.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),W.setAttribute("stroke-width",e.borderStyle.width||1),W.setAttribute("stroke","transparent"),W.setAttribute("fill","transparent"),U.append(W),this.container.append(U),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return t(this,tt)}addHighlightArea(){this.container.classList.add("highlightArea")}}tt=new WeakMap;class X extends S{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});D(this,H,null)}render(){this.container.classList.add("squareAnnotation");const e=this.data,{width:b,height:I}=N(e.rect),U=this.svgFactory.create(b,I,!0),W=e.borderStyle.width,st=J(this,H,this.svgFactory.createElement("svg:rect"));return st.setAttribute("x",W/2),st.setAttribute("y",W/2),st.setAttribute("width",b-W),st.setAttribute("height",I-W),st.setAttribute("stroke-width",W||1),st.setAttribute("stroke","transparent"),st.setAttribute("fill","transparent"),U.append(st),this.container.append(U),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return t(this,H)}addHighlightArea(){this.container.classList.add("highlightArea")}}H=new WeakMap;class Y extends S{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});D(this,mt,null)}render(){this.container.classList.add("circleAnnotation");const e=this.data,{width:b,height:I}=N(e.rect),U=this.svgFactory.create(b,I,!0),W=e.borderStyle.width,st=J(this,mt,this.svgFactory.createElement("svg:ellipse"));return st.setAttribute("cx",b/2),st.setAttribute("cy",I/2),st.setAttribute("rx",b/2-W/2),st.setAttribute("ry",I/2-W/2),st.setAttribute("stroke-width",W||1),st.setAttribute("stroke","transparent"),st.setAttribute("fill","transparent"),U.append(st),this.container.append(U),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return t(this,mt)}addHighlightArea(){this.container.classList.add("highlightArea")}}mt=new WeakMap;class P extends S{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});D(this,_t,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const e=this.data,{width:b,height:I}=N(e.rect),U=this.svgFactory.create(b,I,!0);let W=[];for(const ct of e.vertices){const Mt=ct.x-e.rect[0],It=e.rect[3]-ct.y;W.push(Mt+","+It)}W=W.join(" ");const st=J(this,_t,this.svgFactory.createElement(this.svgElementName));return st.setAttribute("points",W),st.setAttribute("stroke-width",e.borderStyle.width||1),st.setAttribute("stroke","transparent"),st.setAttribute("fill","transparent"),U.append(st),this.container.append(U),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return t(this,_t)}addHighlightArea(){this.container.classList.add("highlightArea")}}_t=new WeakMap;class V extends P{constructor(R){super(R),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class ut extends S{constructor(R){super(R,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class nt extends S{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});D(this,ee,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=l.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const e=this.data,{width:b,height:I}=N(e.rect),U=this.svgFactory.create(b,I,!0);for(const W of e.inkLists){let st=[];for(const Mt of W){const It=Mt.x-e.rect[0],Pt=e.rect[3]-Mt.y;st.push(`${It},${Pt}`)}st=st.join(" ");const ct=this.svgFactory.createElement(this.svgElementName);t(this,ee).push(ct),ct.setAttribute("points",st),ct.setAttribute("stroke-width",e.borderStyle.width||1),ct.setAttribute("stroke","transparent"),ct.setAttribute("fill","transparent"),!e.popupRef&&this.hasPopupData&&this._createPopup(),U.append(ct)}return this.container.append(U),this.container}getElementsToTriggerPopup(){return t(this,ee)}addHighlightArea(){this.container.classList.add("highlightArea")}}ee=new WeakMap,u.InkAnnotationElement=nt;class G extends S{constructor(R){super(R,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class at extends S{constructor(R){super(R,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class At extends S{constructor(R){super(R,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class Tt extends S{constructor(R){super(R,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class xt extends S{constructor(R){super(R,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}u.StampAnnotationElement=xt;class v extends S{constructor(e){super(e,{isRenderable:!0});D(this,q);D(this,Jt,null);const{filename:b,content:I}=this.data.file;this.filename=(0,T.getFilenameFromUrl)(b,!0),this.content=I,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,filename:b,content:I})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:e,data:b}=this;let I;b.hasAppearance||b.fillAlpha===0?I=document.createElement("div"):(I=document.createElement("img"),I.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(b.name)?"paperclip":"pushpin"}.svg`,b.fillAlpha&&b.fillAlpha<1&&(I.style=`filter: opacity(${Math.round(b.fillAlpha*100)}%);`)),I.addEventListener("dblclick",j(this,q,oi).bind(this)),J(this,Jt,I);const{isMac:U}=l.FeatureTest.platform;return e.addEventListener("keydown",W=>{W.key==="Enter"&&(U?W.metaKey:W.ctrlKey)&&j(this,q,oi).call(this)}),!b.popupRef&&this.hasPopupData?this._createPopup():I.classList.add("popupTriggerArea"),e.append(I),e}getElementsToTriggerPopup(){return t(this,Jt)}addHighlightArea(){this.container.classList.add("highlightArea")}}Jt=new WeakMap,q=new WeakSet,oi=function(){this.downloadManager?.openOrDownloadData(this.container,this.content,this.filename)};class i{constructor({div:R,accessibilityManager:e,annotationCanvasMap:b,l10n:I,page:U,viewport:W}){D(this,Bt);D(this,bt);D(this,Nt,null);D(this,wt,null);D(this,Dt,new Map);this.div=R,J(this,Nt,e),J(this,wt,b),this.l10n=I,this.page=U,this.viewport=W,this.zIndex=0,this.l10n||(this.l10n=gt.NullL10n)}async render(R){const{annotations:e}=R,b=this.div;(0,T.setLayerDimensions)(b,this.viewport);const I=new Map,U={data:null,layer:b,linkService:R.linkService,downloadManager:R.downloadManager,imageResourcesPath:R.imageResourcesPath||"",renderForms:R.renderForms!==!1,svgFactory:new T.DOMSVGFactory,annotationStorage:R.annotationStorage||new rt.AnnotationStorage,enableScripting:R.enableScripting===!0,hasJSActions:R.hasJSActions,fieldObjects:R.fieldObjects,parent:this,elements:null};for(const W of e){if(W.noHTML)continue;const st=W.annotationType===l.AnnotationType.POPUP;if(st){const It=I.get(W.id);if(!It)continue;U.elements=It}else{const{width:It,height:Pt}=N(W.rect);if(It<=0||Pt<=0)continue}U.data=W;const ct=M.create(U);if(!ct.isRenderable)continue;if(!st&&W.popupRef){const It=I.get(W.popupRef);It?It.push(ct):I.set(W.popupRef,[ct])}ct.annotationEditorType>0&&t(this,Dt).set(ct.data.id,ct);const Mt=ct.render();W.hidden&&(Mt.style.visibility="hidden"),j(this,Bt,Oi).call(this,Mt,W.id)}j(this,bt,li).call(this),await this.l10n.translate(b)}update({viewport:R}){const e=this.div;this.viewport=R,(0,T.setLayerDimensions)(e,{rotation:R.rotation}),j(this,bt,li).call(this),e.hidden=!1}getEditableAnnotations(){return Array.from(t(this,Dt).values())}getEditableAnnotation(R){return t(this,Dt).get(R)}}Nt=new WeakMap,wt=new WeakMap,Dt=new WeakMap,Bt=new WeakSet,Oi=function(R,e){const b=R.firstChild||R;b.id=`${l.AnnotationPrefix}${e}`,this.div.append(R),t(this,Nt)?.moveElementInDOM(this.div,R,b,!1)},bt=new WeakSet,li=function(){if(!t(this,wt))return;const R=this.div;for(const[e,b]of t(this,wt)){const I=R.querySelector(`[data-annotation-id="${e}"]`);if(!I)continue;const{firstChild:U}=I;U?U.nodeName==="CANVAS"?U.replaceWith(b):U.before(b):I.append(b)}t(this,wt).clear()},u.AnnotationLayer=i},(pt,u)=>{Object.defineProperty(u,"__esModule",{value:!0}),u.ColorConverters=void 0;function et(rt){return Math.floor(Math.max(0,Math.min(1,rt))*255).toString(16).padStart(2,"0")}function l(rt){return Math.max(0,Math.min(255,255*rt))}class T{static CMYK_G([z,gt,B,k]){return["G",1-Math.min(1,.3*z+.59*B+.11*gt+k)]}static G_CMYK([z]){return["CMYK",0,0,0,1-z]}static G_RGB([z]){return["RGB",z,z,z]}static G_rgb([z]){return z=l(z),[z,z,z]}static G_HTML([z]){const gt=et(z);return`#${gt}${gt}${gt}`}static RGB_G([z,gt,B]){return["G",.3*z+.59*gt+.11*B]}static RGB_rgb(z){return z.map(l)}static RGB_HTML(z){return`#${z.map(et).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([z,gt,B,k]){return["RGB",1-Math.min(1,z+k),1-Math.min(1,B+k),1-Math.min(1,gt+k)]}static CMYK_rgb([z,gt,B,k]){return[l(1-Math.min(1,z+k)),l(1-Math.min(1,B+k)),l(1-Math.min(1,gt+k))]}static CMYK_HTML(z){const gt=this.CMYK_RGB(z).slice(1);return this.RGB_HTML(gt)}static RGB_CMYK([z,gt,B]){const k=1-z,g=1-gt,L=1-B,N=Math.min(k,g,L);return["CMYK",k,g,L,N]}}u.ColorConverters=T},(pt,u)=>{Object.defineProperty(u,"__esModule",{value:!0}),u.NullL10n=void 0,u.getL10nFallback=l;const et={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}} × {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}} × {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typing…",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image",editor_alt_text_button_label:"Alt text",editor_alt_text_edit_button_label:"Edit alt text",editor_alt_text_decorative_tooltip:"Marked as decorative"};et.print_progress_percent="{{progress}}%";function l(z,gt){switch(z){case"find_match_count":z=`find_match_count[${gt.total===1?"one":"other"}]`;break;case"find_match_count_limit":z=`find_match_count_limit[${gt.limit===1?"one":"other"}]`;break}return et[z]||""}function T(z,gt){return gt?z.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,(B,k)=>k in gt?gt[k]:"{{"+k+"}}"):z}const rt={async getLanguage(){return"en-us"},async getDirection(){return"ltr"},async get(z,gt=null,B=l(z,gt)){return T(B,gt)},async translate(z){}};u.NullL10n=rt},(pt,u,et)=>{Object.defineProperty(u,"__esModule",{value:!0}),u.XfaLayer=void 0;var l=et(25);class T{static setupStorage(z,gt,B,k,g){const L=k.getValue(gt,{value:null});switch(B.name){case"textarea":if(L.value!==null&&(z.textContent=L.value),g==="print")break;z.addEventListener("input",N=>{k.setValue(gt,{value:N.target.value})});break;case"input":if(B.attributes.type==="radio"||B.attributes.type==="checkbox"){if(L.value===B.attributes.xfaOn?z.setAttribute("checked",!0):L.value===B.attributes.xfaOff&&z.removeAttribute("checked"),g==="print")break;z.addEventListener("change",N=>{k.setValue(gt,{value:N.target.checked?N.target.getAttribute("xfaOn"):N.target.getAttribute("xfaOff")})})}else{if(L.value!==null&&z.setAttribute("value",L.value),g==="print")break;z.addEventListener("input",N=>{k.setValue(gt,{value:N.target.value})})}break;case"select":if(L.value!==null){z.setAttribute("value",L.value);for(const N of B.children)N.attributes.value===L.value?N.attributes.selected=!0:N.attributes.hasOwnProperty("selected")&&delete N.attributes.selected}z.addEventListener("input",N=>{const M=N.target.options,S=M.selectedIndex===-1?"":M[M.selectedIndex].value;k.setValue(gt,{value:S})});break}}static setAttributes({html:z,element:gt,storage:B=null,intent:k,linkService:g}){const{attributes:L}=gt,N=z instanceof HTMLAnchorElement;L.type==="radio"&&(L.name=`${L.name}-${k}`);for(const[M,S]of Object.entries(L))if(S!=null)switch(M){case"class":S.length&&z.setAttribute(M,S.join(" "));break;case"dataId":break;case"id":z.setAttribute("data-element-id",S);break;case"style":Object.assign(z.style,S);break;case"textContent":z.textContent=S;break;default:(!N||M!=="href"&&M!=="newWindow")&&z.setAttribute(M,S)}N&&g.addLinkAttributes(z,L.href,L.newWindow),B&&L.dataId&&this.setupStorage(z,L.dataId,gt,B)}static render(z){const gt=z.annotationStorage,B=z.linkService,k=z.xfaHtml,g=z.intent||"display",L=document.createElement(k.name);k.attributes&&this.setAttributes({html:L,element:k,intent:g,linkService:B});const N=[[k,-1,L]],M=z.div;if(M.append(L),z.viewport){const y=`matrix(${z.viewport.transform.join(",")})`;M.style.transform=y}g!=="richText"&&M.setAttribute("class","xfaLayer xfaFont");const S=[];for(;N.length>0;){const[y,p,m]=N.at(-1);if(p+1===y.children.length){N.pop();continue}const E=y.children[++N.at(-1)[1]];if(E===null)continue;const{name:w}=E;if(w==="#text"){const a=document.createTextNode(E.value);S.push(a),m.append(a);continue}const _=E?.attributes?.xmlns?document.createElementNS(E.attributes.xmlns,w):document.createElement(w);if(m.append(_),E.attributes&&this.setAttributes({html:_,element:E,storage:gt,intent:g,linkService:B}),E.children&&E.children.length>0)N.push([E,-1,_]);else if(E.value){const a=document.createTextNode(E.value);l.XfaText.shouldBuildText(w)&&S.push(a),_.append(a)}}for(const y of M.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))y.setAttribute("readOnly",!0);return{textDivs:S}}static update(z){const gt=`matrix(${z.viewport.transform.join(",")})`;z.div.style.transform=gt,z.div.hidden=!1}}u.XfaLayer=T},(pt,u,et)=>{var k,g,L,N,M,S,y,p,m,E,w,_,a,c,d,Ni,f,Bi,C,Ui,Y,ji,V,ci,nt,Hi,at,hi,Tt,Wi,v,Gi,n,zi,o,Xi,A,qi,O,re,Z,di,lt,Fe,dt,Me,Ut,de,Rt,ui,K,Re,ht,Vi,St,fi,Ht,$i,Xt,Yi,qt,pi,ot,De,H,ue;Object.defineProperty(u,"__esModule",{value:!0}),u.InkEditor=void 0;var l=et(1),T=et(4),rt=et(29),z=et(6),gt=et(5);const _t=class _t extends T.AnnotationEditor{constructor(q){super({...q,name:"inkEditor"});D(this,d);D(this,f);D(this,C);D(this,Y);D(this,V);D(this,nt);D(this,at);D(this,Tt);D(this,v);D(this,n);D(this,o);D(this,A);D(this,O);D(this,Z);D(this,lt);D(this,dt);D(this,Ut);D(this,Rt);D(this,K);D(this,Xt);D(this,qt);D(this,ot);D(this,H);D(this,k,0);D(this,g,0);D(this,L,this.canvasPointermove.bind(this));D(this,N,this.canvasPointerleave.bind(this));D(this,M,this.canvasPointerup.bind(this));D(this,S,this.canvasPointerdown.bind(this));D(this,y,new Path2D);D(this,p,!1);D(this,m,!1);D(this,E,!1);D(this,w,null);D(this,_,0);D(this,a,0);D(this,c,null);this.color=q.color||null,this.thickness=q.thickness||null,this.opacity=q.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(q){T.AnnotationEditor.initialize(q,{strings:["editor_ink_canvas_aria_label","editor_ink2_aria_label"]})}static updateDefaultParams(q,Et){switch(q){case l.AnnotationEditorParamsType.INK_THICKNESS:_t._defaultThickness=Et;break;case l.AnnotationEditorParamsType.INK_COLOR:_t._defaultColor=Et;break;case l.AnnotationEditorParamsType.INK_OPACITY:_t._defaultOpacity=Et/100;break}}updateParams(q,Et){switch(q){case l.AnnotationEditorParamsType.INK_THICKNESS:j(this,d,Ni).call(this,Et);break;case l.AnnotationEditorParamsType.INK_COLOR:j(this,f,Bi).call(this,Et);break;case l.AnnotationEditorParamsType.INK_OPACITY:j(this,C,Ui).call(this,Et);break}}static get defaultPropertiesToUpdate(){return[[l.AnnotationEditorParamsType.INK_THICKNESS,_t._defaultThickness],[l.AnnotationEditorParamsType.INK_COLOR,_t._defaultColor||T.AnnotationEditor._defaultLineColor],[l.AnnotationEditorParamsType.INK_OPACITY,Math.round(_t._defaultOpacity*100)]]}get propertiesToUpdate(){return[[l.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||_t._defaultThickness],[l.AnnotationEditorParamsType.INK_COLOR,this.color||_t._defaultColor||T.AnnotationEditor._defaultLineColor],[l.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??_t._defaultOpacity))]]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(j(this,lt,Fe).call(this),j(this,dt,Me).call(this)),this.isAttachedToDOM||(this.parent.add(this),j(this,Ut,de).call(this)),j(this,H,ue).call(this)))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,t(this,w).disconnect(),J(this,w,null),super.remove())}setParent(q){!this.parent&&q?this._uiManager.removeShouldRescale(this):this.parent&&q===null&&this._uiManager.addShouldRescale(this),super.setParent(q)}onScaleChanging(){const[q,Et]=this.parentDimensions,Nt=this.width*q,wt=this.height*Et;this.setDimensions(Nt,wt)}enableEditMode(){t(this,p)||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",t(this,S)))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",t(this,S)))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){t(this,p)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),J(this,p,!0),this.div.classList.add("disabled"),j(this,H,ue).call(this,!0),this.makeResizable(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(q){this._focusEventsAllowed&&(super.focusin(q),this.enableEditMode())}canvasPointerdown(q){q.button!==0||!this.isInEditMode()||t(this,p)||(this.setInForeground(),q.preventDefault(),q.type!=="mouse"&&this.div.focus(),j(this,nt,Hi).call(this,q.offsetX,q.offsetY))}canvasPointermove(q){q.preventDefault(),j(this,at,hi).call(this,q.offsetX,q.offsetY)}canvasPointerup(q){q.preventDefault(),j(this,Z,di).call(this,q)}canvasPointerleave(q){j(this,Z,di).call(this,q)}get isResizable(){return!this.isEmpty()&&t(this,p)}render(){if(this.div)return this.div;let q,Et;this.width&&(q=this.x,Et=this.y),super.render(),T.AnnotationEditor._l10nPromise.get("editor_ink2_aria_label").then(Yt=>this.div?.setAttribute("aria-label",Yt));const[Nt,wt,Dt,Bt]=j(this,Y,ji).call(this);if(this.setAt(Nt,wt,0,0),this.setDims(Dt,Bt),j(this,lt,Fe).call(this),this.width){const[Yt,bt]=this.parentDimensions;this.setAspectRatio(this.width*Yt,this.height*bt),this.setAt(q*Yt,Et*bt,this.width*Yt,this.height*bt),J(this,E,!0),j(this,Ut,de).call(this),this.setDims(this.width*Yt,this.height*bt),j(this,O,re).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return j(this,dt,Me).call(this),this.div}setDimensions(q,Et){const Nt=Math.round(q),wt=Math.round(Et);if(t(this,_)===Nt&&t(this,a)===wt)return;J(this,_,Nt),J(this,a,wt),this.canvas.style.visibility="hidden";const[Dt,Bt]=this.parentDimensions;this.width=q/Dt,this.height=Et/Bt,this.fixAndSetPosition(),t(this,p)&&j(this,Rt,ui).call(this,q,Et),j(this,Ut,de).call(this),j(this,O,re).call(this),this.canvas.style.visibility="visible",this.fixDims()}static deserialize(q,Et,Nt){var U,W,st;if(q instanceof rt.InkAnnotationElement)return null;const wt=super.deserialize(q,Et,Nt);wt.thickness=q.thickness,wt.color=l.Util.makeHexColor(...q.color),wt.opacity=q.opacity;const[Dt,Bt]=wt.pageDimensions,Yt=wt.width*Dt,bt=wt.height*Bt,$t=wt.parentScale,Lt=q.thickness/2;J(wt,p,!0),J(wt,_,Math.round(Yt)),J(wt,a,Math.round(bt));const{paths:R,rect:e,rotation:b}=q;for(let{bezier:ct}of R){ct=j(U=_t,Ht,$i).call(U,ct,e,b);const Mt=[];wt.paths.push(Mt);let It=$t*(ct[0]-Lt),Pt=$t*(ct[1]-Lt);for(let Ot=2,Vt=ct.length;Ot<Vt;Ot+=6){const Qt=$t*(ct[Ot]-Lt),Kt=$t*(ct[Ot+1]-Lt),te=$t*(ct[Ot+2]-Lt),se=$t*(ct[Ot+3]-Lt),ie=$t*(ct[Ot+4]-Lt),ae=$t*(ct[Ot+5]-Lt);Mt.push([[It,Pt],[Qt,Kt],[te,se],[ie,ae]]),It=ie,Pt=ae}const Ft=j(this,ht,Vi).call(this,Mt);wt.bezierPath2D.push(Ft)}const I=j(W=wt,qt,pi).call(W);return J(wt,g,Math.max(T.AnnotationEditor.MIN_SIZE,I[2]-I[0])),J(wt,k,Math.max(T.AnnotationEditor.MIN_SIZE,I[3]-I[1])),j(st=wt,Rt,ui).call(st,Yt,bt),wt}serialize(){if(this.isEmpty())return null;const q=this.getRect(0,0),Et=T.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:l.AnnotationEditorType.INK,color:Et,thickness:this.thickness,opacity:this.opacity,paths:j(this,Xt,Yi).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,q),pageIndex:this.pageIndex,rect:q,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}};k=new WeakMap,g=new WeakMap,L=new WeakMap,N=new WeakMap,M=new WeakMap,S=new WeakMap,y=new WeakMap,p=new WeakMap,m=new WeakMap,E=new WeakMap,w=new WeakMap,_=new WeakMap,a=new WeakMap,c=new WeakMap,d=new WeakSet,Ni=function(q){const Et=this.thickness;this.addCommands({cmd:()=>{this.thickness=q,j(this,H,ue).call(this)},undo:()=>{this.thickness=Et,j(this,H,ue).call(this)},mustExec:!0,type:l.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},f=new WeakSet,Bi=function(q){const Et=this.color;this.addCommands({cmd:()=>{this.color=q,j(this,O,re).call(this)},undo:()=>{this.color=Et,j(this,O,re).call(this)},mustExec:!0,type:l.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},C=new WeakSet,Ui=function(q){q/=100;const Et=this.opacity;this.addCommands({cmd:()=>{this.opacity=q,j(this,O,re).call(this)},undo:()=>{this.opacity=Et,j(this,O,re).call(this)},mustExec:!0,type:l.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},Y=new WeakSet,ji=function(){const{parentRotation:q,parentDimensions:[Et,Nt]}=this;switch(q){case 90:return[0,Nt,Nt,Et];case 180:return[Et,Nt,Et,Nt];case 270:return[Et,0,Nt,Et];default:return[0,0,Et,Nt]}},V=new WeakSet,ci=function(){const{ctx:q,color:Et,opacity:Nt,thickness:wt,parentScale:Dt,scaleFactor:Bt}=this;q.lineWidth=wt*Dt/Bt,q.lineCap="round",q.lineJoin="round",q.miterLimit=10,q.strokeStyle=`${Et}${(0,gt.opacityToHex)(Nt)}`},nt=new WeakSet,Hi=function(q,Et){this.canvas.addEventListener("contextmenu",z.noContextMenu),this.canvas.addEventListener("pointerleave",t(this,N)),this.canvas.addEventListener("pointermove",t(this,L)),this.canvas.addEventListener("pointerup",t(this,M)),this.canvas.removeEventListener("pointerdown",t(this,S)),this.isEditing=!0,t(this,E)||(J(this,E,!0),j(this,Ut,de).call(this),this.thickness||(this.thickness=_t._defaultThickness),this.color||(this.color=_t._defaultColor||T.AnnotationEditor._defaultLineColor),this.opacity??(this.opacity=_t._defaultOpacity)),this.currentPath.push([q,Et]),J(this,m,!1),j(this,V,ci).call(this),J(this,c,()=>{j(this,n,zi).call(this),t(this,c)&&window.requestAnimationFrame(t(this,c))}),window.requestAnimationFrame(t(this,c))},at=new WeakSet,hi=function(q,Et){const[Nt,wt]=this.currentPath.at(-1);if(this.currentPath.length>1&&q===Nt&&Et===wt)return;const Dt=this.currentPath;let Bt=t(this,y);if(Dt.push([q,Et]),J(this,m,!0),Dt.length<=2){Bt.moveTo(...Dt[0]),Bt.lineTo(q,Et);return}Dt.length===3&&(J(this,y,Bt=new Path2D),Bt.moveTo(...Dt[0])),j(this,o,Xi).call(this,Bt,...Dt.at(-3),...Dt.at(-2),q,Et)},Tt=new WeakSet,Wi=function(){if(this.currentPath.length===0)return;const q=this.currentPath.at(-1);t(this,y).lineTo(...q)},v=new WeakSet,Gi=function(q,Et){J(this,c,null),q=Math.min(Math.max(q,0),this.canvas.width),Et=Math.min(Math.max(Et,0),this.canvas.height),j(this,at,hi).call(this,q,Et),j(this,Tt,Wi).call(this);let Nt;if(this.currentPath.length!==1)Nt=j(this,A,qi).call(this);else{const bt=[q,Et];Nt=[[bt,bt.slice(),bt.slice(),bt]]}const wt=t(this,y),Dt=this.currentPath;this.currentPath=[],J(this,y,new Path2D);const Bt=()=>{this.allRawPaths.push(Dt),this.paths.push(Nt),this.bezierPath2D.push(wt),this.rebuild()},Yt=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(j(this,lt,Fe).call(this),j(this,dt,Me).call(this)),j(this,H,ue).call(this))};this.addCommands({cmd:Bt,undo:Yt,mustExec:!0})},n=new WeakSet,zi=function(){if(!t(this,m))return;J(this,m,!1);const q=Math.ceil(this.thickness*this.parentScale),Et=this.currentPath.slice(-3),Nt=Et.map(Bt=>Bt[0]),wt=Et.map(Bt=>Bt[1]);Math.min(...Nt)-q,Math.max(...Nt)+q,Math.min(...wt)-q,Math.max(...wt)+q;const{ctx:Dt}=this;Dt.save(),Dt.clearRect(0,0,this.canvas.width,this.canvas.height);for(const Bt of this.bezierPath2D)Dt.stroke(Bt);Dt.stroke(t(this,y)),Dt.restore()},o=new WeakSet,Xi=function(q,Et,Nt,wt,Dt,Bt,Yt){const bt=(Et+wt)/2,$t=(Nt+Dt)/2,Lt=(wt+Bt)/2,R=(Dt+Yt)/2;q.bezierCurveTo(bt+2*(wt-bt)/3,$t+2*(Dt-$t)/3,Lt+2*(wt-Lt)/3,R+2*(Dt-R)/3,Lt,R)},A=new WeakSet,qi=function(){const q=this.currentPath;if(q.length<=2)return[[q[0],q[0],q.at(-1),q.at(-1)]];const Et=[];let Nt,[wt,Dt]=q[0];for(Nt=1;Nt<q.length-2;Nt++){const[e,b]=q[Nt],[I,U]=q[Nt+1],W=(e+I)/2,st=(b+U)/2,ct=[wt+2*(e-wt)/3,Dt+2*(b-Dt)/3],Mt=[W+2*(e-W)/3,st+2*(b-st)/3];Et.push([[wt,Dt],ct,Mt,[W,st]]),[wt,Dt]=[W,st]}const[Bt,Yt]=q[Nt],[bt,$t]=q[Nt+1],Lt=[wt+2*(Bt-wt)/3,Dt+2*(Yt-Dt)/3],R=[bt+2*(Bt-bt)/3,$t+2*(Yt-$t)/3];return Et.push([[wt,Dt],Lt,R,[bt,$t]]),Et},O=new WeakSet,re=function(){if(this.isEmpty()){j(this,K,Re).call(this);return}j(this,V,ci).call(this);const{canvas:q,ctx:Et}=this;Et.setTransform(1,0,0,1,0,0),Et.clearRect(0,0,q.width,q.height),j(this,K,Re).call(this);for(const Nt of this.bezierPath2D)Et.stroke(Nt)},Z=new WeakSet,di=function(q){this.canvas.removeEventListener("pointerleave",t(this,N)),this.canvas.removeEventListener("pointermove",t(this,L)),this.canvas.removeEventListener("pointerup",t(this,M)),this.canvas.addEventListener("pointerdown",t(this,S)),setTimeout(()=>{this.canvas.removeEventListener("contextmenu",z.noContextMenu)},10),j(this,v,Gi).call(this,q.offsetX,q.offsetY),this.addToAnnotationStorage(),this.setInBackground()},lt=new WeakSet,Fe=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",T.AnnotationEditor._l10nPromise.get("editor_ink_canvas_aria_label").then(q=>this.canvas?.setAttribute("aria-label",q)),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},dt=new WeakSet,Me=function(){J(this,w,new ResizeObserver(q=>{const Et=q[0].contentRect;Et.width&&Et.height&&this.setDimensions(Et.width,Et.height)})),t(this,w).observe(this.div)},Ut=new WeakSet,de=function(){if(!t(this,E))return;const[q,Et]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*q),this.canvas.height=Math.ceil(this.height*Et),j(this,K,Re).call(this)},Rt=new WeakSet,ui=function(q,Et){const Nt=j(this,ot,De).call(this),wt=(q-Nt)/t(this,g),Dt=(Et-Nt)/t(this,k);this.scaleFactor=Math.min(wt,Dt)},K=new WeakSet,Re=function(){const q=j(this,ot,De).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+q,this.translationY*this.scaleFactor+q)},ht=new WeakSet,Vi=function(q){const Et=new Path2D;for(let Nt=0,wt=q.length;Nt<wt;Nt++){const[Dt,Bt,Yt,bt]=q[Nt];Nt===0&&Et.moveTo(...Dt),Et.bezierCurveTo(Bt[0],Bt[1],Yt[0],Yt[1],bt[0],bt[1])}return Et},St=new WeakSet,fi=function(q,Et,Nt){const[wt,Dt,Bt,Yt]=Et;switch(Nt){case 0:for(let bt=0,$t=q.length;bt<$t;bt+=2)q[bt]+=wt,q[bt+1]=Yt-q[bt+1];break;case 90:for(let bt=0,$t=q.length;bt<$t;bt+=2){const Lt=q[bt];q[bt]=q[bt+1]+wt,q[bt+1]=Lt+Dt}break;case 180:for(let bt=0,$t=q.length;bt<$t;bt+=2)q[bt]=Bt-q[bt],q[bt+1]+=Dt;break;case 270:for(let bt=0,$t=q.length;bt<$t;bt+=2){const Lt=q[bt];q[bt]=Bt-q[bt+1],q[bt+1]=Yt-Lt}break;default:throw new Error("Invalid rotation")}return q},Ht=new WeakSet,$i=function(q,Et,Nt){const[wt,Dt,Bt,Yt]=Et;switch(Nt){case 0:for(let bt=0,$t=q.length;bt<$t;bt+=2)q[bt]-=wt,q[bt+1]=Yt-q[bt+1];break;case 90:for(let bt=0,$t=q.length;bt<$t;bt+=2){const Lt=q[bt];q[bt]=q[bt+1]-Dt,q[bt+1]=Lt-wt}break;case 180:for(let bt=0,$t=q.length;bt<$t;bt+=2)q[bt]=Bt-q[bt],q[bt+1]-=Dt;break;case 270:for(let bt=0,$t=q.length;bt<$t;bt+=2){const Lt=q[bt];q[bt]=Yt-q[bt+1],q[bt+1]=Bt-Lt}break;default:throw new Error("Invalid rotation")}return q},Xt=new WeakSet,Yi=function(q,Et,Nt,wt){var $t,Lt;const Dt=[],Bt=this.thickness/2,Yt=q*Et+Bt,bt=q*Nt+Bt;for(const R of this.paths){const e=[],b=[];for(let I=0,U=R.length;I<U;I++){const[W,st,ct,Mt]=R[I],It=q*W[0]+Yt,Pt=q*W[1]+bt,Ft=q*st[0]+Yt,Ot=q*st[1]+bt,Vt=q*ct[0]+Yt,Qt=q*ct[1]+bt,Kt=q*Mt[0]+Yt,te=q*Mt[1]+bt;I===0&&(e.push(It,Pt),b.push(It,Pt)),e.push(Ft,Ot,Vt,Qt,Kt,te),b.push(Ft,Ot),I===U-1&&b.push(Kt,te)}Dt.push({bezier:j($t=_t,St,fi).call($t,e,wt,this.rotation),points:j(Lt=_t,St,fi).call(Lt,b,wt,this.rotation)})}return Dt},qt=new WeakSet,pi=function(){let q=1/0,Et=-1/0,Nt=1/0,wt=-1/0;for(const Dt of this.paths)for(const[Bt,Yt,bt,$t]of Dt){const Lt=l.Util.bezierBoundingBox(...Bt,...Yt,...bt,...$t);q=Math.min(q,Lt[0]),Nt=Math.min(Nt,Lt[1]),Et=Math.max(Et,Lt[2]),wt=Math.max(wt,Lt[3])}return[q,Nt,Et,wt]},ot=new WeakSet,De=function(){return t(this,p)?Math.ceil(this.thickness*this.parentScale):0},H=new WeakSet,ue=function(q=!1){if(this.isEmpty())return;if(!t(this,p)){j(this,O,re).call(this);return}const Et=j(this,qt,pi).call(this),Nt=j(this,ot,De).call(this);J(this,g,Math.max(T.AnnotationEditor.MIN_SIZE,Et[2]-Et[0])),J(this,k,Math.max(T.AnnotationEditor.MIN_SIZE,Et[3]-Et[1]));const wt=Math.ceil(Nt+t(this,g)*this.scaleFactor),Dt=Math.ceil(Nt+t(this,k)*this.scaleFactor),[Bt,Yt]=this.parentDimensions;this.width=wt/Bt,this.height=Dt/Yt,this.setAspectRatio(wt,Dt);const bt=this.translationX,$t=this.translationY;this.translationX=-Et[0],this.translationY=-Et[1],j(this,Ut,de).call(this),j(this,O,re).call(this),J(this,_,wt),J(this,a,Dt),this.setDims(wt,Dt);const Lt=q?Nt/this.scaleFactor/2:0;this.translate(bt-this.translationX-Lt,$t-this.translationY-Lt)},D(_t,ht),D(_t,St),D(_t,Ht),Zt(_t,"_defaultColor",null),Zt(_t,"_defaultOpacity",1),Zt(_t,"_defaultThickness",1),Zt(_t,"_type","ink");let B=_t;u.InkEditor=B},(pt,u,et)=>{var B,k,g,L,N,M,S,y,p,m,E,ye,_,ve,c,Ie,r,gi,F,Ki,X,Ji,P,mi,ut,Le,G,Qi;Object.defineProperty(u,"__esModule",{value:!0}),u.StampEditor=void 0;var l=et(1),T=et(4),rt=et(6),z=et(29);const At=class At extends T.AnnotationEditor{constructor(v){super({...v,name:"stampEditor"});D(this,E);D(this,_);D(this,c);D(this,r);D(this,F);D(this,X);D(this,P);D(this,ut);D(this,G);D(this,B,null);D(this,k,null);D(this,g,null);D(this,L,null);D(this,N,null);D(this,M,null);D(this,S,null);D(this,y,null);D(this,p,!1);D(this,m,!1);J(this,L,v.bitmapUrl),J(this,N,v.bitmapFile)}static initialize(v){T.AnnotationEditor.initialize(v)}static get supportedTypes(){const v=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return(0,l.shadow)(this,"supportedTypes",v.map(i=>`image/${i}`))}static get supportedTypesStr(){return(0,l.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(v){return this.supportedTypes.includes(v)}static paste(v,i){i.pasteEditor(l.AnnotationEditorType.STAMP,{bitmapFile:v.getAsFile()})}remove(){t(this,k)&&(J(this,B,null),this._uiManager.imageManager.deleteId(t(this,k)),t(this,M)?.remove(),J(this,M,null),t(this,S)?.disconnect(),J(this,S,null)),super.remove()}rebuild(){if(!this.parent){t(this,k)&&j(this,c,Ie).call(this);return}super.rebuild(),this.div!==null&&(t(this,k)&&j(this,c,Ie).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(t(this,g)||t(this,B)||t(this,L)||t(this,N))}get isResizable(){return!0}render(){if(this.div)return this.div;let v,i;if(this.width&&(v=this.x,i=this.y),super.render(),this.div.hidden=!0,t(this,B)?j(this,r,gi).call(this):j(this,c,Ie).call(this),this.width){const[n,s]=this.parentDimensions;this.setAt(v*n,i*s,this.width*n,this.height*s)}return this.div}static deserialize(v,i,n){if(v instanceof z.StampAnnotationElement)return null;const s=super.deserialize(v,i,n),{rect:o,bitmapUrl:h,bitmapId:A,isSvg:x,accessibilityData:O}=v;A&&n.imageManager.isValidId(A)?J(s,k,A):J(s,L,h),J(s,p,x);const[Q,Z]=s.pageDimensions;return s.width=(o[2]-o[0])/Q,s.height=(o[3]-o[1])/Z,O&&(s.altTextData=O),s}serialize(v=!1,i=null){if(this.isEmpty())return null;const n={annotationType:l.AnnotationEditorType.STAMP,bitmapId:t(this,k),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:t(this,p),structTreeParentId:this._structTreeParentId};if(v)return n.bitmapUrl=j(this,ut,Le).call(this,!0),n.accessibilityData=this.altTextData,n;const{decorative:s,altText:o}=this.altTextData;if(!s&&o&&(n.accessibilityData={type:"Figure",alt:o}),i===null)return n;i.stamps||(i.stamps=new Map);const h=t(this,p)?(n.rect[2]-n.rect[0])*(n.rect[3]-n.rect[1]):null;if(!i.stamps.has(t(this,k)))i.stamps.set(t(this,k),{area:h,serialized:n}),n.bitmap=j(this,ut,Le).call(this,!1);else if(t(this,p)){const A=i.stamps.get(t(this,k));h>A.area&&(A.area=h,A.serialized.bitmap.close(),A.serialized.bitmap=j(this,ut,Le).call(this,!1))}return n}};B=new WeakMap,k=new WeakMap,g=new WeakMap,L=new WeakMap,N=new WeakMap,M=new WeakMap,S=new WeakMap,y=new WeakMap,p=new WeakMap,m=new WeakMap,E=new WeakSet,ye=function(v,i=!1){if(!v){this.remove();return}J(this,B,v.bitmap),i||(J(this,k,v.id),J(this,p,v.isSvg)),j(this,r,gi).call(this)},_=new WeakSet,ve=function(){J(this,g,null),this._uiManager.enableWaiting(!1),t(this,M)&&this.div.focus()},c=new WeakSet,Ie=function(){if(t(this,k)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(t(this,k)).then(i=>j(this,E,ye).call(this,i,!0)).finally(()=>j(this,_,ve).call(this));return}if(t(this,L)){const i=t(this,L);J(this,L,null),this._uiManager.enableWaiting(!0),J(this,g,this._uiManager.imageManager.getFromUrl(i).then(n=>j(this,E,ye).call(this,n)).finally(()=>j(this,_,ve).call(this)));return}if(t(this,N)){const i=t(this,N);J(this,N,null),this._uiManager.enableWaiting(!0),J(this,g,this._uiManager.imageManager.getFromFile(i).then(n=>j(this,E,ye).call(this,n)).finally(()=>j(this,_,ve).call(this)));return}const v=document.createElement("input");v.type="file",v.accept=At.supportedTypesStr,J(this,g,new Promise(i=>{v.addEventListener("change",async()=>{if(!v.files||v.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const n=await this._uiManager.imageManager.getFromFile(v.files[0]);j(this,E,ye).call(this,n)}i()}),v.addEventListener("cancel",()=>{this.remove(),i()})}).finally(()=>j(this,_,ve).call(this))),v.click()},r=new WeakSet,gi=function(){const{div:v}=this;let{width:i,height:n}=t(this,B);const[s,o]=this.pageDimensions,h=.75;if(this.width)i=this.width*s,n=this.height*o;else if(i>h*s||n>h*o){const Q=Math.min(h*s/i,h*o/n);i*=Q,n*=Q}const[A,x]=this.parentDimensions;this.setDims(i*A/s,n*x/o),this._uiManager.enableWaiting(!1);const O=J(this,M,document.createElement("canvas"));v.append(O),v.hidden=!1,j(this,P,mi).call(this,i,n),j(this,G,Qi).call(this),t(this,m)||(this.parent.addUndoableEditor(this),J(this,m,!0)),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"inserted_image"}}}),this.addAltTextButton()},F=new WeakSet,Ki=function(v,i){const[n,s]=this.parentDimensions;this.width=v/n,this.height=i/s,this.setDims(v,i),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,t(this,y)!==null&&clearTimeout(t(this,y)),J(this,y,setTimeout(()=>{J(this,y,null),j(this,P,mi).call(this,v,i)},200))},X=new WeakSet,Ji=function(v,i){const{width:n,height:s}=t(this,B);let o=n,h=s,A=t(this,B);for(;o>2*v||h>2*i;){const x=o,O=h;o>2*v&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2)),h>2*i&&(h=h>=16384?Math.floor(h/2)-1:Math.ceil(h/2));const Q=new OffscreenCanvas(o,h);Q.getContext("2d").drawImage(A,0,0,x,O,0,0,o,h),A=Q.transferToImageBitmap()}return A},P=new WeakSet,mi=function(v,i){v=Math.ceil(v),i=Math.ceil(i);const n=t(this,M);if(!n||n.width===v&&n.height===i)return;n.width=v,n.height=i;const s=t(this,p)?t(this,B):j(this,X,Ji).call(this,v,i),o=n.getContext("2d");o.filter=this._uiManager.hcmFilter,o.drawImage(s,0,0,s.width,s.height,0,0,v,i)},ut=new WeakSet,Le=function(v){if(v){if(t(this,p)){const s=this._uiManager.imageManager.getSvgUrl(t(this,k));if(s)return s}const i=document.createElement("canvas");return{width:i.width,height:i.height}=t(this,B),i.getContext("2d").drawImage(t(this,B),0,0),i.toDataURL()}if(t(this,p)){const[i,n]=this.pageDimensions,s=Math.round(this.width*i*rt.PixelsPerInch.PDF_TO_CSS_UNITS),o=Math.round(this.height*n*rt.PixelsPerInch.PDF_TO_CSS_UNITS),h=new OffscreenCanvas(s,o);return h.getContext("2d").drawImage(t(this,B),0,0,t(this,B).width,t(this,B).height,0,0,s,o),h.transferToImageBitmap()}return structuredClone(t(this,B))},G=new WeakSet,Qi=function(){J(this,S,new ResizeObserver(v=>{const i=v[0].contentRect;i.width&&i.height&&j(this,F,Ki).call(this,i.width,i.height)})),t(this,S).observe(this.div)},Zt(At,"_type","stamp");let gt=At;u.StampEditor=gt}],__webpack_module_cache__={};function __w_pdfjs_require__(pt){var u=__webpack_module_cache__[pt];if(u!==void 0)return u.exports;var et=__webpack_module_cache__[pt]={exports:{}};return __webpack_modules__[pt](et,et.exports,__w_pdfjs_require__),et.exports}var __webpack_exports__={};return(()=>{var pt=__webpack_exports__;Object.defineProperty(pt,"__esModule",{value:!0}),Object.defineProperty(pt,"AbortException",{enumerable:!0,get:function(){return u.AbortException}}),Object.defineProperty(pt,"AnnotationEditorLayer",{enumerable:!0,get:function(){return rt.AnnotationEditorLayer}}),Object.defineProperty(pt,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return u.AnnotationEditorParamsType}}),Object.defineProperty(pt,"AnnotationEditorType",{enumerable:!0,get:function(){return u.AnnotationEditorType}}),Object.defineProperty(pt,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return z.AnnotationEditorUIManager}}),Object.defineProperty(pt,"AnnotationLayer",{enumerable:!0,get:function(){return gt.AnnotationLayer}}),Object.defineProperty(pt,"AnnotationMode",{enumerable:!0,get:function(){return u.AnnotationMode}}),Object.defineProperty(pt,"CMapCompressionType",{enumerable:!0,get:function(){return u.CMapCompressionType}}),Object.defineProperty(pt,"DOMSVGFactory",{enumerable:!0,get:function(){return l.DOMSVGFactory}}),Object.defineProperty(pt,"FeatureTest",{enumerable:!0,get:function(){return u.FeatureTest}}),Object.defineProperty(pt,"GlobalWorkerOptions",{enumerable:!0,get:function(){return B.GlobalWorkerOptions}}),Object.defineProperty(pt,"ImageKind",{enumerable:!0,get:function(){return u.ImageKind}}),Object.defineProperty(pt,"InvalidPDFException",{enumerable:!0,get:function(){return u.InvalidPDFException}}),Object.defineProperty(pt,"MissingPDFException",{enumerable:!0,get:function(){return u.MissingPDFException}}),Object.defineProperty(pt,"OPS",{enumerable:!0,get:function(){return u.OPS}}),Object.defineProperty(pt,"PDFDataRangeTransport",{enumerable:!0,get:function(){return et.PDFDataRangeTransport}}),Object.defineProperty(pt,"PDFDateString",{enumerable:!0,get:function(){return l.PDFDateString}}),Object.defineProperty(pt,"PDFWorker",{enumerable:!0,get:function(){return et.PDFWorker}}),Object.defineProperty(pt,"PasswordResponses",{enumerable:!0,get:function(){return u.PasswordResponses}}),Object.defineProperty(pt,"PermissionFlag",{enumerable:!0,get:function(){return u.PermissionFlag}}),Object.defineProperty(pt,"PixelsPerInch",{enumerable:!0,get:function(){return l.PixelsPerInch}}),Object.defineProperty(pt,"PromiseCapability",{enumerable:!0,get:function(){return u.PromiseCapability}}),Object.defineProperty(pt,"RenderingCancelledException",{enumerable:!0,get:function(){return l.RenderingCancelledException}}),Object.defineProperty(pt,"SVGGraphics",{enumerable:!0,get:function(){return et.SVGGraphics}}),Object.defineProperty(pt,"UnexpectedResponseException",{enumerable:!0,get:function(){return u.UnexpectedResponseException}}),Object.defineProperty(pt,"Util",{enumerable:!0,get:function(){return u.Util}}),Object.defineProperty(pt,"VerbosityLevel",{enumerable:!0,get:function(){return u.VerbosityLevel}}),Object.defineProperty(pt,"XfaLayer",{enumerable:!0,get:function(){return k.XfaLayer}}),Object.defineProperty(pt,"build",{enumerable:!0,get:function(){return et.build}}),Object.defineProperty(pt,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return u.createValidAbsoluteUrl}}),Object.defineProperty(pt,"getDocument",{enumerable:!0,get:function(){return et.getDocument}}),Object.defineProperty(pt,"getFilenameFromUrl",{enumerable:!0,get:function(){return l.getFilenameFromUrl}}),Object.defineProperty(pt,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return l.getPdfFilenameFromUrl}}),Object.defineProperty(pt,"getXfaPageViewport",{enumerable:!0,get:function(){return l.getXfaPageViewport}}),Object.defineProperty(pt,"isDataScheme",{enumerable:!0,get:function(){return l.isDataScheme}}),Object.defineProperty(pt,"isPdfFile",{enumerable:!0,get:function(){return l.isPdfFile}}),Object.defineProperty(pt,"loadScript",{enumerable:!0,get:function(){return l.loadScript}}),Object.defineProperty(pt,"noContextMenu",{enumerable:!0,get:function(){return l.noContextMenu}}),Object.defineProperty(pt,"normalizeUnicode",{enumerable:!0,get:function(){return u.normalizeUnicode}}),Object.defineProperty(pt,"renderTextLayer",{enumerable:!0,get:function(){return T.renderTextLayer}}),Object.defineProperty(pt,"setLayerDimensions",{enumerable:!0,get:function(){return l.setLayerDimensions}}),Object.defineProperty(pt,"shadow",{enumerable:!0,get:function(){return u.shadow}}),Object.defineProperty(pt,"updateTextLayer",{enumerable:!0,get:function(){return T.updateTextLayer}}),Object.defineProperty(pt,"version",{enumerable:!0,get:function(){return et.version}});var u=__w_pdfjs_require__(1),et=__w_pdfjs_require__(2),l=__w_pdfjs_require__(6),T=__w_pdfjs_require__(26),rt=__w_pdfjs_require__(27),z=__w_pdfjs_require__(5),gt=__w_pdfjs_require__(29),B=__w_pdfjs_require__(14),k=__w_pdfjs_require__(32)})(),__webpack_exports__})())})(pdf);var pdfExports=pdf.exports;export{getAugmentedNamespace as a,commonjsGlobal as b,commonjsRequire as c,getDefaultExportFromCjs as g,pdfExports as p};
